<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.6.2">Jekyll</generator><link href="https://agenttroll.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://agenttroll.github.io/blog/" rel="alternate" type="text/html" /><updated>2018-04-14T01:37:03-07:00</updated><id>https://agenttroll.github.io/blog/</id><title type="html">Inside a Troll</title><subtitle>Thoughts of a Java developer</subtitle><entry><title type="html">Keeping Inventories Open</title><link href="https://agenttroll.github.io/blog/2018/04/13/keeping-inventories-open.html" rel="alternate" type="text/html" title="Keeping Inventories Open" /><published>2018-04-13T21:38:10-07:00</published><updated>2018-04-13T21:38:10-07:00</updated><id>https://agenttroll.github.io/blog/2018/04/13/keeping-inventories-open</id><content type="html" xml:base="https://agenttroll.github.io/blog/2018/04/13/keeping-inventories-open.html">&lt;p&gt;&lt;em&gt;Note: Code samples in this post have been slightly altered. I have not leaked any information from our plugins in the writing of this post&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Over the past week or two, we’ve been working hard to get the gambling plugin fixed up for you guys to use. Unfortunately, there were a few interesting bumps in the road.&lt;/p&gt;

&lt;h1 id=&quot;crashing-issue&quot;&gt;Crashing Issue&lt;/h1&gt;

&lt;p&gt;One of the features of coinflips was that once the inventory that flips between the heads opens, it will not close until the coinflip is over. We did this by re-opening the inventory whenever it was closed. It basically looked something like this:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onPlayerCloseInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InventoryCloseEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;menuIsCoinflip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Schedule the inventory to be opened after the next tick&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Bukkit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getScheduler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;runTask&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Tell the player to open the inventory that they closed&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What we found, however, was that for some reason, this handler would become stuck in a loop and prevent the main thread from proceeding. There is nothing overtly wrong about this method, really, it literally performs the correct handling for it after “the next tick.”&lt;/p&gt;

&lt;p&gt;From the &lt;a href=&quot;https://hub.spigotmc.org/javadocs/spigot/org/bukkit/scheduler/BukkitScheduler.html#runTask-org.bukkit.plugin.Plugin-java.lang.Runnable-&quot;&gt;Bukkit Scheduler javadoc&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;BukkitTask runTask(Plugin plugin,
                   java.lang.Runnable task)
            throws java.lang.IllegalArgumentException&lt;/p&gt;

  &lt;p&gt;Returns a task that will run on the next server tick.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In fact, it was even more confusing because we had no clue how a scheduled task could possibly be creating an endless loop, much less how players could get themselves into a situation that would cause the loop in the first place.&lt;/p&gt;

&lt;h1 id=&quot;initial-attempts&quot;&gt;Initial attempts&lt;/h1&gt;

&lt;p&gt;Since we already isolated the problem to the close event handler, we assumed that the problem would stem from the player being offline when they are told to re-open the coinflip inventory. We added in a check once the task gets run on the inside of the lambda, and then made sure that when a player leaves, they would be not be allowed to re-open the menu:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onPlayerCloseInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InventoryCloseEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;menuIsCoinflip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Schedule the inventory to be opened after the next tick&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Bukkit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getScheduler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;runTask&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isOnline&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// Tell the player to open the inventory that they closed&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onPlayerLeaveServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PlayerQuitEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Do not allow the menu to open&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;menuIsCoinflip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, this also did not work. The next morning, we found that the server crashed from the same recursive loop somehow.&lt;/p&gt;

&lt;p&gt;I then dug into the code to see what was going on behind-the-scenes. I wanted to find out why the player is still allowed to open the inventory even when they are offline. This is a snippet of code that handles the &lt;a href=&quot;https://hub.spigotmc.org/stash/projects/SPIGOT/repos/craftbukkit/browse/nms-patches/PlayerList.patch#281&quot;&gt;player’s disconnect&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-patch highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gi&quot;&gt;+        org.bukkit.craftbukkit.event.CraftEventFactory.handleInventoryCloseEvent(entityplayer);
+
+        PlayerQuitEvent playerQuitEvent = new PlayerQuitEvent(cserver.getPlayer(entityplayer), &quot;\u00A7e&quot; + entityplayer.getName() + &quot; left the game&quot;);
+        cserver.getPluginManager().callEvent(playerQuitEvent);
+        entityplayer.getBukkitEntity().disconnect(playerQuitEvent.getQuitMessage());
+
+        entityplayer.playerTick();// SPIGOT-924
+        // CraftBukkit end
+
&lt;/span&gt;         this.savePlayerFile(entityplayer);
         if (entityplayer.isPassenger()) {
             Entity entity = entityplayer.getVehicle();
&lt;span class=&quot;gu&quot;&gt;@@ -318,17 +421,67 @@
&lt;/span&gt;
         if (entityplayer1 == entityplayer) {
             this.j.remove(uuid);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are 3 things to note here:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;handleInventoryCloseEvent&lt;/code&gt; is called very early when the player disconnects&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerQuitEvent&lt;/code&gt; gets fired after that&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Player#isOnline()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Bukkit.getPlayer(...)&lt;/code&gt; provided by the &lt;code class=&quot;highlighter-rouge&quot;&gt;j&lt;/code&gt; collection will be signalled last&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This might make our online check seem useless, however, there shouldn’t be any cause for concern, because the scheduler should be scheduling the inventory close by the next tick, once the handler has fully completed and removed the player from the server… Right?&lt;/p&gt;

&lt;h1 id=&quot;nitty-gritty-of-the-scheduler&quot;&gt;Nitty Gritty of the Scheduler&lt;/h1&gt;

&lt;p&gt;We can theorize all we want. The code looks correct, but obviously that is not so because the server is still crashing for the same reason. Therefore, either we are wrong about our isolation of the problem, or our assumption about what the server is doing is wrong. However, given that the bug is very timing-dependent, and players are more likely to be leaving during the night, when the server is crashing, we concluded that our logic must have been wrong somewhere.&lt;/p&gt;

&lt;p&gt;After some more pondering and searching through the Minecraft source code, I looked over the line that calls the &lt;code class=&quot;highlighter-rouge&quot;&gt;mainThreadHeartbeat&lt;/code&gt; method in &lt;code class=&quot;highlighter-rouge&quot;&gt;CraftScheduler&lt;/code&gt;. Piqued, I looked through the source of &lt;code class=&quot;highlighter-rouge&quot;&gt;CraftScheduler&lt;/code&gt; to see what I could find.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://hub.spigotmc.org/stash/projects/SPIGOT/repos/craftbukkit/browse/src/main/java/org/bukkit/craftbukkit/scheduler/CraftScheduler.java#91&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runTask&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BukkitTask&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;runTask&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Plugin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;runTaskLater&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I thought to myself: when an inventory closes, I must be in the &lt;code class=&quot;highlighter-rouge&quot;&gt;disconnect&lt;/code&gt; method from &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerList&lt;/code&gt; above, so there can never be an instantaneous execution from this method. However, the fact that the server simply stops responding is completely contradictory to this.&lt;/p&gt;

&lt;p&gt;Then it dawned upon me.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;openInventory&lt;/code&gt; must be immediately firing &lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryCloseEvent&lt;/code&gt; when the player is offline, since it closes immediately; the player isn’t even there to open it in the first place. It doesn’t need to be going through &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerList#disconnect(...)&lt;/code&gt;. This basically invalidates all previous assumptions about the calling location of &lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryCloseEvent&lt;/code&gt;…&lt;/p&gt;

&lt;p&gt;If I immediately get back &lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryCloseEvent&lt;/code&gt; from opening the inventory, then I am not getting the event from &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerList#disconnect(...)&lt;/code&gt;… I am getting it &lt;em&gt;directly from the scheduler&lt;/em&gt;. The scheduled task is causing it to schedule more tasks, which must execute, because the scheduling loop has not finished when I run another task! In other words, &lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryCloseEvent&lt;/code&gt; causes another task to be added to the loop through the tasks in &lt;code class=&quot;highlighter-rouge&quot;&gt;mainThreadHeartbeat&lt;/code&gt;. Since we are still in a loop at this point, the loop will then come across the next task, which will then create another close event, endlessly adding tasks to the scheduling loop. &lt;code class=&quot;highlighter-rouge&quot;&gt;mainThreadHeartbeat&lt;/code&gt; never exits, and so the server doesn’t tick!&lt;/p&gt;

&lt;h1 id=&quot;fixing-the-issue&quot;&gt;Fixing The Issue&lt;/h1&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;runTask&lt;/code&gt; is a good, short method to use when not being called from within the scheduling loop. However, this risks creating an infinitely long task list. The fix to schedule for exactly 1 tick later like so:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onPlayerCloseInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InventoryCloseEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;menuIsCoinflip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Schedule the inventory to be opened after the next tick&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Bukkit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getScheduler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;runTaskLater&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;plugin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isOnline&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// Tell the player to open the inventory that they closed&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInventory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This has virtually no impact on the previous functionality. By scheduling for 1 tick later instead of the 0 ticks that the &lt;code class=&quot;highlighter-rouge&quot;&gt;runTask&lt;/code&gt; method does, we ensure that even if &lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryCloseEvent&lt;/code&gt; is fired from within the scheduling loop, it will not run within the loop that created it, but rather on the next tick. Since &lt;code class=&quot;highlighter-rouge&quot;&gt;runTask&lt;/code&gt; is usually never called from inside of the tick loop, 1 tick usually needs to pass anyways unless the task gets scheduled before the scheduling loop runs, so there’s really nothing to lose.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;The reason why it took so long for this bug to be discovered is because of the assumption I made that &lt;code class=&quot;highlighter-rouge&quot;&gt;BukkitScheduler#runTask(...)&lt;/code&gt; will always run in the tick after it is being called in. However, when the docs mention that a task will be run “run on the next server tick,” the next server tick may already be in progress, and therefore never allow for the task to leave.&lt;/p&gt;

&lt;p&gt;In hindsight, it may seem like such a stupid assumption to make, that this particular event may be fired in only in one place. How can a problem that is so face-smackingly simple get past us? We were tied up for over a week trying to figure out what made the servers crash due to this bug. The server log gave a hint that the close event listener was being fired from within the scheduler, however, I did not pick up on this. Higher up the stack, the inventory was being closed already in the task, so why should I assume that the task list is growing? I just thought that it was being run in the tick right after the close event.&lt;/p&gt;

&lt;p&gt;This little assumption, that the &lt;code class=&quot;highlighter-rouge&quot;&gt;runTask&lt;/code&gt; method would run the the tick after the task gets scheduled, led to over a week worth of head scratching and frustration. What can be done in the future about it?&lt;/p&gt;

&lt;p&gt;We’ve already got reboot scripts ready to go so servers do not experience as long as a downtime. This only fixes the effects of such bugs; but at the moment, I have no solutions to how the development pipeline can be modified to avoid this in the future. Perhaps strong assumptions about the workings of the scheduler should not be so dearly held on to. Local tests could not have reproduced this bug, tests on production servers by Gullible only turned up the bug once or twice. Theoretically, this should always be turning up when the player that joins a coinflip gets kicked or leaves the server, so why wasn’t it more common during testing? How could it have been more adequately tested?&lt;/p&gt;

&lt;p&gt;I don’t know. It’s ironic because solving this bug creates an even harder problem: how to prevent it. And I have a sneaking feeling that I will need to get around to solving it soon.&lt;/p&gt;

&lt;h1 id=&quot;additional-edit-2018-04-14-004005&quot;&gt;Additional Edit (2018-04-14 00:40:05)&lt;/h1&gt;

&lt;p&gt;Some readers may be confused as to how &lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryCloseEvent&lt;/code&gt; ends up in the same scheduling loop at all if the first instance that it is called is through &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerList#disconnect(...)&lt;/code&gt;. They reason that since &lt;code class=&quot;highlighter-rouge&quot;&gt;runTask&lt;/code&gt; already schedules for the next tick, all the cleanup would be done and the cycle would never start. The answer to that is: I really have no idea. I know that Essentials kicks players from within a task, so it’s possible that an AFK kick could be causing this, but AFK timers are disabled so I doubt that. I doubt that it is a problem from within the server, because the server doesn’t use the scheduler to process async tasks. Either way, it doesn’t matter what would cause the the loop because whatever is kicking the player is doing it correctly; the inventory itself is not being handled correctly and that is what got fixed.&lt;/p&gt;</content><author><name></name></author><summary type="html">Note: Code samples in this post have been slightly altered. I have not leaked any information from our plugins in the writing of this post</summary></entry><entry><title type="html">Those Mistakes Are Mine</title><link href="https://agenttroll.github.io/blog/2018/03/25/those-mistakes-are-mine.html" rel="alternate" type="text/html" title="Those Mistakes Are Mine" /><published>2018-03-25T01:19:25-07:00</published><updated>2018-03-25T01:19:25-07:00</updated><id>https://agenttroll.github.io/blog/2018/03/25/those-mistakes-are-mine</id><content type="html" xml:base="https://agenttroll.github.io/blog/2018/03/25/those-mistakes-are-mine.html">&lt;blockquote&gt;
  &lt;p&gt;Minions is a shit plugin&lt;/p&gt;

  &lt;p&gt;- @GulliblexD&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Minions was included as a part of the initial MineSaga release a little over 2 months ago.&lt;/p&gt;

&lt;p&gt;Depending on the way you look at it, the plugin might never make it to the grave, or it has entered it from the beginning.&lt;/p&gt;

&lt;p&gt;All the bugs in the minions plugin? Yeah. Those mistakes are mine.&lt;/p&gt;

&lt;h1 id=&quot;replication&quot;&gt;Replication&lt;/h1&gt;

&lt;p&gt;One of the hardest things to understand about the plugin is that it is exceedingly difficult to test in a reasonable time frame. It is difficult to determine how the plugin will interact &lt;em&gt;in prod&lt;/em&gt; versus in a test environment. On top of that, the internal architecture of the plugin has changed repeatedly, as have the requirements.&lt;/p&gt;

&lt;p&gt;On top of that, the minions internals deals with incredibly time-sensitive server ticking and chunk mechanics. There are no compromises made to sacrifice performance in these areas, further compounding the problems with replication. Some of the decisions I’ve made have regretfully created many, many insidious bugs that don’t show up until it is in prod.&lt;/p&gt;

&lt;p&gt;The Minecraft server behaves differently in the large monoworld that holds all the skyblock islands than it does in a server with 1-2 players that are testing it. Each incremental update introduces more features that must be tested within the spawn area and outsdide of it, inside the player vision and outside, with chunks loaded and without chunks loaded, and then again for all the modes and then serialized and tested again serialized with and without chunks loaded. The random minion disappear bug? Never been able to have chunks do that without manually unloading the chunk myself.&lt;/p&gt;

&lt;p&gt;I have spent several hours testing minions on multiple releases in order to make sure that they are bug free, but for 90% of the releases, I simply skipped this testing phase. I decided that it was not worth my time to be fruitlessly looking for some new way that the server will decide to interact with minions: only in prod deployment will effectively find the bugs that I am looking for. In hindsight, I think this has led to a lot more pressure on part of the owners and something that, admittedly, I have still yet to fix.&lt;/p&gt;

&lt;p&gt;The gist of it is that minions is doing what the Minecraft server never intended it to do. Custom entity, chunk retention, memory persistence. In the past, when I worked on TridentSDK, I was the one that wrote the entity handler code, and I was able to know exactly what would happen to entities in so and so instance. Minions was one of the first major shifts I had away from that experience because the entities that I am creating are at whim of the server, which consists of millions of lines of obfuscated code. The only real way to understand what the server is doing is to look at the effects of certain pertinent actions and make a guess about what is going on. You know, much like how people put chunk loader minions beneath their farms and then blame me for the farms not working (hint: its your hoppers!) because their experimental design sucks.&lt;/p&gt;

&lt;p&gt;As it turns out, I still have no clue where your minions are going.&lt;/p&gt;

&lt;h1 id=&quot;data-loss&quot;&gt;Data Loss&lt;/h1&gt;

&lt;p&gt;I think that there have been two major occasions where all minions were totally lost, although I’m not completely sure since I have not been shared that information (one of them being a server crash due to DDoS).&lt;/p&gt;

&lt;p&gt;The lesson to take from this, and from today’s breach is that it pays to get it right the first time.&lt;/p&gt;

&lt;p&gt;It pays to have implemented serialization safeties the first time.&lt;/p&gt;

&lt;p&gt;It pays to have implemented a way for players to &lt;code class=&quot;highlighter-rouge&quot;&gt;/minion recover&lt;/code&gt; the first time.&lt;/p&gt;

&lt;p&gt;It pays to have tested the plugin more extensively the first time.&lt;/p&gt;

&lt;p&gt;Alas, for I am only human. I make mistakes. I did/do not write much right the first time. This is true for the few other plugins I have written running on MineSaga, but I think that this is especially true for Minions, mostly for the reasons that I will be discussing in the next section.&lt;/p&gt;

&lt;p&gt;I’d say that it is even fortunate that minions was a horrible plugin at the opportune time that the server was attacked; all plugins that I’ve made since then have implemented much more meticulous data-loss prevention measures and exception handling in order to salvage data if needed. Perhaps if the server was hit a little later down the road, the results might have been different had I not had this experience to learn from.&lt;/p&gt;

&lt;h1 id=&quot;complexity&quot;&gt;Complexity&lt;/h1&gt;

&lt;p&gt;I’ll reiterate again that what minions does, the Minecraft server was never designed to handle. The minions themselves are basically just zombie entities that I “tricked” into emulating the functions of a player. On top of that, there are many technicalities that I never foresaw, most notably the way that blocks moved by pistons are handled. For those that aren’t aware, blocks moved by pistons are temporarily turned into “a part of the piston” (I suppose?). This had to be blacklisted from minions in order for blocks pushed by them to be handled correctly. As it turns out, it also only happens with level 2 minions due to their faster mining speed (another function that required many, many hours of thought and experimentation to get down) and how it syncs with the speed at which cobble is generated and pushed by the piston.&lt;/p&gt;

&lt;p&gt;In another case, the attacking modes require chest checks in order for the minion to halt attacking if the inventory is full. As it turns out, there is no way to “test” if the item fits without doing a huge if/else chain, and so the item is eager-added to the chest and checked for inclusion. This works will for mining modes, where the items are deterministic, but for entity drops, it is harder to deal with. The simplest way to do this was to constantly check if there is an extra slot in the chest, because I’m not going to spawn another entity if those drops fail to get placed into the chest.&lt;/p&gt;

&lt;p&gt;Each component extends and creates its own problems because there are many “moving parts” interacting with each other in order to create the minions. These components are at worst hacks, and at best, “clever workarounds” to circumvent the Minecraft server. This makes it difficult to test and difficult to verify, inducing bugs all over the place. On the contrary, other plugins such as Quests and Points are basically a simple back-end infrastructure to handle a few additional variables and accomodations for menus, which are well-understood and have been tried and tested multitudes of times. Not so much for the very niche functions that minions try to emulate.&lt;/p&gt;

&lt;h1 id=&quot;high-maintenence-cost&quot;&gt;High Maintenence Cost&lt;/h1&gt;

&lt;p&gt;Lastly, minions not only has problems of its own, but it creates problems for others. From falling into the void, duplicating randomly, not serializing correctly, and simply disappearing into thin air, there are so many issues with it that &lt;em&gt;other&lt;/em&gt; people had to deal with as well. It created hardships for the ownership team, who had to handle all these cases and compensate players for missing minions - they are, after all, paid with IRL money - and created hardships for the rest of the staff team, who had to relay and deal with issues they were not familiar with on a daily basis as a result of players asking about their minions.&lt;/p&gt;

&lt;p&gt;One of the things that I kept falling into was the notion that the “minions update” will be a good time to fix all these issues and basically turn minions into an actually functional plugin. In hindsight, however, I’d say that my decision to continue putting time into getting out updates and fixing bugs was a much more prudent course of action than if I had waited. I know this put an additional burden on the owners, who had to update the plugin endlessly on each realm, but I honestly am glad that I put them through that. Although the players may not like having a buggy plugin all the time, I think that without having such a short development pipeline most definitely prevented future grievences. I really have learned a whole lot about entities, having been able to experiment and verify bugs reported by players, and if not now, bugs of a similar vein might come up later on. Future plugins may be written faster and more bug-free as a result of having already done these tests and made changes that are verifiably functional.&lt;/p&gt;

&lt;h1 id=&quot;closing-words&quot;&gt;Closing Words&lt;/h1&gt;

&lt;p&gt;I know that there have been (many) problems with minions. I know that it’s a massive waste of time to deal with the side effects of it. The owners know it too, and when it is said that “minions is a shit plugin,” it is said only half-jokingly, because the reality is that there were many things wrong with it, and there will still be many things to come that I haven’t spotted yet.&lt;/p&gt;

&lt;p&gt;Yet on the other hand, given the circumstances, I don’t think minions is a bad plugin. Of course, I wrote it, so there’s no reason for me to think that it is. I think that it is a really nifty concept, and there’s always a worse place the plugin could be compared to where it is/has been. There have only been 2 instances where minions didn’t do what they were supposed to do for players, and both times were when blocks were being pushed by pistons. All taken, I would say that it was a relative success in spite of the significant number of bumps in the road.&lt;/p&gt;</content><author><name></name></author><summary type="html">Minions is a shit plugin - @GulliblexD</summary></entry><entry><title type="html">Increasing The Player Count</title><link href="https://agenttroll.github.io/blog/2018/03/03/increasing-the-player-count.html" rel="alternate" type="text/html" title="Increasing The Player Count" /><published>2018-03-03T00:19:40-08:00</published><updated>2018-03-03T00:19:40-08:00</updated><id>https://agenttroll.github.io/blog/2018/03/03/increasing-the-player-count</id><content type="html" xml:base="https://agenttroll.github.io/blog/2018/03/03/increasing-the-player-count.html">&lt;p&gt;Gosh its been a while actually for a 2 things: firstly, the 1 year anniversary of the first post on this blog is fast approaching, and two, I’ve been with Intermissum for around 6 months now.&lt;/p&gt;

&lt;p&gt;Speaking of Intermissum, we’ve been growing well over the past month and some that we’ve released. The player average is a good 550 to 600 depending on the day and and the time, and the most recent 2 realms, Western and Jurassic have been at absolute capacity almost every day for the past week or so. Which brings me to my next point…&lt;/p&gt;

&lt;p&gt;We’ve been asked MULTITUDES of times to increase the player count on the Western realm, the most popular server:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-1.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-2.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-3.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-4.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-5.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-6.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-7.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-8.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-9.png&quot; alt=&quot;more slots&quot; /&gt;&lt;/p&gt;

&lt;p&gt;No means no you guys.&lt;/p&gt;

&lt;h1 id=&quot;performance&quot;&gt;Performance&lt;/h1&gt;

&lt;p&gt;What some people have a hard time understanding is that the player count is basically the root of all performance problems on a server. The reason why the server experiences lag and missed ticks is because there are too many people online at a time. What makes this issue even worse is that the Western realm is a farm/crop based economy, which means that on top of all the players, the server must also handle the monolithic farms that people are building.&lt;/p&gt;

&lt;p&gt;Our first important point: &lt;strong&gt;The effect of adding more slots amplifies the strain on the server produced by resources associated with that player&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The slot limit on each realm is not “just a number.” A player joining a server is not as simple as incrementing some imaginary counter. Each player consumes a LARGE amount of resources needed to support the experience provided by the server: chunks loaded, net IO handled, ALL crops on that player’s island being ticked, etc…&lt;/p&gt;

&lt;p&gt;Since I do not have exact chunk-loading stats on hand at the time of writing, I’ll use a very conservative figure of entities produced by all the islands to estimate the impact of adding more slots. At any given time, the Western &lt;code class=&quot;highlighter-rouge&quot;&gt;Islands&lt;/code&gt; world contains around 16,000 entities, which might not sound like much (indeed, as it is not much at all), but hang with me here. Given the 200 player capacity, that’s 80 entities loaded per player, the conservative estimate compensating for players loading the same entities (i.e. players on the same island).&lt;/p&gt;

&lt;p&gt;Say that we bump up a “small” 25 additional slots. That means loading an additional 2000 entities on the server - and that’s just 25 players!&lt;/p&gt;

&lt;p&gt;The point I’m trying to communicate here is that if the server load is thought of in terms of resources that each player takes up, instead of the “few slots” increase, we are actually compounding the increase by a factor of 80 for each additional player.&lt;/p&gt;

&lt;p&gt;Now again, we are just estimating here, and each player does not actually amplify the load placed on the server by a factor of 80 (it is much less). However, it goes to show my point that players are expensive not in themselves, but rather in their effects.&lt;/p&gt;

&lt;p&gt;In fact, to further demonstrate my point, let us not use entities (which are a better representation of the resources associated with a player because players are a subset of entities), but rather blocks. A chunk consists of a 16x16x256 section of blocks, 65536 in total. To make our calculations easier, let us assume that only about 1/12 of those blocks are actually cacti, making a single chunk require 5461 cacti to tick. A player loads around 150 chunks on a server, depending on the limits set by the owner, but for ease of calcualation, let us assume that a player only loads 25 chunks worth of cactus farm. Then, adding a single player will not only require the server to handle an additional player, but also 136525 worth of cacti to grow, 20 times in a single second! Accounting for players who are not loading their whole cactus farm and those whose farms are far larger, a reasonable estimate for the number of cacti to process comes out to about 100k times 225, or about 22,500,000 blocks.&lt;/p&gt;

&lt;h1 id=&quot;user-experience&quot;&gt;User Experience&lt;/h1&gt;

&lt;p&gt;Secondly, while I am not going to disclose exact stats, the server for sure does not run at 20 TPS, even capped at 200 players. There is a very simple reason here:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The server has a limited amount of time to complete tasks&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The age of cacti is incrememnted randomly 20 times per second, each tick that the server runs. If all the cacti on the server have been processed before the end of the tick, that’s good! The server will in fact, pause and not do anything until the beginning of the next tick, where all the cacti will again be processed, and so on.&lt;/p&gt;

&lt;p&gt;Things get a little more complicated when the amount of time needed to complete the task overruns the time allocated to the tick. In the space of 20 seconds, 400 ticks &lt;em&gt;should&lt;/em&gt; be run. However, if each tick overruns itself by, oh, an extra tick, then only 200 ticks will be run in that same amount of time. This means that 200 ticks are “lost” because there was only enough time to increase the age of each block the first 200 times.&lt;/p&gt;

&lt;p&gt;Why is this important?&lt;/p&gt;

&lt;p&gt;The crops are already growing at about half speed.&lt;/p&gt;

&lt;p&gt;By adding more players, the effect is that crops will slow down. There is no limit to the amount of slowdown that can be acheived as long as no player disconnects from the server. As each tick takes longer and longer, it is possible for it to overrun 1 second, 2 seconds, etc…&lt;/p&gt;

&lt;p&gt;The argument here is that your crops all seem to grow slowly because all the other players are taking care of and loading in these humongous farms (22,500,000 blocks to be more preceise). Adding more players will also slow down your crops even more.&lt;/p&gt;

&lt;p&gt;When people think selfishly and want only their singular goal to be fulfilled, it detriments the experience of others who are waiting for their crops to grow, and eventaully, when you yourself finally do join the server thanks to the 500 player cap, you will be complaining about how the crops don’t grow at all.&lt;/p&gt;

&lt;h1 id=&quot;server-hardware&quot;&gt;Server Hardware&lt;/h1&gt;

&lt;p&gt;So why not get a better computer?&lt;/p&gt;

&lt;p&gt;Unfortunately &lt;strong&gt;the server runs on the highest tier hardware available to us&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/increasing-player-count-10.png&quot; alt=&quot;less slots&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;queueing&quot;&gt;Queueing&lt;/h1&gt;

&lt;p&gt;People have been having problems joining full realms because, well, they’re full &lt;em&gt;all the time&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;So instead of having people stand and try to spam click on the Western NPC, a queue was implemented to allow players to wait to be teleported to the realm.&lt;/p&gt;

&lt;p&gt;Now, the problem isn’t that the server is full all the time, it’s that peoples’ place in the queue don’t change, or even go up.&lt;/p&gt;

&lt;p&gt;Then there’s people who buy the Buckaroo rank and think they’re supposed to be 1st in the queue.&lt;/p&gt;

&lt;p&gt;The queue prioritizes staff members, youtubers, donators &lt;em&gt;descending by rank&lt;/em&gt;, and finally regular players. Bought a rank but not 1st in line? Thanks for supporting us. But you’ll have to wait your turn. This order helps benefit &lt;em&gt;all parties&lt;/em&gt; involved:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Owners/developers/admins/most lower-level staff do not play the game, we’re here purely to help people and to moderate&lt;/li&gt;
  &lt;li&gt;YouTubers bring content to the community and bring the community to us, growing our own revenue base and supporting content that goes directly back to players&lt;/li&gt;
  &lt;li&gt;Donators are in the same deal as with YouTubers&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Donators are also queued by rank as well. I’m not an economist, but this is just basic economic theory: scarcity of resources (i.e. player slots), money is a medium through which access to limited resources is controlled. It sounds P2W and all, but it is not; everyone is paying to wait in line (“except” for upper-level staff). Those who have more money gain access to the “limited resource” (i.e. player slot) first, because they have helped support the server more. In the end, everyone has the chance to access the server. On top of that, Western is not a donator-only realm. There are several non-ranked players who play on Western even at peak hours, which means that even the lowest ranked players have the opportunity to join the server.&lt;/p&gt;

&lt;p&gt;Finally, a kick-based model will never be used in the forseeable future. In this model, players are kicked out rather than having to wait if there are not enough slots. This is a horrendous and unfair system that makes joining the server totally P2W. Based on the number of donators on Western, it would be easy to kick out ALL non-ranked players, if not a large number of the lower-ranked players as well. Then, the complaint will not be that the queue is too long; it will be that people are getting “randomly kicked” and that the system is “unfair” because rich people still have the advantage. If the queue model is P2W, then the kick model will be even more so.&lt;/p&gt;

&lt;p&gt;Yeah, we’re sticking with the queue system.&lt;/p&gt;

&lt;h1 id=&quot;closing-thoughts&quot;&gt;Closing Thoughts&lt;/h1&gt;

&lt;p&gt;I hoped that through my endless rambling and criticism that I’ve cleared up some thoughts that people have had regarding the slot availability on MineSaga. We are not going to increase the slots or get rid of the queue because it is simply the most effective way that we have so far to manage the limited resources availible to the server.&lt;/p&gt;

&lt;p&gt;There have been multiple discussions privately about how to distribute computing power and divide up how the different realms and islands are managed. I do not feel comfortable sharing those details without approval so they remain purely for speculation at the moment. Stay tuned! :)&lt;/p&gt;</content><author><name></name></author><summary type="html">Gosh its been a while actually for a 2 things: firstly, the 1 year anniversary of the first post on this blog is fast approaching, and two, I’ve been with Intermissum for around 6 months now.</summary></entry><entry><title type="html">Status Update: Installing Arch for the First Time</title><link href="https://agenttroll.github.io/blog/2018/01/06/status-update-installing-arch-for-the-first-time.html" rel="alternate" type="text/html" title="Status Update: Installing Arch for the First Time" /><published>2018-01-05T23:00:00-08:00</published><updated>2018-01-05T23:00:00-08:00</updated><id>https://agenttroll.github.io/blog/2018/01/06/status-update-installing-arch-for-the-first-time</id><content type="html" xml:base="https://agenttroll.github.io/blog/2018/01/06/status-update-installing-arch-for-the-first-time.html">&lt;p&gt;It’s been draining on the soul, but luckily coming up with a “unique” title has been rejuvenating (rejuvinatig? rejuvenating? whatever).&lt;/p&gt;

&lt;p&gt;I don’t profess to be an expert on ArchLinux, or even Linux in general but based on my experience installing Arch on my MacBook Pro 11.something, I’d be even more wary of following a random blog post (because it probably won’t work). I don’t think any of the issues that I encountered were unique by any means, but I believe my own little successes are the result of the wealth of mainly online resources. I’m therefore very keen to share my own experience and perhaps someone might come along and save a few hours of their lifetime and hair-tearing.&lt;/p&gt;

&lt;h1 id=&quot;getting-over-the-hurdle&quot;&gt;Getting Over the Hurdle&lt;/h1&gt;

&lt;p&gt;For me, the primary challenge in the first place was connecting to the Internet. To go along with that, my MacBook carries with it a Broadcom Wireless interface, which requires a proprietary driver in order to work correctly. Fortunately, it was just the right hardware that happened to work with the proprietary driver. Unfortunately, the driver requires the Internet to obtain, and my USB was all occupied with carrying the bootable ISO. Therefore, the only way I can get the required packages is by exiting the Arch CLI and manually downloading on macOS, then going back and mounting whatever partition on which I downloaded the package.&lt;/p&gt;

&lt;p&gt;First lesson here: it is impossible to install Arch without access to another installation with Internet. Let me repeat that: &lt;strong&gt;IMPOSSIBLE&lt;/strong&gt;. If you are rich and can buy an ethernet/thunderbolt adapter, go nuts, save yourself some time. Otherwise, you must at least have a VM that boots the Arch ISO in order to download the packages. I’ll spare the gory details of trying to compile &lt;code class=&quot;highlighter-rouge&quot;&gt;broadcom-wl&lt;/code&gt;, which consisted of failing to compile due to Internet requirements, not realizing that you can’t get the right kernel version without rebooting, and thinking that &lt;code class=&quot;highlighter-rouge&quot;&gt;mkinitcpio&lt;/code&gt; will save my butt (It didn’t).&lt;/p&gt;

&lt;p&gt;Secondly, to install packages on a different computer, you must A) Know how how to install Arch B) Get the built packages and C) Get those packages onto the laptop. Honestly, I messed up enough times without Internet access in the first place just dealing with A: formatting the wrong partition (luckily the USB /dev/sdb) multiple times before I figured out why my bootable USB wasn’t bootable anymore, dealing with &lt;code class=&quot;highlighter-rouge&quot;&gt;mount -o force ...&lt;/code&gt; in order to be able to write, and forgetting to mount the target partition. Needless to say, there was lots of &lt;code class=&quot;highlighter-rouge&quot;&gt;rm -fR /&lt;/code&gt;, but at the same time, the repetition drilled in deep the commands required, so I got faster and faster at failing. Better to fail quickly than slowly I suppose.&lt;/p&gt;

&lt;p&gt;In short, the process went something like so for me: mount temp partition from the VirtualBox “disk,” then run the following:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pacman &lt;span class=&quot;nt&quot;&gt;-Sy&lt;/span&gt;
pacman &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--cachdir&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--dbpath&lt;/span&gt; /tmp base base-devel linux-headers broadcom-wl-dkms wpa_supplicant
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then transfer the all the .pkg files onto macOS using nc. Once I have them, I can then put them on a mounted transfer partition that I used to access those files more easily from the boot CLI.&lt;/p&gt;

&lt;h1 id=&quot;finally-installation&quot;&gt;Finally, Installation&lt;/h1&gt;
&lt;p&gt;The truth is that in order to install the base system, one only needs the base package, and that’s it. In short, you need to do the following in order to “install” Arch:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cgdisk&lt;/code&gt; and format the partition&lt;/li&gt;
  &lt;li&gt;Mount desired partition&lt;/li&gt;
  &lt;li&gt;Mount the &lt;code class=&quot;highlighter-rouge&quot;&gt;/boot&lt;/code&gt; partition&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pacstrap&lt;/code&gt; the desired repo with the base arg&lt;/li&gt;
  &lt;li&gt;Chroot into the mount dir&lt;/li&gt;
  &lt;li&gt;Create &lt;code class=&quot;highlighter-rouge&quot;&gt;systemd-boot&lt;/code&gt; entry for the correct partition&lt;/li&gt;
  &lt;li&gt;Reboot&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I won’t go into specifics here, since firstly I’m not a very good source of info and secondly, because these are quite easy steps that you can find on the Internet. Again, needless to say, I messed up on multiple occaisions here: &lt;code class=&quot;highlighter-rouge&quot;&gt;cgdisk&lt;/code&gt; on the wrong disk, forgetting to mount &lt;code class=&quot;highlighter-rouge&quot;&gt;/boot&lt;/code&gt; and ending up with an unbootable system, writing the wrong partition UUID to &lt;code class=&quot;highlighter-rouge&quot;&gt;systemd-boot&lt;/code&gt;, etc…&lt;/p&gt;

&lt;p&gt;It is absolutely vital that you are able to reboot. This is the only way that you can update to the correct kernel version and access your modules, and I guarantee that a successful boot is the most important milestone here, even if you aren’t able to connect to the WiFi quite yet.&lt;/p&gt;

&lt;h1 id=&quot;the-wifi-problem&quot;&gt;The WiFi Problem&lt;/h1&gt;

&lt;p&gt;Back to our initial issue, although we have Arch installed without using the Internet on the target machine, we still do not have Internet access. Luckily, having the &lt;code class=&quot;highlighter-rouge&quot;&gt;broadcom-wl-dkms&lt;/code&gt; file on our transfer partition, we can &lt;code class=&quot;highlighter-rouge&quot;&gt;pacman -S&lt;/code&gt; that very easily. Having already confirmed that the kernel has been updated, we can safely restart and see through &lt;code class=&quot;highlighter-rouge&quot;&gt;ip a&lt;/code&gt; that the driver has successfully detected the network interface - a good sign.&lt;/p&gt;

&lt;p&gt;For me, this all happened at school, where the WiFi setup was a little more complicated since we used WPA Enterprise, so I had to wait until I got home.&lt;/p&gt;

&lt;p&gt;The good news came late at night, when I was toying with &lt;code class=&quot;highlighter-rouge&quot;&gt;wpa_supplicant&lt;/code&gt;. I was able to use &lt;code class=&quot;highlighter-rouge&quot;&gt;wpa_password&lt;/code&gt; to generate the config, but not realizing that I needed to also set the &lt;code class=&quot;highlighter-rouge&quot;&gt;ap_scan&lt;/code&gt; and ssid scan in order to detect my network (which had SSID masking enabled), I was finally able to connect to the Internet. Content with Internet access for the time being, I got to installing and setting up a few other personal neccessities:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Xorg&lt;/li&gt;
  &lt;li&gt;Display Manager (LightDM)
    &lt;ul&gt;
      &lt;li&gt;Careful, you also need the locker (I used gtk) for it to work!&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;i3wm, dmenu&lt;/li&gt;
  &lt;li&gt;Users&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;chromium&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;xfce4-terminal&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;But since the entire idea of my laptop was that it was portable, and I already had a well-established Debain computer at home, I was bent on getting WiFi to work at my school. That wouldn’t happen for another several weeks though; it was winter break, and I didn’t plan on going to school at all to test whether or not my config worked.&lt;/p&gt;

&lt;h1 id=&quot;the-breakthrough&quot;&gt;The Breakthrough&lt;/h1&gt;

&lt;p&gt;It takes only a few seconds to look at the massive variety in responses to the “proper” config for WPA Enterprise one can find on Google, but as it turns out, whatever people say “works for them” is very blatantly BS. The config depends entirely on the network, and there is no way around having to try out different combinations of “WPA-EAP/IEEE801X…” and “CCMP/TKIP/…” and other options that I still have no interest in. However, recalling that I have a handy MacBook, I booted into macOS to see if I can get some hints by connecting to the WiFi, which I already knew worked splendidly without any hassle. From there, I knew that I could use “WPA-EAP” and “PEAP” options, and the rest goes guess-and-check.&lt;/p&gt;

&lt;p&gt;For my own future reference, this is what I used:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Description='Automatically generated profile by wifi-menu'
Interface=wlp2s0
Connection=wireless
Security=wpa-configsection
ESSID=$SSID
IP=dhcp
WPAConfigSection=(
        'ssid=&quot;$SSID&quot;'
        'proto=RSN'
        'key_mgmt=WPA-EAP'
        'eap=PEAP'
        'identity=&quot;$USERNAME&quot;'
        'password=&quot;$PASSWORD&quot;'
        'phase1=&quot;peaplabel=auto peapver=0&quot;'
        'phase2=&quot;auth=MSCHAPV2&quot;'
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;final-thoughts&quot;&gt;Final Thoughts&lt;/h1&gt;

&lt;p&gt;Although trying a CLI-based install for the first time was an interesting experience, and I felt like I learned a lot from it compared to a more graphical nod that Debian takes, it still was frustrating and uncooperative even at the best of times. I’m happy with the end result, even if it’s not perfect though, and as always, the pleasure and satisfaction that comes with finally wrangling something to work is much more powerful than the ordeal that it takes to acheive that.&lt;/p&gt;

&lt;p&gt;Although it &lt;em&gt;would&lt;/em&gt; be nice if I could actually see anything, I still haven’t figured out that HiDPI thing yet…&lt;/p&gt;</content><author><name></name></author><summary type="html">It’s been draining on the soul, but luckily coming up with a “unique” title has been rejuvenating (rejuvinatig? rejuvenating? whatever).</summary></entry><entry><title type="html">New Years: Productivity</title><link href="https://agenttroll.github.io/blog/2017/12/31/new-years-productivity.html" rel="alternate" type="text/html" title="New Years: Productivity" /><published>2017-12-30T23:00:00-08:00</published><updated>2017-12-30T23:00:00-08:00</updated><id>https://agenttroll.github.io/blog/2017/12/31/new-years-productivity</id><content type="html" xml:base="https://agenttroll.github.io/blog/2017/12/31/new-years-productivity.html">&lt;p&gt;Perhaps we can take some time to look at productivity, in spirit of the (Eve of) New Year.&lt;/p&gt;

&lt;p&gt;Probably the most ironic thing about productivity is that discussing productivity is unproductive in itself. Sure, it’s great food for thought, but at the same time, let us consider that 1) you will read this and do nothing about it and 2) productivity is subjective. In fact, #1 probably isn’t even your fault; maybe you’ve already fixed whatever issue arose from that facet of productivity, or maybe it doesn’t even apply to you. I’m not saying that you aren’t lazy and stubborn, because you probably are as well. At least something might occur to you that has not before even if you won’t do anything about your own productivity after reading.&lt;/p&gt;

&lt;h1 id=&quot;what-does-it-mean-to-be-productive&quot;&gt;What Does It Mean to Be Productive?&lt;/h1&gt;

&lt;p&gt;In my view, there are two main types of productivity: problem-solving productivity and programming productivity. The former deals with solving problems and working out bugs, while the latter deals with literally writing out code more quickly. There’s a lot of overlap in terms of “working on a computer” in general, but for the most part, I will be touching on the latter form of productivity. The issue with dealing with the former is that problem-solving is almost purely mental gymnastics; some people “are just better” at solving problems than other people.&lt;/p&gt;

&lt;p&gt;I mean, in actuality, I don’t even know that much about productivity, I’m simply distributing my opinion based on my experience. So although I can’t help you in the solving-problems area, I’m sure it’s not the end of the line for you.&lt;/p&gt;

&lt;p&gt;There’s lots of debate on who might be a better programmer, the one who is good at problem solving, or the fast programmer. In an ideal world, you’d want someone to be strong in both areas, but there is a sort of division of labor between debuggers and programmers respectively in some cases. While I think that it is an interesting point of discussion, it’s out of scope of what will be covered here.&lt;/p&gt;

&lt;p&gt;To further elaborate on our topic of discussion, being “productive” in context means that you are able to edit code efficiently. You are able to put your ideas “onto paper” or out of your head and into an editor quickly. Assuming that you have the problem solved yourself, you’re able to “take action,” that is, you are not simply sitting at your chair staring at your code when you have your ideas down already.&lt;/p&gt;

&lt;p&gt;Keep in mind that productivity also depends on the person: there are lots of things (i.e. colors) that are based on preferences, and almost nothing is based on hard data or science. The idea behind productivity is to find what works for &lt;em&gt;you&lt;/em&gt;. I’m simply here to offer my own preferences and use myself as an example to what facets of productivity might be improved if things were different.&lt;/p&gt;

&lt;p&gt;Without further ado…&lt;/p&gt;

&lt;h1 id=&quot;touch-typing&quot;&gt;Touch-typing&lt;/h1&gt;

&lt;p&gt;The ultimate limit to how quickly you can write code is your typing speed. You cannot get faster at actually writing code if you can’t type very quickly. While autocomplete is a godsend to those who cannot type as quickly, it still pays to type more quickly and get what little you are typing in the first place done quickly. There are numerous online programs and websites that can help a slow typist, whether it be 10fastfingers or keybr or others. It also helps to type special symbols, such as in Java: &lt;code class=&quot;highlighter-rouge&quot;&gt;(){}&quot;\^&amp;amp;*+-&lt;/code&gt; and others.&lt;/p&gt;

&lt;h1 id=&quot;monitor-size&quot;&gt;Monitor Size&lt;/h1&gt;
&lt;p&gt;There’s also lots of debate on the best size of monitor, the best multi-monitor setup, etc…&lt;/p&gt;

&lt;p&gt;However, there is a lot of data that support the idea that humans are terrible multitaskers. The thing is that if you want to write code faster, you must be in your editor as much as possible, that means no browser open with the docs, your StackOverflow question, your GitHub milestone, whatever. If you work sequentially, as in you exclusively process what you have to do, then exclusively work on writing code, and then switching as necessary, you will find that you will be able to work much more quickly than if you looked through, say, the StackOverflow question as you forget key details while within your editor.&lt;/p&gt;

&lt;p&gt;That also means that your monitor, and by extension, your &lt;strong&gt;total screen estate&lt;/strong&gt; should be kept ot a minimum, while not being too small as to make it difficult or to require effort to read whatever you have written. The way I see it: toss your 2 additional monitors and settle with a single-monitor setup.&lt;/p&gt;

&lt;p&gt;Again, for me personally, the best monitor size is around a 24” (a little over 60 cm) diagonal on a 16:10. This way, I can fit a substantial amount of text and therefore be able to navigate more efficiently across larger distances, but at the same time, I do not need to change where I am looking at in order to see the edges of the screen. And yet again, this is not an exact science, but try to look for a monitor that is just large enough for your peripheral vision to process what is at the edge of your screen. If you are completely torn between two screen sizes, I’d go with the smaller screen, because over the long term, you will be focused on what you write anyways rather than anything surrounding it.&lt;/p&gt;

&lt;p&gt;To continue adding on to the focus idea, I would also recommend turning off music, at least why you are programming. There are some people who are unsettled by silence, but the fact that you are noticing silence or conversely, the music itself, means that you are not completley focused on the programming task. You probably won’t get rid of your music, and again, I don’t have any hard data to back me up on productivity with or without background noise, but going off the focus logic, it makes more sense to work in silence. Perhaps console yourself with the continous sound from your 100 decibel mechanical keyboard otherwise (just kidding, I do not condone replacing your keyboard with a jet engine).&lt;/p&gt;

&lt;h1 id=&quot;font&quot;&gt;Font&lt;/h1&gt;

&lt;p&gt;The code you write is literally written in the font that you are using, so it pays to use a font that is comfortable to the eye. There are tons and tons of good fonts out there, some meticulously designed, others based more on stylistic preference. I personally use a lot of Monaco, but many people use a less playful font like Menlo or a very blocky monospace. Whatever it is, you should have no trouble reading large amounts of text written in your selected font. You should avoid fonts that are too small or have poor balance although again, preference trumps pretty much everything so just be sure to get yourself a good font.&lt;/p&gt;

&lt;h1 id=&quot;editor&quot;&gt;Editor&lt;/h1&gt;

&lt;p&gt;Another productivity-booster is the editor that you use. For me, I use a combination of IntelliJ IDEA/IdeaViM and ViM. What made the difference was that Eclipse was too slow and its auto-completion was nowhere close to IDEA’s in terms of speed or intelligence. IntelliJ actually shows me that over a 3 month period, I had saved 100K characters from being typed, which is an astounding amount of time saved through auto-complete. Again, I’m not saying that you should switch editors, but that is by far one of the most effective productivity-booster for me.&lt;/p&gt;

&lt;p&gt;Secondly, ViM and counterparts, the whole idea of avoiding using your mouse is also very effective once you become used to the different mode of navigation. The fact is that using your mouse requires a very precise movement in comparison with the more granular keyboard-based movement that ViM is capable of. To add on to that, you must also remove one hand from the keyboard in order to move the mouse, and then place your hand again on the keyboard, and enough of these actions will eventually add up to a significant amount of time that could be saved remaining in the home position. Although it had/has a steep learning curve for me personally, I think that using IdeaViM has saved me on the magnitude of hours in the past few months from reaching for the mouse. I use ViM for most of my text-editing nowadays and the way I see it, “text-editing has never been better.”&lt;/p&gt;

&lt;p&gt;The one thing I have against ViM is that its support for Java is practically non-existant &lt;strong&gt;relative&lt;/strong&gt; at least to IntelliJ IDEA. The code completion is not as good and lacking IntelliSense and the more advanced features such as viewing documentation, library source code, Git/Maven wrappers, etc… will kill productivity. Instead of bringing Java to ViM, bring ViM to Java as said somewhere on the Internet.&lt;/p&gt;

&lt;h1 id=&quot;colors&quot;&gt;Colors&lt;/h1&gt;

&lt;p&gt;The color palette is also important for productivity. By using a more preferable palette, you will reduce your overall fatigue and increase your endurance for writing code efficiently. Avoid using a harsh, very light, flashy color palette. Many, many developers tend to prefer a high-contrast dark theme for their editors and environment backgrounds, because it makes the text both easy to read and easy on the eyes. These can be found on Google, along with other common “dark” themes such as Solarized. I use a slightly modified Google Code syntax on a grey background, although the contrast is exceedingly poor, it’s just that I haven’t found time to change it in the past, oh, 3 years. You probably won’t change your background either, so I don’t feel exceedingly bad about it myself.&lt;/p&gt;

&lt;p&gt;I say contrast is important because although it serves to detriment the general “easy-on-the-eyes” gospel, it will make it much easier to actually see the text. Over time, it’s more typical for eye strain to occur on text that is difficult to see than text that is “a harsh color.” Further, people using programs such as f.lux and redshift will have a difficult time reading the text if there is little contrast, which becomes more compounded as the color temperature decreases.&lt;/p&gt;

&lt;h1 id=&quot;breaks&quot;&gt;Breaks&lt;/h1&gt;

&lt;p&gt;Sitting at a computer and programming in itself is physically and mentally taxing. It is an absolute necessity to completely stop and take a break once in a while, no matter how close you are to “solving that one bug.” Looking a monitor for extended periods of times is strenuous on the eyes, poor for the back, and wreaks havoc on your hands and shoulders. You must also remain hydrated and satiated, and on top of that, you cannot solve problems effectively while at the same time being distracted by what is on your computer screen. Not only can you improve your productivity but having a self-check once in a while, but you will also become a better problem-solver if you do not continue to attack a problem in the same way you have the past 3 hours you have been sitting in an office chair.&lt;/p&gt;

&lt;p&gt;Stand up, stretch, drink some water, give your eyes a break, give your mind some time to relax. Over time, you will lose focus anyways, and giving yourself a break and continue to do something productive and healthy for your body is the absolute least that you can do rather than suffer from over-exerting yourself. I personally take a break whenever I feel the need to go use the restroom, and I immediately drink another cup of water so that I would be guaranteed to need to take a break in the future. What works for a lot of people, not just for software engineers but also students and other places that require long periods of focus is to take a 10-15 minute break every hour.&lt;/p&gt;

&lt;p&gt;Indeed, it may seem like a loss and counterproductive - exactly what we are fighting here - but trust me when I say that breaks are necessary to be productive. The hardest part about taking breaks is making sure you get back after treating yourself a bit. If you can at least keep yourself disciplined, then it should be no problem, incorporating breaks into your schedule should slowly, but surely improve your productivity.&lt;/p&gt;

&lt;h1 id=&quot;final-word&quot;&gt;Final Word&lt;/h1&gt;
&lt;p&gt;I’m sure there are many other factors that I’ve missed which could be vital to productivity, and I acknowledge that “programming productivity” isn’t the entire story. However, with the above noted thoughts on how I improved my own productivity over the years, perhaps the reader might at least have some background on how (yet another) developer works.&lt;/p&gt;</content><author><name></name></author><summary type="html">Perhaps we can take some time to look at productivity, in spirit of the (Eve of) New Year.</summary></entry><entry><title type="html">Multi Conditionals</title><link href="https://agenttroll.github.io/blog/2017/12/21/multi-conditionals.html" rel="alternate" type="text/html" title="Multi Conditionals" /><published>2017-12-21T00:00:00-08:00</published><updated>2017-12-21T00:00:00-08:00</updated><id>https://agenttroll.github.io/blog/2017/12/21/multi-conditionals</id><content type="html" xml:base="https://agenttroll.github.io/blog/2017/12/21/multi-conditionals.html">&lt;p&gt;There have been actually several times as I’m writing servers in things like my JDB project and the TridentSDK project in which the following scenario pops up: there is a single thread that manages incoming and outgoing messages. I need to block on an outgoing queue, as well as block until some bytes off the network are read.&lt;/p&gt;

&lt;p&gt;My situation looks something like the following:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;BlockingQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;incoming&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BlockingQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;outgoing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasInput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Read into incoming&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outgoing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Write from outgoing&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// Block, wait for input or output&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hasInput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;waitForInput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;writeToOutput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Message consumers will block on the &lt;code class=&quot;highlighter-rouge&quot;&gt;incoming&lt;/code&gt; queue and wait for input from the socket to be read by the I/O loop in order to process those messages.&lt;/p&gt;

&lt;p&gt;Given this scenario, how might the I/O loop be implemented in order to block on network input as well as the &lt;code class=&quot;highlighter-rouge&quot;&gt;outgoing&lt;/code&gt; queue and wait until either of the two have I/O tasks to execute?&lt;/p&gt;

&lt;h1 id=&quot;naive-solution-subsequent-takes&quot;&gt;Naive Solution: Subsequent &lt;code class=&quot;highlighter-rouge&quot;&gt;take()&lt;/code&gt;s&lt;/h1&gt;

&lt;p&gt;A simple, first-thought, although naive solution might look something like the following:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;waitForInput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;incoming&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;outgoing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;writeToOutput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will not work correctly. Because the loop must wait for input, the second blocking method, &lt;code class=&quot;highlighter-rouge&quot;&gt;outgoing.take()&lt;/code&gt;, will not be reached until a message is received. Therefore, a message that is queued to be sent cannot be unless something is received first - and what if the client is written in the same way? There will be a deadlock because the client must depend on input from the server in order to send a message, but the server is in fact also waiting to receive a message that will never come from the waiting client.&lt;/p&gt;

&lt;p&gt;So it can be seen that this method both does not work as intended and will cause risks with client-server deadlock.&lt;/p&gt;

&lt;h1 id=&quot;naive-solution-single-lockcondition&quot;&gt;Naive Solution: Single lock/Condition&lt;/h1&gt;

&lt;p&gt;A second tempting solution is to protect the &lt;code class=&quot;highlighter-rouge&quot;&gt;incoming&lt;/code&gt; queue and the &lt;code class=&quot;highlighter-rouge&quot;&gt;outgoing&lt;/code&gt; queue with a single lock/&lt;code class=&quot;highlighter-rouge&quot;&gt;Condition&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Assuming the same context:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Lock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ReentrantLock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Condition&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newCondition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Await for a signal from a message producer&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// adding to the outgoing queue&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Spurious wakeup checked by conditions below&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cond&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasInput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;waitForInput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;incoming&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;cond&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Signal the message consumer&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;outgoing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;writeToOutput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, there still exists several issues with this code. Firstly, &lt;code class=&quot;highlighter-rouge&quot;&gt;cond.await()&lt;/code&gt; will block only on the outgoing queue, and ignore network input. This will have the opposite effect as the earlier naive solution in which there requires network input for there to be output; in this case, the I/O thread will, in fact, have to wait for output in order for input to be read.&lt;/p&gt;

&lt;p&gt;In truth, we can try all different kinds of combinations of switching different &lt;code class=&quot;highlighter-rouge&quot;&gt;Condition&lt;/code&gt;s and different mechanisms of all sorts without succeeding, there is simply no way to wait on both the reading from socket and simultaneously the outgoing queue. Further, a thread blocked on network input is not blocked on a lock or &lt;code class=&quot;highlighter-rouge&quot;&gt;Condition&lt;/code&gt; or whatever - it remains in &lt;code class=&quot;highlighter-rouge&quot;&gt;RUNNABLE&lt;/code&gt; mode, so it might as well be busy waiting for all other observers can care. After exhausting these ideas, I too thought that it would be impossible to act on events rather than having to use a timer and step over the other blocked method in order to check either input or output depending on what is blocked.&lt;/p&gt;

&lt;p&gt;Fortunately, there is a way.&lt;/p&gt;

&lt;h1 id=&quot;the-solution&quot;&gt;The Solution&lt;/h1&gt;

&lt;p&gt;In order for my I/O thread to correctly handle I/O input, it must be interruptible. Thankfully, by switching to &lt;code class=&quot;highlighter-rouge&quot;&gt;java.nio&lt;/code&gt;, this functionality can be achieved with &lt;code class=&quot;highlighter-rouge&quot;&gt;InterruptibleChannel&lt;/code&gt;. I was able to override the default interrupt handler and use the following little utility I made to notify the I/O thread:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sun.nio.ch.Interruptible&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.lang.reflect.Field&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.nio.channels.SocketChannel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * Utility class used to modify {@link SocketChannel}s in
 * order to override the default behavior and allow for I/O
 * threads to capture {@link Signal}s passed while waiting
 * for input.
 *
 * &amp;lt;p&amp;gt;Be aware that this is an extremely egregious hack.
 * For the most part, it is a toy. I don't expect that
 * anyone would seriously consider using this in production,
 * but if there is any case where that occurs, I am not
 * responsible for what happens. Use at your own risk. You
 * have been warned.&amp;lt;/p&amp;gt;
 *
 * &amp;lt;p&amp;gt;To add further to the risks associated with this
 * class, one must &amp;lt;strong&amp;gt;NEVER&amp;lt;/strong&amp;gt; call {@link
 * Thread#interrupt()} on an I/O thread. Doing so may
 * result in undefined behavior. Capturing a {@link Signal}
 * also means that the I/O thread must use
 * {@link Thread#interrupted()} in order to clear the
 * interrupt state before the next signal. Finally,
 * {@link Thread#interrupt()} is used in order to propagate
 * signals to the I/O thread, and therefore, if any methods
 * that are interruptible must catch the exception and run
 * {@link Thread#interrupted()}.&amp;lt;/p&amp;gt;
 */&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SocketInterruptUtil&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/** The cached field used to hack the SocketChannel */&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Field&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INTERRUPTOR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/** The signal used to notify readers */&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Signal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIGNAL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Signal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;?&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;java.nio.channels.spi.AbstractInterruptibleChannel&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;INTERRUPTOR&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cls&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDeclaredField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;interruptor&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;INTERRUPTOR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setAccessible&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NoSuchFieldException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;No such field: interruptor&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Perhaps not running Oracle HotSpot?&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RuntimeException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClassNotFoundException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;No such class: AbstractInterruptibleChannel&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Perhaps not running Oracle HotSpot?&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RuntimeException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Suppress instantiation&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SocketInterruptUtil&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * Prepares the {@link SocketChannel} to receive
     * {@link Signal}s dispatched by another thread. This
     * is required in order for this to work correctly.
     *
     * @param ch the channel to prepare
     */&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SocketChannel&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;INTERRUPTOR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Interruptible&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIGNAL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IllegalAccessException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * Signals the given I/O thread to unblock from ALL
     * blocking methods and proceed and throws a
     * {@link Signal} to be handled by the thread.
     *
     * @param thread the thread to unblock
     */&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Thread probably not blocked on I/O&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;State&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RUNNABLE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;interrupt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Signal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignored&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * A signal dispatched by another thread to a target
     * I/O thread in order for targets to respond to
     * notifications.
     */&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Signal&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RuntimeException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;220295899772322553L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A correct usage of the class would look something like the following:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ServerSocketChannel&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServerSocketChannel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SocketChannel&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SocketInterruptUtil&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isOpen&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;incoming&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Signal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;outgoing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;writeToOutput&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;interrupted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;interrupted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Normally you would also need to have another&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// catch for Signal/InterruptedException here&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// However, you'd also need to check to make&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// sure that there is an active connection, so&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// I can just check to make sure that there is&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// at least a connected SocketChannel before&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// signalling and get rid of the try/catch.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And for the outgoing logic:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;outgoing&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SocketInterruptUtil&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ioThread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;discussion&quot;&gt;Discussion&lt;/h1&gt;

&lt;p&gt;In order for this to work, I made a slightly (OK, really) hacky solution to default &lt;code class=&quot;highlighter-rouge&quot;&gt;InterruptibleChannel&lt;/code&gt; functionality. I found that what &lt;code class=&quot;highlighter-rouge&quot;&gt;InterruptibleChannel&lt;/code&gt; did was put an interrupt listener before every single blocking call in order to close the socket if either the blocked thread is interrupted or if the socket was closed. I couldn’t put in my own handler because I can only override before or after the blocking method, in which my own handler would be overridden by the interrupt handler provided by the method itself. Therefore, I went one step deeper and overrode the cached instance of the interrupt handler inside of &lt;code class=&quot;highlighter-rouge&quot;&gt;InterruptibleChannel&lt;/code&gt; to exit early and throw my own Signal which can be caught by the I/O thread.&lt;/p&gt;

&lt;p&gt;I haven’t deeply investigated the performance of this method over perhaps timed busy waiting, but from testing, a blocked read can respond to signals in sub-millisecond times even when saturated with messages between “10 nanosecond intervals” on an i3-3240. A &lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; loop probably takes more than 10ns to run which is why I mention that rate in quotes, but again, this time is very impressive even if it’s off by a bit. You wouldn’t want to be waking a thread every 1 millisecond in order to check for the other condition, which is why I say that it’s good in comparison with the alternative.&lt;/p&gt;

&lt;p&gt;Unfortunately, this technique is risky in many ways, first of all, because it depends on there being the &lt;code class=&quot;highlighter-rouge&quot;&gt;AbstractInterruptibleChannel&lt;/code&gt; SPI class being available, as well as the field being available. The field probably won’t be going away because caching is required, but the class itself might. Additionally, the interrupt status of the thread is risky to play around with and requires &lt;code class=&quot;highlighter-rouge&quot;&gt;Thread.interrupted()&lt;/code&gt; to be called each time either Signal is thrown or InterruptedException is captured if the &lt;code class=&quot;highlighter-rouge&quot;&gt;signal(Thread)&lt;/code&gt; method misses the I/O portion. Otherwise, the thread itself might die. Finally, the only possible way to exit directly out of a blocking &lt;code class=&quot;highlighter-rouge&quot;&gt;read(...)&lt;/code&gt; is to throw the exception, but if a read is halfway done, then the behavior may be undefined. I will need to test further in order to determine what happens, but until then, this class still remains a very risky hack. I would highly advise against using it in a production environment, regardless of whatever performance gains may bear fruit through event-driven notifications rather than spurious wakeups. I have included a warning in the class javadoc comment to cover my ass, so please don’t push it :)&lt;/p&gt;

&lt;p&gt;In the end, even though I have acheived what I was hoping for, even if it isn’t really viable in the real-world, I guess I will just have to keep searching for a better solution.&lt;/p&gt;

&lt;h1 id=&quot;closing-words&quot;&gt;Closing Words&lt;/h1&gt;
&lt;p&gt;Figuring this all out was an interesting use of 3 hours. I’m completely done with this though, I’m not looking to play around anymore with it, but anyone else can feel free to do so themself. My plan is to update the “On Thread Safety” post very soon though, and there is more to come over winter break. Take care everyone!&lt;/p&gt;</content><author><name></name></author><summary type="html">There have been actually several times as I’m writing servers in things like my JDB project and the TridentSDK project in which the following scenario pops up: there is a single thread that manages incoming and outgoing messages. I need to block on an outgoing queue, as well as block until some bytes off the network are read.</summary></entry><entry><title type="html">Happy December</title><link href="https://agenttroll.github.io/blog/2017/12/17/happy-december.html" rel="alternate" type="text/html" title="Happy December" /><published>2017-12-17T10:55:00-08:00</published><updated>2017-12-17T10:55:00-08:00</updated><id>https://agenttroll.github.io/blog/2017/12/17/happy-december</id><content type="html" xml:base="https://agenttroll.github.io/blog/2017/12/17/happy-december.html">&lt;p&gt;I suppose it’s been a while.&lt;/p&gt;

&lt;p&gt;I think for lack of a better subject to write about, I may have put blogging by the wayside. I mean, 2/4 posts so far have been how I fixed some problem so the next time my computer breaks, I know what to install…&lt;/p&gt;

&lt;p&gt;But good news, Debian Stretch so far hasn’t broken since at least April because I don’t ever recall having to use the Stretch CD that I have on my desk since I upgraded. So even then my blog has been pretty dead.&lt;/p&gt;

&lt;p&gt;Although it’s not as if I run a well-known blog, it gives me warm feelings knowing that there’s a little nook in the Internet where I can reflect and vent whatever is in my head that I think is relevant, knowing that some random person (or more likely a bot) will look at it and possibly respond internally as a result of something that I write.&lt;/p&gt;

&lt;p&gt;Probably won’t happen though. The Internet’s a pretty big place.&lt;/p&gt;

&lt;p&gt;I’ve been thinking about writing a blog post for a while, but whenever computer time and thinking time coincide, it’s like I think “maybe later” or perhaps I need better ideas before wasting my own (or worse, a reader’s) time. So from here on out, I’ve set myself a goal to post something weekly or biweekly, whether or not somebody cares. Anything will probably go, from this melange of thoughts to some random meme dump from the past week.&lt;/p&gt;

&lt;p&gt;So in the process of writing that, I guess I’ll just make a mind dump of whatever I don’t forget over the next 30 or so minutes.&lt;/p&gt;

&lt;h1 id=&quot;flaming-vsauce&quot;&gt;Flaming Vsauce&lt;/h1&gt;

&lt;p&gt;As I’m writing this, I’m currently offline and I was actually going to look at other people explain why Vsauce is often used unironically to describe a bunch of ideas that have no relation to each other.&lt;/p&gt;

&lt;p&gt;I’ve watched my fair share of Vsauce videos, and yes, I do agree that there are a few (a lot?) of videos whose entire purpose is to go off on a huge tangent. But look at &lt;em&gt;me&lt;/em&gt;. This entire blog post has been a huge tangent, and none of the posts have any relation to each other. Yet. But hold on a minute. If I am correct in my conclusion that Vsauce is used to mock those that go off on tangents (as it is to mock the creator himself), could that not be the entire point of Vsauce videos? Could not even answering the question in full be the actual purpose of his videos?&lt;/p&gt;

&lt;p&gt;The point I’m arguing for is that Vsauce videos have nothing to do with being a Q&amp;amp;A type thing where he investigates and answers whatever is being asked in the title, but rather to make random connections so that viewers investigate &lt;em&gt;themselves&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Since I’m still offline, the only evidence I have is trying to remember whatever videos I watched, but bear with me here.&lt;/p&gt;

&lt;p&gt;By going off on tangents and only vaguely answering the question, I think that Vsauce is purposely trying to get viewers to think for themselves and become a little bit more curious about what was mentioned in the video. Could it not be possible that those who are even angered by Vsauce’s vagueness or style of discussion to do their own research in order to debunk his claim(s) and in doing so, learn a little bit in the process?&lt;/p&gt;

&lt;p&gt;But then again, why not have every inflammatory creator turn around and say “oh, that wasn’t the point, the point was to get you to learn and debunk my claims!”&lt;/p&gt;

&lt;p&gt;But then again, Vsauce hasn’t ever said specifically that instilling curiosity was the point of his videos either. Maybe he hasn’t realized how apparently stupid he sounds to some other viewers. I can’t speak for myself of the quality of his videos, but I myself do enjoy some of his content occaisionally, so I’m probably biased in favor of defending Vsauce.&lt;/p&gt;

&lt;p&gt;As a final note, for the love of God, do not make me the next Vsauce meme.&lt;/p&gt;

&lt;h1 id=&quot;vaguness-is-necessary&quot;&gt;Vaguness is Necessary&lt;/h1&gt;

&lt;p&gt;I recall from my social studies class that there are claims that the U.S. Constitution was written to be intentionally vauge. Now the merits of that claim or how useful vagueness has been to the U.S. as a nation is another topic for another time, but I think that intential vagueness is not only helpful, but absolutely &lt;strong&gt;necessary&lt;/strong&gt; for learning.&lt;/p&gt;

&lt;p&gt;So some backstory: I believe it was yesterday night, when I was finally able to get ArchLinux running on my MacBook, and I was just heading off to bed, right? And as I laid there, I still high on satisfaction and having finally been able to get the bootloader and the Wi-Fi and just everything in place, and I thought to myself:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Why didn’t the ArchWiki just tell me everything I needed to do exactly as it needs to be done?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;And from there, I realized how perhaps vagueness was connected to learning. Intentional, maybe not, but important? Most definitely. I recall conversations with some of the AP Computer Science students describing how the (unnamed) teacher was (to put in nice terms) “not a very good teacher.” I’m not sure how the Vsauce connection or the social studies connection came about, but through these connections, I realized that you don’t learn from instruction, you learn from what was missed during instruction.&lt;/p&gt;

&lt;p&gt;Now let me make clear that at the same time, what you don’t know must drive your curiosity. Vagueness will fail if students are not motivated to learn more about what they don’t understand, or what they don’t know. By allowing students to do their own learning, I think that they might be able to become more independent, be in charge, and feel more rewarded by knowledge than if they are spoonfed.&lt;/p&gt;

&lt;p&gt;On the contrary, it is is also important that there are some details that are spoonfed. You can’t learn from nothing, and there must still be the answer somewhere. If it is too difficult to find, or students are not motivated to find the answers themselves, or if students are not willing to create their own solutions, then vagueness has failed to work.&lt;/p&gt;

&lt;p&gt;There is a fine balance between teaching too much and not teaching at all. Vagueness should be a tool, and teachers a source of guidance rather than a source of information. I would even go as far as to say that teachers should learn not to teach their own subject, but to learn how to guide students.&lt;/p&gt;

&lt;p&gt;Make note that there is a reason why I chose to discuss vagueness before some of the sections below :)&lt;/p&gt;

&lt;h1 id=&quot;your-opinion-sucks&quot;&gt;Your Opinion Sucks&lt;/h1&gt;

&lt;p&gt;The section header probably inflamed at least more than one reader.&lt;/p&gt;

&lt;p&gt;The connection that some people have with their opinion should be thrown away. I think that opinions are agents of discussion, not the people who are proponents of that opinion. Pretty much 100% of the time, your opinion sucks and needs to be changed.&lt;/p&gt;

&lt;p&gt;Don’t get all offended because someone doesn’t agree with you. The idea of an opinion isn’t so other people agree with it, it is so that the existing state of humanity can be improved if is better than an existing idea. If people don’t agree with it, no need to get all butthurt. Their disagreement is an opinion as well, so both of your opinions suck.&lt;/p&gt;

&lt;p&gt;But then again… I’m voicing my own opinion on opinions, so I should piss off, right?&lt;/p&gt;

&lt;h1 id=&quot;machine-conciousness&quot;&gt;Machine Conciousness&lt;/h1&gt;

&lt;p&gt;I used to have to go to Costco a lot with my parents because, you know, they were those parents.&lt;/p&gt;

&lt;p&gt;Thing was, at Costco, there’s this big ol’ table filled with tons and tons of books, and whenever my parents would shop, I would pick up a book and read it while they did their thing, and one of those books happened to be Michio Kaku’s book that discussed time travel or some other baity Sci-Fi topic.&lt;/p&gt;

&lt;p&gt;Truth is, one of the things that the book I read that day talked about was human consciousness. Now I don’t recall that much from the book itself, so I’m looking to get my hands on it ASAP after I finish writing this.&lt;/p&gt;

&lt;p&gt;Anyways, I also happen to be fascinated with natural processes. Things like what the smallest subatomic particles are made of, what makes energy “energy,” etc… and human conciousness was something that I found mysterious, as well as it happens, neurologists and psychologists the world over. What makes us concious? What makes us/gives us the ability to be meta-cogniscent? Why (if they do not) do animals not think abstractly? And most importantly, what prevents lifeless objects from possessing consiousness?&lt;/p&gt;

&lt;p&gt;How mind-numbingly complex and unknown, the processes that go on inside of our little brains. The only thing I recall today about human consciousness is how people have attempted to preserve it through cryogenics and how it was related someehow to prediction, thinking about the future and being able to respond to how events might continue or change. It boggles the mind, thinking about the mind, in fact.&lt;/p&gt;

&lt;p&gt;I’d honestly love to find some free time to work on something along the same vein as machine consciousness someday. But for now I gotta finish the blog post.&lt;/p&gt;

&lt;h1 id=&quot;jdb&quot;&gt;JDB&lt;/h1&gt;

&lt;p&gt;Some keen observers might notice that I have a new JDB project on GitHub and this is actually for a post APCS course that I am currently in at school. In short, it’s just a CLI Java-debugger, but looking at jdb.md should give a clue as to what the goals are for the project.&lt;/p&gt;

&lt;p&gt;One of the services that I use as part of the class is something called Seesaw, which lets me write a bi/triweekly journal about my progress, but unfortunately, there’s a character limit!&lt;/p&gt;

&lt;p&gt;Since I like to elaborate and write, it turns out this is a relevant inconvenience for me. I think I will begin to incorporate those posts into my blog since it will allow me to add inline elements such as photos or videos without having to make a separate entry, something that writing to GitHub Gist and Seesaw itself did not allow.&lt;/p&gt;

&lt;p&gt;I think that by writing a public journal, others might also benefit from reading through how I think and be able to apply the same concepts to their own programming challenges as well. At the same time, I might also create the illusion that my blog is a little more active than it really is.&lt;/p&gt;

&lt;h1 id=&quot;on-thread-safety&quot;&gt;On Thread Safety&lt;/h1&gt;

&lt;p&gt;It’s been a &lt;strong&gt;long&lt;/strong&gt; while since I’ve looked at the “On Thread Safety” treatise that I had written back in May. I’ve started to look back at it over the past 2 days, so hopefully anyone who has been watching that will be excited for the changes that I’ve made so far, however miniscule. I’m very excited by the prospect of writing a finished product all, but I’m afraid that a single post may not be enough to explain as comprehensively as possible the mechanics of multithreading in Java. I’m not looking to replace other resources, but again, simply condensing and using the vaguness idea from above to help explain a few esoteric/quirky concepts pertaining to thread-safety.&lt;/p&gt;

&lt;p&gt;Again, I’m looking forward to continuing to update it, so stay tuned!&lt;/p&gt;

&lt;h1 id=&quot;octopress&quot;&gt;Octopress&lt;/h1&gt;

&lt;p&gt;As I was looking through the 3 photos on the blog so far, firstly, I noticed that each section in this post so far has been successively shorter than the previous.&lt;/p&gt;

&lt;p&gt;I also noticed this one photo:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://agenttroll.github.io/blog/img/octopress3mobile.png&quot; alt=&quot;Otopress3 on Mobile&quot; /&gt;&lt;/p&gt;

&lt;p&gt;GG @ The navbar button.&lt;/p&gt;

&lt;p&gt;Although it’s not necessarily related to the above bug (which I am sure is the fault of the theme rather than Octopress itself), I’m thinking of getting rid of Octopress3 perhaps in the near future and using pure Jekyll. There’s little that I think Octopress offers in terms of features vs. Jekyll and the barebones should be sufficient for me. On top of that, Jekyll is significantly more active in terms of development than Octopress so that is also another motivator.&lt;/p&gt;

&lt;h1 id=&quot;closing-thoughts&quot;&gt;Closing Thoughts&lt;/h1&gt;

&lt;p&gt;It’s been a while so I’ve got a lot of stuff to talk about, perhaps contributing to the length of today’s post. I guess my final message would be to stay tuned.&lt;/p&gt;

&lt;p&gt;If nothing of interest to you was written here, perhaps you might leave with a smile on your face. If failing to interest you, I hope your day gets better regardless :)&lt;/p&gt;</content><author><name></name></author><summary type="html">I suppose it’s been a while.</summary></entry><entry><title type="html">Status Update: Reinstalling Debian (for the Nth Time)</title><link href="https://agenttroll.github.io/blog/2017/04/22/status-update-reinstalling-debian-for-the-nth-time.html" rel="alternate" type="text/html" title="Status Update: Reinstalling Debian (for the Nth Time)" /><published>2017-04-22T23:30:03-07:00</published><updated>2017-04-22T23:30:03-07:00</updated><id>https://agenttroll.github.io/blog/2017/04/22/status-update-reinstalling-debian-for-the-nth-time</id><content type="html" xml:base="https://agenttroll.github.io/blog/2017/04/22/status-update-reinstalling-debian-for-the-nth-time.html">&lt;p&gt;It’s really not something I do everyday, but apparently, since I’ve broken my Debian computer so many damn times that I kinda have a routine of what programs to install and what packages to use. There were a few interesting changes and things that I’ve learned from my most recent failure (see &lt;a href=&quot;https://agenttroll.github.io/blog/2017/04/04/i-finally-figured-out-how-to-get-ffmpeg-to-work-on-mixed-jessie-sid.html&quot;&gt;my previous post for the retardation&lt;/a&gt;).&lt;/p&gt;

&lt;h1 id=&quot;initial-setup&quot;&gt;Initial Setup&lt;/h1&gt;

&lt;p&gt;I’m forever in love with 3 tools in particular, &lt;a href=&quot;https://github.com/albertlauncher/albert&quot;&gt;Albert Launcher&lt;/a&gt;, tmux, and &lt;a href=&quot;https://github.com/Valloric/YouCompleteMe/wiki/Building-Vim-from-source&quot;&gt;compiled Vim&lt;/a&gt; (which I should note also requires Ruby and Python, which I use &lt;a href=&quot;https://github.com/rbenv/rbenv&quot;&gt;rbenv&lt;/a&gt; and &lt;a href=&quot;https://github.com/pyenv/pyenv&quot;&gt;pyenv&lt;/a&gt; respectively).&lt;/p&gt;

&lt;p&gt;I had no issues installing Albert, for it was a precompiled package. However, I had considerable trouble trying to get tmux to play nicely with &lt;a href=&quot;https://github.com/powerline/powerline&quot;&gt;powerline&lt;/a&gt;. One of the confusing things was the way you install powerline is actually using python’s pip, which came bundled with the &lt;code class=&quot;highlighter-rouge&quot;&gt;2.7.9&lt;/code&gt; version that I was using from &lt;code class=&quot;highlighter-rouge&quot;&gt;pyenv&lt;/code&gt;. Depending on what you used to install powerline, the &lt;code class=&quot;highlighter-rouge&quot;&gt;--user&lt;/code&gt; flag was used in the official documentation, which placed the package in a different directory than if you had installed it without (the &lt;code class=&quot;highlighter-rouge&quot;&gt;--user&lt;/code&gt; flag would place it in &lt;code class=&quot;highlighter-rouge&quot;&gt;.local&lt;/code&gt;, while without the flag, it would place the package in &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.pyenv/versions/2.7.9/...&lt;/code&gt;). Using &lt;code class=&quot;highlighter-rouge&quot;&gt;pip show powerline-status&lt;/code&gt; will show you where the powerline directory is stored, and I finished the rest after finding this &lt;a href=&quot;https://askubuntu.com/a/283909&quot;&gt;well-written post on AskUbuntu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Further, another little quirk about pyenv is that it does not automatically install its dependencies, you must look at what you need to install &lt;a href=&quot;https://github.com/pyenv/pyenv/wiki/Common-build-problems&quot;&gt;here&lt;/a&gt;. The same cannot be said for &lt;code class=&quot;highlighter-rouge&quot;&gt;rbenv&lt;/code&gt;, however you must also (ironically) &lt;a href=&quot;https://github.com/rbenv/ruby-build&quot;&gt;install the &lt;code class=&quot;highlighter-rouge&quot;&gt;install&lt;/code&gt;&lt;/a&gt; command in order to install it in the first place.&lt;/p&gt;

&lt;p&gt;So back to actually installing tmux itself, the issue was trying to get the command prompt to render correctly, as it would be cut off after my username. I later also got the classic “everything is bold” bug in tmux, but both were fixed by adding the following to my &lt;code class=&quot;highlighter-rouge&quot;&gt;.bashrc&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TERM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;xterm-256color
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, everything worked like charm. I then installed vim and XFCE, removing all the GNOME packages except for the theme (I like the theme actually).&lt;/p&gt;

&lt;h1 id=&quot;nvidia-drivers&quot;&gt;NVIDIA drivers&lt;/h1&gt;

&lt;p&gt;Ah, the bane of linux gaming, installing GPU drivers. For the past few years, I’ve used the proprietary ones off of the Nvidia site, but I decided to take the ones packaged in &lt;code class=&quot;highlighter-rouge&quot;&gt;jessie-backports&lt;/code&gt; for a spin this time (the reason being that they have the new 375 drivers). I ran into the same roadblock a few dozen times, when DKMS and the &lt;code class=&quot;highlighter-rouge&quot;&gt;xorg&lt;/code&gt; nvidia package kept getting stuck. Evidently, the way to fix this was actually to stop XDM, but my intuition was uh… Not exactly up to par the few dozen times that I did it. I even went so far as to attempt to build from source using the &lt;code class=&quot;highlighter-rouge&quot;&gt;deb-src&lt;/code&gt; repository for &lt;code class=&quot;highlighter-rouge&quot;&gt;jessie-backports&lt;/code&gt;, again getting stuck with the dependencies issue. However, just remember to shutoff your window manager for like 15 minutes while it installs, and then when &lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get&lt;/code&gt; finishes with an error on the &lt;code class=&quot;highlighter-rouge&quot;&gt;xorg&lt;/code&gt; package, just reboot and the problem should be solved (&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo dpkg --configure -a&lt;/code&gt; may be needed). The NVIDIA drivers are exceptionally awkward to resolve because one needs to keep rebooting and repeating the reconfiguration until the dependencies are resolved.&lt;/p&gt;

&lt;p&gt;As with the classic setup, I also &lt;a href=&quot;https://askubuntu.com/questions/481414/install-nvidia-driver-instead-nouveau&quot;&gt;blacklisted &lt;code class=&quot;highlighter-rouge&quot;&gt;nouveau&lt;/code&gt;&lt;/a&gt; as well.&lt;/p&gt;

&lt;h1 id=&quot;other-things-i-install&quot;&gt;Other things I install&lt;/h1&gt;

&lt;p&gt;Some of the other packages I install are Google Chrome, Jetbrains Toolbox (along with a few IDEs), and &lt;a href=&quot;https://github.com/cmpitg/infinality-debian-package&quot;&gt;Infinality&lt;/a&gt;. I also use &lt;a href=&quot;http://sdkman.io/&quot;&gt;sdkman&lt;/a&gt; for quite a few different things such as Java/Maven. I also do quite a bit of customization on other things such as installing a solarized-light theme for xfce-terminal, and other font related changes.&lt;/p&gt;

&lt;h1 id=&quot;back-to-the-ffmpeg-problem&quot;&gt;Back to the FFmpeg problem…&lt;/h1&gt;

&lt;p&gt;After breaking my system after that episode, I was eagar to reinstall FFmpeg and OBS the correct way this time. Ironically, I AGAIN broke my system in the process of writing this blog post by removing all the GNOME packages and borking with &lt;code class=&quot;highlighter-rouge&quot;&gt;polkit&lt;/code&gt;. So in fact, I had to redo everything previously written in the process of describing my installation process, and again got close to breaking the DM by forgetting to reconfigure.&lt;/p&gt;

&lt;p&gt;Anyways, with that debacle over, I found to my surprise that using &lt;a href=&quot;https://github.com/lutris/ffmpeg-nvenc&quot;&gt;the script&lt;/a&gt; I had used in the previous article did not work. However, with some digging around, I was finally able to get it to work after about a week:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The first problem was dependency conflicts. &lt;code class=&quot;highlighter-rouge&quot;&gt;libvdpau-dev&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;libva-dev&lt;/code&gt; and any other libraries that conflict with the &lt;code class=&quot;highlighter-rouge&quot;&gt;jessie&lt;/code&gt; packages need to be removed from the installer script and installed using:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; jessie-backports libvdpau-dev libva-dev &lt;span class=&quot;c&quot;&gt;# And any other conflicts&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Run the script: &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo ./build.sh -o -d /usr/local&lt;/code&gt;. No problems here.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Optional: I replaced the NVENC header files with a newer version that I downloaded off the NVIDIA site.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Starting both &lt;code class=&quot;highlighter-rouge&quot;&gt;ffmpeg&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;obs&lt;/code&gt; should produce an error that looks something like:&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;error &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;loading shared libraries: libavdevice.so.57: cannot open shared object file
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Open up &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/ld.so.conf&lt;/code&gt; and use the following lines (libav and nvenc links) - &lt;a href=&quot;https://forum.ivorde.com/ffmpeg-error-while-loading-shared-libraries-libavdevice-so-52-cannot-open-shared-object-file-no-t129.html&quot;&gt;Source&lt;/a&gt;:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;include /etc/ld.so.conf.d/*.conf
/usr/local/lib
/usr/lib/x86_64-linux-gnu/nvidia/current
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;OBS should have an error having to do with not being able to find &lt;code class=&quot;highlighter-rouge&quot;&gt;libcuda.so&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;libnvidia-encode.so&lt;/code&gt;. These files are provided by installing the following libraries:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get install &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; jessie-backports libnvidia-encode1 libcuda1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo ldconfig&lt;/code&gt; to create the links&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Open up OBS and profit&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Getting myself up to speed was a hell of a joyride…&lt;/p&gt;</content><author><name></name></author><summary type="html">It’s really not something I do everyday, but apparently, since I’ve broken my Debian computer so many damn times that I kinda have a routine of what programs to install and what packages to use. There were a few interesting changes and things that I’ve learned from my most recent failure (see my previous post for the retardation).</summary></entry><entry><title type="html">GitHub Pages Screwed Me Over</title><link href="https://agenttroll.github.io/blog/2017/04/08/github-pages-screwed-me-over.html" rel="alternate" type="text/html" title="GitHub Pages Screwed Me Over" /><published>2017-04-08T14:16:13-07:00</published><updated>2017-04-08T14:16:13-07:00</updated><id>https://agenttroll.github.io/blog/2017/04/08/github-pages-screwed-me-over</id><content type="html" xml:base="https://agenttroll.github.io/blog/2017/04/08/github-pages-screwed-me-over.html">&lt;p&gt;So I restarted my blog for like the 13th time or whatever and ran into a few
minor issues…&lt;/p&gt;

&lt;h1 id=&quot;octopress-3&quot;&gt;Octopress 3&lt;/h1&gt;

&lt;p&gt;Some good stuff. I actually kinda liked the old design, but some things about the new stock theme such as the About page in the top right corner, as well as the feature to add custom pages rather than to have just blog posts is nice (although I myself do not have any particular use for them).&lt;/p&gt;

&lt;p&gt;The new Octopress gem is also a nice addition instead of having to use &lt;code class=&quot;highlighter-rouge&quot;&gt;rake&lt;/code&gt; to do whatever I needed. The only thing about it is that you cannot convert posts to drafts, for it throws an odd exception along the lines of:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;unpublish&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;28&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:in&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`require': cannot load such file -- octopress/post (LoadError)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don’t know ruby so there’s nothing I can do about that ¯\_(ツ)_/¯&lt;/p&gt;

&lt;p&gt;Anyways, you might see that my huge “&lt;a href=&quot;https://agenttroll.github.io/blog/2017/03/20/on-thread-safety.html&quot;&gt;On Thread Safety&lt;/a&gt;” post is incomplete, so if you were wondering why, blame Octopress’s non-functional &lt;code class=&quot;highlighter-rouge&quot;&gt;unpublish&lt;/code&gt; command.&lt;/p&gt;

&lt;p&gt;Other than that, it’s the same old Octopress. Good stuff.&lt;/p&gt;

&lt;h1 id=&quot;github-pages-integration&quot;&gt;GitHub Pages integration&lt;/h1&gt;

&lt;p&gt;Just a minor technicality, an &lt;code class=&quot;highlighter-rouge&quot;&gt;index.html&lt;/code&gt; file &lt;strong&gt;WILL NOT&lt;/strong&gt; be loaded if the site is pushed to &lt;code class=&quot;highlighter-rouge&quot;&gt;master&lt;/code&gt;. It took about 10 minutes for me realize that my blog was not loading due to it being on &lt;code class=&quot;highlighter-rouge&quot;&gt;master&lt;/code&gt;, rather than GitHub Pages just updating the page.&lt;/p&gt;

&lt;p&gt;Even though a GitHub Pages site works on &lt;code class=&quot;highlighter-rouge&quot;&gt;master&lt;/code&gt;, if you want your index.html to show up on the root URL, then you must use &lt;code class=&quot;highlighter-rouge&quot;&gt;gh-pages&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Had I pushed to &lt;code class=&quot;highlighter-rouge&quot;&gt;master&lt;/code&gt;, I would need to use the URL &lt;code class=&quot;highlighter-rouge&quot;&gt;https://agenttroll.github.io/blog/index.html&lt;/code&gt;, rather than &lt;code class=&quot;highlighter-rouge&quot;&gt;https://agenttroll.github.io/blog&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Anyways, its just me complaining about a minor quirk with GitHub Pages and the way it resolves URLs and some updates with Octopress.&lt;/p&gt;

&lt;p&gt;BONUS EDIT:&lt;/p&gt;

&lt;p&gt;After reading through my blog, I found that Octopress &lt;strong&gt;DOES NOT&lt;/strong&gt; rebuild your pages when you do &lt;code class=&quot;highlighter-rouge&quot;&gt;octopress deploy&lt;/code&gt;. What essentially happened was because I was using &lt;code class=&quot;highlighter-rouge&quot;&gt;jekyll serve&lt;/code&gt; to preview the blog before publishing it, all the &lt;code class=&quot;highlighter-rouge&quot;&gt;https://agenttroll.github.io&lt;/code&gt; tags resolved to &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost&lt;/code&gt; instead of the intended page URL. Therefore, if you want to get all the right page variables, use:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;jekyll build &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; octopress deploy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><summary type="html">So I restarted my blog for like the 13th time or whatever and ran into a few minor issues…</summary></entry><entry><title type="html">I Finally Figured Out How to Get FFmpeg to Work on Mixed Jessie/sid</title><link href="https://agenttroll.github.io/blog/2017/04/04/i-finally-figured-out-how-to-get-ffmpeg-to-work-on-mixed-jessie-sid.html" rel="alternate" type="text/html" title="I Finally Figured Out How to Get FFmpeg to Work on Mixed Jessie/sid" /><published>2017-04-04T23:42:58-07:00</published><updated>2017-04-04T23:42:58-07:00</updated><id>https://agenttroll.github.io/blog/2017/04/04/i-finally-figured-out-how-to-get-ffmpeg-to-work-on-mixed-jessie-sid</id><content type="html" xml:base="https://agenttroll.github.io/blog/2017/04/04/i-finally-figured-out-how-to-get-ffmpeg-to-work-on-mixed-jessie-sid.html">&lt;p&gt;&lt;strong&gt;MAJOR EDIT: &lt;a href=&quot;https://wiki.debian.org/DontBreakDebian&quot;&gt;DO NOT DO THIS&lt;/a&gt;!!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;PLEASE PLEASE avoid using sid/jessie repos at the same time, I SEVERELY broke the apt-get package manager by doing this and ended up not being able to recover. I ended up having to reinstall the entire Debian OS, lmao.&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Recently adding the &lt;a href=&quot;&quot;&gt;Debian sid&lt;/a&gt; repos to my &lt;code class=&quot;highlighter-rouge&quot;&gt;sources.list&lt;/code&gt;, I found that upgrading a certain few packages related to &lt;a href=&quot;https://wiki.debian.org/iPhone&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;libimobiledevice-dev&lt;/code&gt;&lt;/a&gt; (in order to transfer photos from my iPhone 6S to my computer) caused other libraries to be needed to be upated. Of course, out of all the possible libraries, one of the libraries that was updated broke FFmpeg.&lt;/del&gt;&lt;/p&gt;

&lt;h1 id=&quot;background&quot;&gt;&lt;del&gt;Background&lt;del&gt;&lt;/del&gt;&lt;/del&gt;&lt;/h1&gt;

&lt;p&gt;&lt;del&gt;I was led on this frustrating adventure by my desire to move pictures from my iPhone to my computer. I could have gone the simple way and just used iTunes or something on a Windows computer, but you know what? It just happens that I have a backup folder already with all my photos on my Debian computer.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Simply the most magical thing about Debian is how I was able to USB transfer all the earlier photos from my phone to my computer without trouble, but I’d get Unhandled lockdown errors whenever I mount my iPhone this time around.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Forgetting to read the portion about using the &lt;a href=&quot;https://wiki.debian.org/iPhone#backporting_libimobiledevice_1.1.1_to_Squeeze&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;jessie-backports&lt;/code&gt; workaround&lt;/a&gt;, I rashly went to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;sid&lt;/code&gt; repos instead…&lt;/del&gt;&lt;/p&gt;

&lt;h1 id=&quot;the-problem&quot;&gt;&lt;del&gt;The Problem&lt;/del&gt;&lt;/h1&gt;

&lt;p&gt;&lt;del&gt;A few packages later (using &lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get dist-upgrade&lt;/code&gt; I think?), I was rather surprised to find that &lt;a href=&quot;https://obsproject.com/&quot;&gt;OBS&lt;/a&gt; had stopped working. Whenever I’d enter &lt;code class=&quot;highlighter-rouge&quot;&gt;obs&lt;/code&gt; into terminal, it would spit out something like the following:&lt;/del&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;obs: symbol lookup error: /usr/lib/x86_64-linux-gnu/libass.so.5
undefined symbol: FT_Outline_EmboldenXY
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;del&gt;No problem. Can’t be part of the package update, right… (it was)? I do a quick google search and discovered the &lt;a href=&quot;http://askubuntu.com/a/659630&quot;&gt;following&lt;/a&gt;:&lt;/del&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;del&gt;This was related to FFmpeg, not actually OBS&lt;/del&gt;&lt;/li&gt;
  &lt;li&gt;&lt;del&gt;This works:&lt;/del&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /usr/lib/x86_64-linux-gnu
ffmpeg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;del&gt;The latter point was in particular, the most baffling thing about the whole issue. I couldn’t comprehend how being in a specific library directory ended up allowing FFmpeg to work. I did not want to have to switch into this directory every time I needed to use FFmpeg, so I decided to attempted to fix the issue by compiling a new version of FFmpeg…&lt;/del&gt;&lt;/p&gt;

&lt;h1 id=&quot;fixing-it&quot;&gt;&lt;del&gt;Fixing it&lt;/del&gt;&lt;/h1&gt;

&lt;p&gt;&lt;del&gt;I decided to recompile FFmpeg to try my luck and see if it is simply a minor library error (?? not even sure what I was thinking at the time).&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Now I tried a wide variety of different compile options, including &lt;a href=&quot;https://github.com/lutris/ffmpeg-nvenc&quot;&gt;this nifty script&lt;/a&gt; which I used previously to install OBS and FFmpeg.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Surprise, surprise. It didn’t work.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Knowing that it was a problem with &lt;code class=&quot;highlighter-rouge&quot;&gt;libass&lt;/code&gt;, I was damned to find that even the FFmpeg build in the &lt;code class=&quot;highlighter-rouge&quot;&gt;sid&lt;/code&gt; repos did not even work with the &lt;code class=&quot;highlighter-rouge&quot;&gt;libass&lt;/code&gt; version packaged for that &lt;code class=&quot;highlighter-rouge&quot;&gt;jessie&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;testing&lt;/code&gt;.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Basically in order to fix the problem, I cannot use dynamic links to the new version of libass, but I needed to retain a static link to the previous one with the FFmpeg binary.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;I actually had modified the previous script exactly for this purpose, but in being new to this whole static thing, I mixed up &lt;code class=&quot;highlighter-rouge&quot;&gt;--enable-shared&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;--enable-static&lt;/code&gt; flags multiple times. It turns out however, that the two don’t really have anything in particular that relates them. Unbeknownst to me, I kept trying different combinations of fruitlessly changing the flags only to get linking errors with &lt;code class=&quot;highlighter-rouge&quot;&gt;x264&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;libass&lt;/code&gt;.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;In short, shared vs. static:&lt;/del&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;del&gt;Shared flag - writes &lt;code class=&quot;highlighter-rouge&quot;&gt;.so&lt;/code&gt; files to the library path for other binaries that use dynamic libraries to load the library. Newer versions replace this &lt;code class=&quot;highlighter-rouge&quot;&gt;.so&lt;/code&gt; file with the newer version, thus updating for all binaries using this library.&lt;/del&gt;&lt;/li&gt;
  &lt;li&gt;&lt;del&gt;Static flag - does not use &lt;code class=&quot;highlighter-rouge&quot;&gt;.so&lt;/code&gt; file, but rather an &lt;code class=&quot;highlighter-rouge&quot;&gt;.a&lt;/code&gt; file that is always the same. Updates do not affect static libraries, as the name “static” implies.&lt;/del&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;del&gt;In the end, I went with using &lt;a href=&quot;https://github.com/zimbatm/ffmpeg-static&quot;&gt;this script&lt;/a&gt;, but with a few minor modifications:&lt;/del&gt;&lt;/p&gt;

&lt;div class=&quot;language-patch highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gh&quot;&gt;diff --git a/build.sh b/build.sh
index f94fdbe..cfc8a61 100755
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;--- a/build.sh
&lt;/span&gt;&lt;span class=&quot;gi&quot;&gt;+++ b/build.sh
&lt;/span&gt;&lt;span class=&quot;gu&quot;&gt;@@ -160,7 +160,7 @@ make install
&lt;/span&gt; echo &quot;*** Building libvpx ***&quot;
 cd $BUILD_DIR/libvpx*
 [ $rebuild -eq 1 -a -f Makefile ] &amp;amp;&amp;amp; make distclean || true
&lt;span class=&quot;gd&quot;&gt;-[ ! -f config.status ] &amp;amp;&amp;amp; PATH=&quot;$BIN_DIR:$PATH&quot; ./configure --prefix=$TARGET_DIR --disable-examples --disable-unit-tests --enable-pic
&lt;/span&gt;&lt;span class=&quot;gi&quot;&gt;+[ ! -f config.status ] &amp;amp;&amp;amp; PATH=&quot;$BIN_DIR:$PATH&quot; ./configure --prefix=$TARGET_DIR --disable-examples --disable-unit-tests --enable-shared --enable-pic
&lt;/span&gt; PATH=&quot;$BIN_DIR:$PATH&quot; make -j $jval
 make install
 
&lt;span class=&quot;gu&quot;&gt;@@ -196,6 +196,7 @@ PKG_CONFIG_PATH=&quot;$TARGET_DIR/lib/pkgconfig&quot; ./configure \
&lt;/span&gt;   --enable-libvpx \
   --enable-libx264 \
   --enable-libx265 \
&lt;span class=&quot;gi&quot;&gt;+  --enable-nvenc \
&lt;/span&gt;   --enable-nonfree
 PATH=&quot;$BIN_DIR:$PATH&quot; make -j$NPROC
 make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;del&gt;I made a minor fix to VPX not being able to detected, although I am not completely sure how that is supposed to work.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;(Quick note: NVENC capability dynamically loads files from the library path from the nVidia SDK, no compilation needed. I did not add a script to download the files because a) the toolkit requires signing in and b) I already have the files)&lt;/del&gt;&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;&lt;del&gt;Conclusion&lt;/del&gt;&lt;/h1&gt;

&lt;p&gt;&lt;del&gt;I was eventually able to install OBS using the &lt;code class=&quot;highlighter-rouge&quot;&gt;ffmpeg-static&lt;/code&gt; build script to build FFmpeg. Everything worked out in the end (except for one minor caveat that &lt;code class=&quot;highlighter-rouge&quot;&gt;ffplay&lt;/code&gt; is never compiled, I will need to figure that out). If OBS is missing an FFmpeg compile dependency, then use &lt;code class=&quot;highlighter-rouge&quot;&gt;--enable-shared&lt;/code&gt; to allow OBS to use them as well. Otherwise, errors such as missing &lt;code class=&quot;highlighter-rouge&quot;&gt;libswrescale&lt;/code&gt; can be fixed using the &lt;code class=&quot;highlighter-rouge&quot;&gt;sid&lt;/code&gt; packages.&lt;/del&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">MAJOR EDIT: DO NOT DO THIS!!</summary></entry></feed>