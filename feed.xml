<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.6.2">Jekyll</generator><link href="https://caojohnny.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://caojohnny.github.io/blog/" rel="alternate" type="text/html" /><updated>2021-05-24T14:35:25-07:00</updated><id>https://caojohnny.github.io/blog/</id><title type="html">Times past, and their stories</title><subtitle>A brain dump of things that I've learned</subtitle><entry><title type="html">How to Store Data</title><link href="https://caojohnny.github.io/blog/2021/01/01/how-to-store-data.html" rel="alternate" type="text/html" title="How to Store Data" /><published>2021-01-01T01:40:03-08:00</published><updated>2021-01-01T01:40:03-08:00</updated><id>https://caojohnny.github.io/blog/2021/01/01/how-to-store-data</id><content type="html" xml:base="https://caojohnny.github.io/blog/2021/01/01/how-to-store-data.html">&lt;p&gt;As I preface in many of my blog posts, the information
I present will apply to Java applications, and in
particular, Bukkit plugins.&lt;/p&gt;

&lt;p&gt;A very common question that I see asked on the SpigotMC
forums is how to persist data. Minecraft servers see on the
order of magnitude of a dozen or so to hundreds of
thousands and millions of players at the upper echelons of
the industry. Developers want to write robust plugins that
can persist the state across server reboots, crashes, etc.&lt;/p&gt;

&lt;p&gt;So what is the best method for doing so? What
considerations are relevant? How do you design data
persistence?&lt;/p&gt;

&lt;h1 id=&quot;what-are-you-storing&quot;&gt;What are you storing?&lt;/h1&gt;

&lt;p&gt;The first step in determining &lt;em&gt;how&lt;/em&gt; to store data is to
figure out &lt;em&gt;what&lt;/em&gt; data you are storing. Different kinds of
data follow different patterns which you can exploit to
store them more effectively than you would if you just went
with a generic solution. Things such as what type of data,
how much of that data and how quickly you need to lookup
or store that data are relevant considerations here. If you
are not able to answer these questions, it is worth either
stopping here and &lt;em&gt;figuring them out&lt;/em&gt;, or alternatively,
&lt;em&gt;making some assumptions&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Being a good engineer requires you to collect data and to
make observations. If there is more information that is
available but you don’t know, you want to figure out that
information. Once you have this information, you can begin
to filter out and extract the relevant details that you
need to solve the problem.&lt;/p&gt;

&lt;p&gt;With that being said, there is some information that you
simply can’t know in advance. You can’t know what kind of
data might be needed for future features that aren’t
planned yet, for example. Some people also don’t know how
much data they need to store. When I ask, they usually
respond with something like “I don’t know” or “unlimited,”
both of which are equally unhelpful answers! A good
engineer responds to this situation by making assumptions.
Assumptions are educated guesses based on your current
knowledge that would put you in the ballpark of what you
would expect something to be. An assumption can also be a
safe upper bound that would tolerate a range of
circumstances.&lt;/p&gt;

&lt;p&gt;Let’s say you are storing some kind of player data.
Obviously, this would be tied to the number of unique
players. Based on my prior knowledge, within the span of
around 6 months, maybe 20,000 unique players will join the
server for a given server capacity. In the real world, this
number might be highly unrealistic to surpass based on
things like how big the server is, how much promotion and
advertising the server owner decides to undertake and such.
This would therefore be a safe upper-bound for me to design
my data storage.&lt;/p&gt;

&lt;p&gt;More importantly, what this allows me to do is set a 
&lt;em&gt;testable&lt;/em&gt; objective. I would be able to better simulate
and test the capacity of my data storage method by
designing and implementing my data storage method and then
loading it with this exact number of data entries to see if
it functions correctly. A good engineer evaluates their
assumptions and then changes their goals accordingly
through design iteration. If my design holds up and there
is room to spare, then I have basically built a tolerance
into my design. On the other hand, if it fails because it
became overloaded, I will know that I have either selected
a faulty method of storing data or I have implemented it
incorrectly. I will then reiterate and then start with a
new plan to debug and then re-design.&lt;/p&gt;

&lt;p&gt;With that out of the way, let us take it one step at a
time. Once you have gathered and figured out the details
about your data, how do you use this to inform your
decisions?&lt;/p&gt;

&lt;h1 id=&quot;what-do-you-store-data-with&quot;&gt;What do you store data with?&lt;/h1&gt;

&lt;p&gt;In general, terms you will encounter two kinds of data
storage methods in the Bukkit plugin ecosystem: files and
databases. Among them, there are many different subtypes
and formats which you may have heard of:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Files
    &lt;ul&gt;
      &lt;li&gt;Text
        &lt;ul&gt;
          &lt;li&gt;JSON format&lt;/li&gt;
          &lt;li&gt;YAML format&lt;/li&gt;
          &lt;li&gt;HOCON format&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Binary
        &lt;ul&gt;
          &lt;li&gt;NBT format&lt;/li&gt;
          &lt;li&gt;GZIP NBT&lt;/li&gt;
          &lt;li&gt;Schematics&lt;/li&gt;
          &lt;li&gt;Images&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Databases
    &lt;ul&gt;
      &lt;li&gt;Networked
        &lt;ul&gt;
          &lt;li&gt;MySQL&lt;/li&gt;
          &lt;li&gt;MariaDB&lt;/li&gt;
          &lt;li&gt;MongoDB&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Embedded
        &lt;ul&gt;
          &lt;li&gt;SQLite&lt;/li&gt;
          &lt;li&gt;H2&lt;/li&gt;
          &lt;li&gt;Derby&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The method you use to store data depends largely on your
goals. There are many times where these goals will compete
with one another, but you will need to decide which gets
priority depending on your constraints. In engineering, a
constraint is something that would immediately rule out a
solution. One common constraint is memory - you cannot
exceed the amount of memory your server has or the amount
of hard drive space you have, etc. Can you see how the
information discussed in the last section, such as what
data and how much data become relevant here?&lt;/p&gt;

&lt;h4 id=&quot;memory&quot;&gt;Memory&lt;/h4&gt;

&lt;p&gt;You can use your assumptions and information to compute
how much memory is consumed from storing your data. If this
amount of memory exceeds your disk space, you have already
ruled out text files - those will necessarily take up more
space. On the other hand, if it does not exceed your disk
space, you would want to use a file because it is much
easier to set up - you don’t want to end up having to
engineer a more complex solution involving databases if you
don’t have to.&lt;/p&gt;

&lt;p&gt;Let’s say you have a lot of data, so much that it exceeds
your disk space. You could consider binary files, which
are capable of being compressed. You could also consider
using a database, which incorporate their own formats and
or compression if you desire. You could also consider using
a networked database with a larger disk than your server.
Between these options, you could select from a whole host
of other considerations such as server availability and
performance as necessary.&lt;/p&gt;

&lt;h4 id=&quot;performance&quot;&gt;Performance&lt;/h4&gt;

&lt;p&gt;The pervading goal in data storage is performance. However,
as is tradition, performance is a very complex topic to
discuss, especially so for data storage.&lt;/p&gt;

&lt;p&gt;I have written a test suite between different storage
methods &lt;a href=&quot;https://github.com/caojohnny/data-benchmark&quot;&gt;here&lt;/a&gt;
if you are curious where I get my performance data from or
if you want to test for yourself what methods work the best
on your machines. After all, with different kinds of hard
drives, SSDs, NVMe M.2s, etc. you will be bound to have
differing hardware performance characteristics that
propagate into your data storage.&lt;/p&gt;

&lt;p&gt;In terms of pure storage format (between files and
databases), files will generally have better write
performance, while databases have better read performance.
In general, the most noticable difference in performance
will be read performance; i.e. it is better to have fast
reads than it is to have fast writes. In terms of user
experience, if you have slow writes, no one really cares
because you can just queue up the write for later and then
nothing else happens. However, if you have slow reads, then
players will have to wait for your plugin to respond to
something that involves the read. Things such as sorting
data (top balances, top points, top whatever statistic, for
example) have a more noticable response than for writes
to data storage mediums. This is why I encourage people to
generally prioritize lookup latency.&lt;/p&gt;

&lt;p&gt;With that being said, the lookup latency from the data
storage method itself is not the only consideration because
it is possible to get even better response times if you
cache or preload. Retrieving objects from memory is
significantly faster than retrieving directly from the data
storage medium because it requires no I/O; you don’t need
to wait for the OS to respond to syscalls or network
traffic or anything. The point is, if you aren’t doing
lookups directly from the data storage, then the fact that
database lookups are faster than file lookups is irrelevant
if you can just preload the both of them to equalize the
impact of lookups. In other words, if you preload your data
into memory anyways, the lookup performance from the data
storage doesn’t matter except for the load time of your
plugin, which is mostly unimportant (and can be alleviated
because you can just do it in parallel with other plugins
booting as well).&lt;/p&gt;

&lt;p&gt;For the sake of argument, let us constrain ourselves to
having to load directly from the data storage medium. In this
case, the problem with loading from files is that data is
usually flat-mapped into files. This means you need to load
the entire file in order to read perhaps only a small
portion of it. There are ways to get around this, obviously
such as by seeking through using a &lt;code class=&quot;highlighter-rouge&quot;&gt;RandomAccessFile&lt;/code&gt; or by
splitting up a single file and organizing your data file by
file. For example, many plugins will have a player data
folder containing one file corresponding to each unique
player containing just their data. However, both of these
“solutions” introduce complexity and fragility.&lt;/p&gt;

&lt;p&gt;A database is superior to files because a properly
organized database can be easily modified in bulk using
SQL. Databases provide many guarantees such as atomicity
and are robust and fault-tolerant. Storing files requires
you to manually handle errors with data storage and are
tough to modify in bulk. You need to write your own tools
to manage or upgrade your file data if you need to lookup
by file. In other words, the “solutions” to slow file reads
is fixing a problem you created by selecting files to do
something a database is far better at doing. For databases,
read performance is baked in, you don’t need to hack it in
as you do with files.&lt;/p&gt;

&lt;p&gt;Another potential consideration with databases is with
connection latency. For networked databases, SQL queries
cross a network hop and back to reach the database. This
may not be a relevant concern if it is co-hosted or
co-located. However, even if it was relevant, you could
still avoid the network hop and use a database with
embedded options such as SQLite. Embedded databases run
locally within your plugin and are basically glorified file
abstractions as they save directly to a database file. This
is also an option if you don’t expect to be running a
networked database at all - some servers choose not to run
MySQL or MongoDB and such.&lt;/p&gt;

&lt;p&gt;Again, the lookup performance straight from data storage
only matters some of the time. When it comes to
performance, you &lt;strong&gt;must measure&lt;/strong&gt;. It is not good enough
to go with general rules of thumb. I linked my test suite
above, which is a good place to start. File and database
performance can be comparable at small data sets and with
a sufficiently fast hard drive. Performance testing is hard
and there are many pitfalls - if you are not sure, ask!
This is way outside the scope of this this blog post alone,
so again, reference the test suite I linked.&lt;/p&gt;

&lt;h4 id=&quot;implementation&quot;&gt;Implementation&lt;/h4&gt;

&lt;p&gt;The third and final goal I’d like to cover is ease of
implementation. Even though I enjoy using databases, I have
no doubt that using a file would be a lot easier most of
the time. Databases require some work to get set up and
debug in comparison to using files, and the API just isn’t
as nice to use as it is with files.&lt;/p&gt;

&lt;p&gt;With that being said, ease of implementation comes
secondary to just Using The Right Tool For The Job. If my
other goals all point to using a database, then it would
probably be eaiser for me to go with the database than to
deal with the fallout of having to re-write my entire data
management system down the line, for example. But if I
don’t need to use a database, I sure as hell would not be
using one.&lt;/p&gt;

&lt;p&gt;For example, if I were not storing player data or 
relational data, then I would simply just use a file. Some
kinds of data aren’t the kind that you organize in a useful
way in rows and columns. If it isn’t a collection of
something, it might be better to store it as a file. This
applies within the different formats and types of files and
databases as well. For example, if you were storing
something with a flexible schema, perhaps a NoSQL solution
would be better than a relational database (i.e. something
like MongoDB would be better than MySQL).&lt;/p&gt;

&lt;p&gt;With those considerations out of the way, hopefully you
will have been able to select the data storage method that
fits your goals. With that being said, how do you choose
the way that you store and load it?&lt;/p&gt;

&lt;h1 id=&quot;how-do-you-cache-and-store-data&quot;&gt;How do you cache and store data?&lt;/h1&gt;

&lt;p&gt;As far as runtime performance is concerned, caching and
storing data is much more important than the storage
medium. As I briefly mentioned in the prior section, the
differences between different data storage methods are
nullified through techniques such as preloading. So how do
you determine what techniques to use?&lt;/p&gt;

&lt;h4 id=&quot;loading-data&quot;&gt;Loading data&lt;/h4&gt;

&lt;p&gt;Loading data entails reading data from your data source and
then organizing it in memory with something like a
&lt;code class=&quot;highlighter-rouge&quot;&gt;HashMap&lt;/code&gt;. The way that you organize and ensure
thread-safety for this sort of thing is out of scope for
this blog post, but is a difficult topic nonetheless. I
would recommend a read through &lt;a href=&quot;https://www.spigotmc.org/threads/how-can-i-improve-my-database-interactions-code.407244/&quot;&gt;this&lt;/a&gt;
thread, and to ask if you have any questions. With that out
of the way, the first consideration for loading data is
when you will need to use the data. Obviously, you will
want to have the data when you need it. You can do this
just-in-time or use preloading.&lt;/p&gt;

&lt;p&gt;When you load things just-in-time, this means that actions
which need the data trigger the load. For example, ranking
players will usually be just-in-time because if you want
player ranks, you usually want the most up-to-date version
and so you will simply load data when the rank command is
run.&lt;/p&gt;

&lt;p&gt;On the other hand, you can also preload. There are many
opportunities to preload, such as preloading all of your
stored state upon the plugin enable or preloading certain
chunks or players when they are loaded or join the game.
In general, when you preload has a lot to do with memory
constraints. If you need to preload a lot of data, perhaps
it is better to do it when chunks are loaded or players
join the game to load the corresponding data for blocks in
that chunk and such. On the other hand, if you can fit all
of your data that you need into memory without much impact,
then it would obviously be a good idea to preload when the
server boots because that simplifies a lot of data
management code-wise.&lt;/p&gt;

&lt;p&gt;In terms of performance, it is always a good thing to
preload. In general, latency and memory are inversely
related. It takes more memory to organize data in a way
that reduces lookup latency. Therefore, if memory permits,
you should preload as much as you possibly can. Even when
you preload for events such as player joins, these have a
tangible performance hit because the system allocates
resources towards managing threads and executing syscalls
even for async queries. Since servers generally have a lot
of memory relative to computing power, it is worth
expending memory for performance gain.&lt;/p&gt;

&lt;p&gt;With that being said, between just-in-time loading and
preloading the entire data store, I typically prefer to use
situational preloading such on player joins. This offers a
good compromise even if it does take away resources for a
brief time. I have personally not encountered any
real-world situations where this has not been the case. In
addition, this fits nicely with the storing data model,
which I discuss in the following sub-section.&lt;/p&gt;

&lt;h4 id=&quot;storing-data&quot;&gt;Storing data&lt;/h4&gt;

&lt;p&gt;The main consideration for storing data is generally data
integrity. It is worth sacrificing some server resources to
ensure that the data in non-volatile memory is reasonably
up-to-date. In general, for any kind of persistent data, I
will have an autosave timer that will save all of the data
I have cached to the data store. I discuss this in detail
in &lt;a href=&quot;https://caojohnny.github.io/blog/2019/07/02/lessons-learned-debugging-part-5.html&quot;&gt;this&lt;/a&gt;
blog post, so read through that for more details.&lt;/p&gt;

&lt;p&gt;One relevant consideration that was only mentioned in brief
was that you must store all of your state during an
autosave in a consistent way. What this means is that if
you save multiple different files or databases, you must
save everything at the same exact snapshot, otherwise,
autosaving is worthless if the data that you save is all
at different moments in time. For example, let’s say a
player inventory is saved, the player sells an item, and
then the player currency database is saved sometime later.
If the server crashes after that, then the player would
have the item they sold but with the currency they got from
selling that item, thus potentially having dramatic
ramifications for the server’s economy if the server
crashes. The point is, it is a good idea to save the
relevant plugin state all together when you autosave.&lt;/p&gt;

&lt;p&gt;You always need to write data at the end of the plugin’s
lifetime. Player leave events are not called when the
server shuts down, so all player data and such that were
loaded needs to be saved in &lt;code class=&quot;highlighter-rouge&quot;&gt;JavaPlugin#onDisable()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Finally, any data that you load and then modify needs to be
stored. For example, as I discussed in the prior 
sub-section, you can load data just-in-time or preload
them. When the occaision to load the data ends, if any of
the data is modified, that needs to be flushed. For
example in the case of preloading, if you preload for
server boot, that needs to be written when the server
closes. If you preload on chunk load, you need to write
when that chunk unloads. When you load just-in-time and
the processing for that event ends, you should write that
data out. Again, making queries (even async) will consume
resources, but I think that doing so is worthwhile for the
purposes of data integrity. Obviously, if this is not
important, then you don’t need to do so, but I find that
these 3 occaisions are the best times to store data.&lt;/p&gt;

&lt;h4 id=&quot;connection-pooling&quot;&gt;Connection pooling&lt;/h4&gt;

&lt;p&gt;While I would like to keep this section generic to files
and databases, it is worth mentioning that if you do use a
database, you should use a connection pool.&lt;/p&gt;

&lt;p&gt;A connection pool manages connections to the database. It
allows you to keep some connections alive and so that
repeated queries will not create new connections every
time. At the same time, these connections do not stay alive
forever, and will be closed when you are not using them to
conserve server resources. If you are working with
databases I highly recommend using a connection pool.&lt;/p&gt;

&lt;p&gt;The industry standard connection pool is called
&lt;a href=&quot;https://github.com/brettwooldridge/HikariCP&quot;&gt;HikariCP&lt;/a&gt;. A
full discussion on how this works and how you use
connection pools is out of scope for this blog post, but
I will again reiterate that it is something worth learning
on your own.&lt;/p&gt;

&lt;h4 id=&quot;asynchronous-io&quot;&gt;Asynchronous I/O&lt;/h4&gt;

&lt;p&gt;I will briefly cover the rule that I/O should always be
async at runtime.&lt;/p&gt;

&lt;p&gt;When your plugin enables, you do not need to run I/O async
because you have an unlimited amount of time to setup your
plugin. I recommend using a timeout so that it doesn’t take
too long if you have a networked database and that goes
down, for example, but the main point is that you don’t
need to do I/O async in the &lt;code class=&quot;highlighter-rouge&quot;&gt;onEnable()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;When your plugin disables, you do not need to run I/O async
because you are not permitted to schedule tasks for a
disabling plugin. The same point applies as for plugin
enables.&lt;/p&gt;

&lt;p&gt;However, at any other point in time, you should &lt;strong&gt;NEVER&lt;/strong&gt;
run any kind of I/O on the server main thread. Obtaining
connections from the connection pool, running queries to a
database, reading files, writing files, opening sockets and
such should be prohibited from the main thread. An OS can
take an unlimited amount of time to respond to syscalls and
a myriad of other issues such as system load, network
bandwidth, file system response times and other such
factors can cause I/O to block or hang the main thread.
This will cause the server to crash. Therefore, I will
again reiterate that you should never run I/O calls on the
main thread. Be aware that there are further complications
from the thread-safety issues of async tasks that are
outside the scope of this blog post.&lt;/p&gt;

&lt;h4 id=&quot;store-load-dynamics&quot;&gt;Store-load dynamics&lt;/h4&gt;

&lt;p&gt;The final topic I would like to discuss when it comes to
storing and loading data is that it is very important that
stores and loads are coordinated. What I mean by this is
that when you store and load data, the data exists in two
locations: in your data storage medium and in your cache.
When you load data into your cache, you should only modify
data in the cache; if you are making changes to both the
cache and the data store, they will become out of sync with
each other and the cache will overwrite any prior changes
you have made to the data store since loading the data into
cache.&lt;/p&gt;

&lt;p&gt;The way that I think about this is there must be a single
source of truth. Only one of your cache or your data store
must contain the most up-to-date time at any given moment
in time. When the server begins, the data store is the
source of truth. When you load one piece of data into your
cache, the cache becomes the source of truth for that one
piece of data. When you flush that data, the data store
again becomes your source of truth.&lt;/p&gt;

&lt;p&gt;The point I am making is that each time your source of
truth changes, your plugin needs to know and then
coordinate how you store and load data in the plugin. As I
have mentioned that thread-safety is out of the scope of
this blog post, I will leave this topic as is with the
ending note that you need to synchronize each time the
source of truth changes.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Having gone through this post, I hope that it will have
answered some questions about storing data. More
importantly, I hope that it has showed how the engineering
process works. Being able to gather information, make
decisions with that information, implement, test, evaluate
and iterate on your design and code is a very important
skill to have as a programmer. I hope that applying this to
the process of writing plugins makes you a better
programmer and a better engineer.&lt;/p&gt;

&lt;p&gt;Happy New Years. Here’s to 2021, starting off with this
post.&lt;/p&gt;

&lt;p&gt;In the interest of completeness, this blog post was
compiled from the various bits of information I’ve posted
over the years on SpigotMC. If you are curious and would
like to read more or to see examples of contexts where the
information I have presented is used, I have a reading list
of posts &lt;a href=&quot;https://www.spigotmc.org/threads/best-practice-for-storing-player-data-currency-etc.476563/#post-4018642&quot;&gt;here&lt;/a&gt;
that may be of help.&lt;/p&gt;</content><author><name></name></author><summary type="html">As I preface in many of my blog posts, the information I present will apply to Java applications, and in particular, Bukkit plugins.</summary></entry><entry><title type="html">How to Architecture Java Code</title><link href="https://caojohnny.github.io/blog/2020/12/24/how-to-architecture-java-code.html" rel="alternate" type="text/html" title="How to Architecture Java Code" /><published>2020-12-24T14:00:13-08:00</published><updated>2020-12-24T14:00:13-08:00</updated><id>https://caojohnny.github.io/blog/2020/12/24/how-to-architecture-java-code</id><content type="html" xml:base="https://caojohnny.github.io/blog/2020/12/24/how-to-architecture-java-code.html">&lt;p&gt;I bring this up a lot, but my experiences trawling through
programming forums such as SpigotMC’s Plugin Development
section has allowed me to read a lot of code written by
novices. Of the many recurring themes that I see, the lack
of a solid &lt;em&gt;architecture&lt;/em&gt; or a system-level design comes up
relatively often.&lt;/p&gt;

&lt;p&gt;And again, as I often bring up, this is not necessarily the
fault of the novice developer. Indeed, from what I have
seen of the work of CS majors, even the education system
has difficulty grappling with the code design aspect. But
since I am not a CS major, I would avoid putting too much
weight in this observation; however, the point still stands
that many novices don’t really know how to architecture
their code.&lt;/p&gt;

&lt;p&gt;As with my &lt;a href=&quot;https://caojohnny.github.io/blog/2020/11/10/how-to-be-a-good-programmer.html&quot;&gt;prior post&lt;/a&gt;,
I attempt to show how to &lt;em&gt;think&lt;/em&gt;. It is easy to memorize
algorithms, design patterns, whatever. But, it is difficult
to analyze and structure your code, because you need to
fundamentally change the way you &lt;em&gt;think&lt;/em&gt; about the code.&lt;/p&gt;

&lt;h1 id=&quot;what-is-code-architecture&quot;&gt;What is code architecture?&lt;/h1&gt;

&lt;p&gt;I will primarily address code architecture in Java. The
same concepts may apply to other similar languages,
especially if they are Object-Oriented Programming (OOP)
languages as well, but I make no guarantees to those
applications. I will place particular emphasis on Bukkit
plugins as they provide an extremely easy application of
Java architectures as there are many components that are
already understood by many people.&lt;/p&gt;

&lt;p&gt;I have mentioned this in passing already, but code
architecture is the design of your code - the structure
of your code. The way that classes are related to one
another, how classes are initialized, managed, destroyed,
etc.&lt;/p&gt;

&lt;p&gt;While this sounds relatively simple, it is very easy to
write code that is nonsensically structured. It takes time
to architecture code, time that you could instead be using
to writing the actual code itself instead of structuring
and moving things around. It sounds like a complete waste
of time.&lt;/p&gt;

&lt;h1 id=&quot;why-should-i-care-about-code-architecture&quot;&gt;Why should I care about code architecture?&lt;/h1&gt;

&lt;p&gt;The most basic way of looking at this is that poor
application architecture is a problem. You should avoid
having problems with your code.&lt;/p&gt;

&lt;p&gt;Poor code architecture makes code difficult to read and
understand. It hides mistakes and obfuscates your code.
It is inflexible and hard to extend or modify. It makes
utilizing your code awkward both to yourself and other
developers.&lt;/p&gt;

&lt;p&gt;While carefully architecturing your code may take a bit
more initial time, you will end up saving time as it will
be easier to debug and extend later on.&lt;/p&gt;

&lt;p&gt;Most importantly, well-architectured code makes writing
code more fun.&lt;/p&gt;

&lt;h1 id=&quot;how-do-i-architecture-my-code&quot;&gt;How do I architecture my code?&lt;/h1&gt;

&lt;h4 id=&quot;hierarchy&quot;&gt;Hierarchy&lt;/h4&gt;

&lt;p&gt;The first thing to think about is always hierarchy. Every
Java program only has a few entry-points, if not only 1.
What this means is that although your program might have
many different functions or components, all of them must
eventually come from a single place, i.e. the
&lt;code class=&quot;highlighter-rouge&quot;&gt;main(String[] args)&lt;/code&gt; method.&lt;/p&gt;

&lt;p&gt;Therefore, there must be a hierarchy of some sort. The
most fundamental structure is that the program’s
entry-point sits above every other function of the program.
A complex program can have multiple “layers” to the
hierarchy. For example, a Bukkit plugin will have its plugin
&lt;code class=&quot;highlighter-rouge&quot;&gt;onEnable()&lt;/code&gt; at the top, then followed by perhaps different
modules, each module will have its own commands and
listeners, and beneath those might be configuration files
and different methods of storing data.&lt;/p&gt;

&lt;p&gt;The point of the hierarchy is to keep management of object
lifecycles controlled. An object at any level of the
hierarchy may only be permitted to manage the relevant
objects &lt;em&gt;strictly&lt;/em&gt; beneath them in the hierarchy. I say
strictly because this precludes the use of
&lt;a href=&quot;https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons&quot;&gt;singletons&lt;/a&gt;
from a design standpoint (though I shouldn’t have to remind
readers that there are exceptions to every rule - read the
last post on How to be a Good Programmer!)&lt;/p&gt;

&lt;p&gt;For example, consider a &lt;code class=&quot;highlighter-rouge&quot;&gt;Listener&lt;/code&gt; class that keeps track
of a collection of &lt;code class=&quot;highlighter-rouge&quot;&gt;Player&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;UUID&lt;/code&gt;s and a &lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt;
that is supposed to save that collection of players when
the server is closed:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// WARNING: BAD CODE AND BAD DESIGN!&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PlayerUUIDListener&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Listener&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuids&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PlayerUUIDListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;playerUuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are a few issues with this design outside of the
architecture alone; however, for the sake of brevity, let
us concentrate on just the architectural issue at hand.
The &lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt; class manages the lifecycle of another
class because it accesses the &lt;code class=&quot;highlighter-rouge&quot;&gt;playerUuids&lt;/code&gt; field to save
it on shutdown. We would expect that &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerUUIDListener&lt;/code&gt;
is beneath &lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt; on the class hierarchy, but that
doesn’t make any sense. If you were to add another class
that relies upon &lt;code class=&quot;highlighter-rouge&quot;&gt;playerUuids&lt;/code&gt;, then it must either be at
the same level of &lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt; or both &lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt; and
the new class must be at the same level as
&lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerUUIDListener&lt;/code&gt;. These are both undesirable outcomes
because they jumble up the organization.&lt;/p&gt;

&lt;p&gt;However, we could solve this problem by placing the
&lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt; beneath the other classes like so:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// WARNING: BAD CODE BUT GOOD DESIGN&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PlayerUUIDListener&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Listener&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuids&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That way, any accesses to the &lt;code class=&quot;highlighter-rouge&quot;&gt;playerUuids&lt;/code&gt; from other
classes strictly defer to &lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt;, where all the
other management code is located. This design makes a lot
more sense and permits for better encapsulation, which
would eventually fix the bad code aspect of the snippet:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// GOOD CODE AND GOOD DESIGN&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PlayerUUIDListener&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Listener&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;PlayerUUIDListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;dataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuids&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getPlayerUuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;unmodifiableList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;playerUuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerUuid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;playerUuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To continue further with this, let us move to the next
topic on abstraction.&lt;/p&gt;

&lt;h4 id=&quot;abstraction&quot;&gt;Abstraction&lt;/h4&gt;

&lt;p&gt;Abstraction is absolutely key for designing software.
Firstly, it permits you to control access to objects and
state fields in the form of encapsulation. Secondly, it
increases flexibility because it prevents users from
relying upon concrete implementations. Finally, it reduces
bugginess because it reduces the mental overhead of having
to think about what methods and classes &lt;em&gt;are&lt;/em&gt;, only what
they &lt;em&gt;do&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Personally, I use abstraction also for increasing iteration
cadence when writing code. I generally work from the top of
the hierarchy down. When I get to the hard stuff, things
like managing data or large amounts of logic or conditions
on data, I will simply write an interface and keep moving
on.&lt;/p&gt;

&lt;p&gt;What this would look like for the above code snippet is the
following:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I start writing my &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerUUIDListener&lt;/code&gt;, I could do
something like:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// WARNING: QUESTIONABLE DESIGN&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getPlayerUuids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, that depends on what I’m doing. Here, I have
provided a generic method of getting a collection. This is
a step in the right direction, as many novices would return
a concrete &lt;code class=&quot;highlighter-rouge&quot;&gt;List&amp;lt;UUID&lt;/code&gt; or even &lt;code class=&quot;highlighter-rouge&quot;&gt;ArrayList&amp;lt;UUID&amp;gt;&lt;/code&gt; for
example. On the other hand, what if I wanted to specify an
index-accessible collection? One option is I could use a
&lt;code class=&quot;highlighter-rouge&quot;&gt;List&amp;lt;UUID&amp;gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;However, a &lt;code class=&quot;highlighter-rouge&quot;&gt;List&amp;lt;E&amp;gt;&lt;/code&gt; provides the &lt;code class=&quot;highlighter-rouge&quot;&gt;add(...)&lt;/code&gt; method, which
is unenforcable at compile-time. In certain circumstances,
I may even consider doing something like:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// POTENTIALLY BETTER DESIGN&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getPlayerUuid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That way, the fact that the list is read-only is guaranteed
at compile-time; though this will expose you to potential
index bound exceptions. Collections are pretty common to
expose, so it may be still be worth considering abstracting
away even access to the collection itself. On the other
hand, you can also consolidate methods into a collection
and go the opposite direction if it suits your needs
better. This is where that brain of yours comes into play,
you need to decide what design results in more sensible
code for your specific purpose.&lt;/p&gt;

&lt;p&gt;Once I have completed writing all of my other classes, I
will generally write some dummy code in the place of the
&lt;code class=&quot;highlighter-rouge&quot;&gt;DataManager&lt;/code&gt; and provide that through dependency-injection
so I can easily swap between implementations:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DataManagerImpl&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DataManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getPlayerUuid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This technique of using abstraction to increase development
cadence is extremely flexible, fast and is generally a joy
to write. I don’t need to worry about writing all of the
boring code until the end, and the easier code is a lot
more enjoyable to write because I’m able just to speed
through writing it from all of the interfaces I’ve written.&lt;/p&gt;

&lt;p&gt;There are even more forms of abstraction than simply
structuring your methods. For example, you can abstract
data fields into wrapper classes. This is a deceptively
useful way of managing data, you should always create
wrappers to represent things that have a function outside
of what the data types suggest. This can be seen in action
&lt;a href=&quot;https://github.com/caojohnny/sched-temporal-test&quot;&gt;here&lt;/a&gt;,
where I create a wrapper for a single counter variable
because it represents more than simply a &lt;code class=&quot;highlighter-rouge&quot;&gt;long&lt;/code&gt; type; it is
a counter that only makes sense if you know that it
represents in-game ticks.&lt;/p&gt;

&lt;p&gt;Another form of abstraction that you may consider is
modularizing your code.&lt;/p&gt;

&lt;h4 id=&quot;modularity&quot;&gt;Modularity&lt;/h4&gt;

&lt;p&gt;I consider modularity so important that it deserves its
own mini-section. On a smaller scale, you should aim to
self-contain the function of your class. So long as the
class is responsible for a “single” thing, you want as
much of the function to be hidden away from other classes
as possible. On a wider scale, entire portions of the code
can be sectioned-off in a way to prevent other modules from
knowing about the state of those modules.&lt;/p&gt;

&lt;p&gt;For example, there are many times where I have written
plugins that consolidate multiple different kinds of events
or gamemodes under a single codebase. In that case, I will
generally have an abstraction for each kind of event and
put all of the code relating to that event under its own
module. All of the listeners, the commands, the tasks, the
data, the configuration, etc. belong to the module for each
specific event. That way, when the module is set up, the
code is organized around that module is initialized
together and then cleaned up together at the end.&lt;/p&gt;

&lt;p&gt;In general, when people think of modular code, they believe
that its usefulness derives from being able to turn modules
on and off without affecting other parts of the codebase.
While this is certainly true to an extent, I very rarely
use modules this way. In fact, I very frequently
communicate between modules anyway so this might not be as
compelling of a reason as you’d think. The main benefit
that I find from modularity is that modular code is just
much simpler to read and understand. Because a module is
self-contained, I can safely ignore most other modules
because I know those are self-contained as well. I only
need to think about a single module at a time. If I get a
bug in one aspect of my application, I can narrow down
the cause of the error if I know which module handles that
function. Again, because modules are a form of abstraction,
all of the benefits of abstraction that I’ve discussed come
along for the ride as well.&lt;/p&gt;

&lt;p&gt;At a high-level, you could use Maven modules to separate
code that is actually meant to be interchangable, such as
&lt;a href=&quot;https://github.com/caojohnny/lagger&quot;&gt;for NMS&lt;/a&gt;. At a lower
level, you could have separate packages to do something
similar to the events plugin I discussed earlier. One
example of this can be found in a &lt;a href=&quot;https://github.com/caojohnny/microopts/tree/master/src/jmh/java/io/github/caojohnny/microopts&quot;&gt;benchmark suite&lt;/a&gt;,
where packages are self-contained and do not use code
from other packages or “modules.”&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;I’ve summarized a few key concepts for architecturing your
code. There are a lot of important concepts in OOP
languages that many novice developers don’t really know how
to use outside of just theoretical applications. I hope
that with concrete examples and an explanation of how I
personally design my programs to work well in the field,
you will have gained a better understanding of how to
architecture better code. In case it might not be obvious,
the only way to tune your sense of design is to practice,
practice and practice some more. Even more importantly, you
should have your code reviewed. Practicing the wrong
concepts only solidifies bad design choices, so always look
for ways to critique your own code as well as for others to
critique your code for you.&lt;/p&gt;</content><author><name></name></author><summary type="html">I bring this up a lot, but my experiences trawling through programming forums such as SpigotMC’s Plugin Development section has allowed me to read a lot of code written by novices. Of the many recurring themes that I see, the lack of a solid architecture or a system-level design comes up relatively often.</summary></entry><entry><title type="html">How to be a Good Programmer</title><link href="https://caojohnny.github.io/blog/2020/11/10/how-to-be-a-good-programmer.html" rel="alternate" type="text/html" title="How to be a Good Programmer" /><published>2020-11-10T19:41:10-08:00</published><updated>2020-11-10T19:41:10-08:00</updated><id>https://caojohnny.github.io/blog/2020/11/10/how-to-be-a-good-programmer</id><content type="html" xml:base="https://caojohnny.github.io/blog/2020/11/10/how-to-be-a-good-programmer.html">&lt;p&gt;I’ve spent a lot of time roaming around programming forums
and working with other developers. The way that many
developers think about their code is in terms of
objectives. How can I make this code be better? How can
I make this code faster? How can I make it more readable?
Don’t get me wrong - these are all good questions to ask.
It is a &lt;strong&gt;good&lt;/strong&gt; thing to be concerned with objectives that
your code fulfills.&lt;/p&gt;

&lt;p&gt;The issue with problematic code is that the problem extends
beyond just the code itself – those problems often stem
from the programmer. The way that a programmer thinks and
approaches problems drastically change the code they
produce.&lt;/p&gt;

&lt;p&gt;It is really easy to teach people how to fix bad code. It
is much more difficult to teach them how to become a Good
Programmer, to the point that most people don’t even
bother. I don’t mean this as an insult to novice
developers - in many ways, this is more of a problem with
people answering questions on programming forums than
anyone else. We are enamored with the age-old adage: give a
man a fish, feed him for a day and all that. But the best
solution we’ve come up with is telling people to “Look it
up.” “Look at the documentation.” “Read this.” “Read that.”&lt;/p&gt;

&lt;p&gt;Again, don’t get me wrong, it is a &lt;em&gt;good&lt;/em&gt; thing to be
helpful. It is &lt;em&gt;good&lt;/em&gt; to give resources and to refer people
who otherwise would not know how to approach
problem-solving to search engines and the documentation.&lt;/p&gt;

&lt;p&gt;However, this is a surface-level solution to a deeper
problem. Novice developers don’t know how to be Good
Programmers.&lt;/p&gt;

&lt;h1 id=&quot;what-is-a-good-programmer&quot;&gt;What is a Good Programmer?&lt;/h1&gt;

&lt;p&gt;Allow me to preface by describing what it means to &lt;em&gt;not&lt;/em&gt; be
a Good Programmer.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Not&lt;/em&gt; being a Good Programmer does not mean you are a Bad
Programmer. But it can.&lt;/p&gt;

&lt;p&gt;A Bad Programmer is unwilling to learn. A Bad Programmer is
not open to new ideas. A Bad Programmer is resistant to
critique.&lt;/p&gt;

&lt;p&gt;If you are a Bad Programmer, you can safely close your
browser tab. I can’t help you.&lt;/p&gt;

&lt;p&gt;However, not all those who are &lt;em&gt;not&lt;/em&gt; Good Programmers are
Bad Programmers. Novices and intermediate developers can
become Good Programmers. Even accomplished career software
engineers can become Good Programmers if they have not
already.&lt;/p&gt;

&lt;p&gt;Being a Good Programmer means that you are an effective
thinker. It means you are an effective problem-solver. To
be a successful developer, you should strive to be a Good
Programmer.&lt;/p&gt;

&lt;h1 id=&quot;why-is-it-important-to-be-a-good-programmer&quot;&gt;Why is it important to be a Good Programmer?&lt;/h1&gt;

&lt;p&gt;A Good Programmer writes better code.&lt;/p&gt;

&lt;p&gt;A Good Programmer writes fast code.&lt;/p&gt;

&lt;p&gt;A Good Programmer writes less buggy code.&lt;/p&gt;

&lt;p&gt;A Good Programmer is more employable.&lt;/p&gt;

&lt;p&gt;A Good Programmer enjoys their work.&lt;/p&gt;

&lt;h1 id=&quot;what-makes-a-good-programmer&quot;&gt;What makes a Good Programmer?&lt;/h1&gt;

&lt;p&gt;Every item in this list is connected, in more ways than
one.&lt;/p&gt;

&lt;h4 id=&quot;1-a-good-programmer-does-not-follow-a-list-of-rules&quot;&gt;1. A Good Programmer does not follow a list of rules&lt;/h4&gt;

&lt;p&gt;You do not become a Good Programmer by using a checklist to
make sure you are doing every single action.&lt;/p&gt;

&lt;h4 id=&quot;2-a-good-programmer-understands-context&quot;&gt;2. A Good Programmer understands context&lt;/h4&gt;

&lt;p&gt;You do not become a Good Programmer if you constantly break
rules that you are meant to follow.&lt;/p&gt;

&lt;p&gt;This is not a list of rules. This is a list of precepts.
These are things that are actions that are common amongst
Good Programmers. A Good Programmer does not refer to this
list every time they encounter a problem.&lt;/p&gt;

&lt;h4 id=&quot;3-a-good-programmer-uses-rationale&quot;&gt;3. A Good Programmer uses rationale&lt;/h4&gt;

&lt;p&gt;Understanding how things work and why they work improves
your intution of why it is done.&lt;/p&gt;

&lt;p&gt;If you understand why these precepts exist, you do not need
to memorize them. You have the intuition that this is
correct way to approach problem-solving.&lt;/p&gt;

&lt;h4 id=&quot;4-a-good-programmer-understands-nuance&quot;&gt;4. A Good Programmer understands nuance&lt;/h4&gt;

&lt;p&gt;Every rule or solution has an exception.&lt;/p&gt;

&lt;p&gt;Many problems are more detailed than they initially appear.
It is important to determine whether or not precepts can be
applied in each scenario.&lt;/p&gt;

&lt;h4 id=&quot;5-a-good-programmer-follows-good-practices&quot;&gt;5. A Good Programmer follows good practices&lt;/h4&gt;

&lt;p&gt;You should remember good practices because they are robust
ways to solve problems in most cases.&lt;/p&gt;

&lt;p&gt;Good practices exist because Good Programmers understand
the rationale for using them. Departing from good practices
&lt;em&gt;requires&lt;/em&gt; you to justify that decision. It is harder to
justify this departure than to simply use the default
approach.&lt;/p&gt;

&lt;h4 id=&quot;6-a-good-programmer-communicates-intent&quot;&gt;6. A Good Programmer communicates intent&lt;/h4&gt;

&lt;p&gt;Code should communicate what it is &lt;em&gt;meant&lt;/em&gt; to do.&lt;/p&gt;

&lt;p&gt;Expressive code is easier to read and review. Expressive
code makes it harder to write buggy code.&lt;/p&gt;

&lt;h4 id=&quot;7-a-good-programmer-understands-bugs&quot;&gt;7. A Good Programmer understands bugs&lt;/h4&gt;

&lt;p&gt;It is important to understand &lt;em&gt;why&lt;/em&gt; the bug arose.&lt;/p&gt;

&lt;p&gt;As the adage goes, debugging is the process of removing
bugs from the code. Therefore, programming is the process
of putting them in.&lt;/p&gt;

&lt;p&gt;You are the source of all bugs. Therefore, you should
understand what lead to &lt;em&gt;you&lt;/em&gt; to write buggy code.&lt;/p&gt;

&lt;h4 id=&quot;8-a-good-programmer-notices-patterns&quot;&gt;8. A Good Programmer notices patterns&lt;/h4&gt;

&lt;p&gt;Patterns are nearly never the result of pure coincidence.&lt;/p&gt;

&lt;p&gt;There is a reason why patterns exist. It is easier to read
code if you think about it in terms of patterns. Noticing
patterns can help diagnose bugs.&lt;/p&gt;

&lt;h4 id=&quot;9-a-good-programmer-is-perceptive&quot;&gt;9. A Good Programmer is perceptive&lt;/h4&gt;

&lt;p&gt;Your understanding of the code and its behavior is based
upon observation.&lt;/p&gt;

&lt;p&gt;In order to understand the code or problems with the code,
it is necessary to take note of the relevant details and
collect more information as needed.&lt;/p&gt;

&lt;h4 id=&quot;10-a-good-programmer-is-selective&quot;&gt;10. A Good Programmer is selective&lt;/h4&gt;

&lt;p&gt;More importantly, you should be wary of considering
irrelevant information and invalid solutions.&lt;/p&gt;

&lt;p&gt;It is easier to reason about code when you are not bogged
down with superfluous information and constructs.&lt;/p&gt;

&lt;h4 id=&quot;11-a-good-programmer-fixes-high-level-issues-first&quot;&gt;11. A Good Programmer fixes high-level issues first&lt;/h4&gt;

&lt;p&gt;Problems should be prioritized by their scope.&lt;/p&gt;

&lt;p&gt;Lower-level problems are irrelevant if a wider issue
exists. Fixing high-level problems lead to a greater
overall benefit for the code.&lt;/p&gt;

&lt;h4 id=&quot;12-a-good-programmer-selects-the-correct-tools&quot;&gt;12. A Good Programmer selects the correct tools&lt;/h4&gt;

&lt;p&gt;You should know when and where to apply different methods
and techniques.&lt;/p&gt;

&lt;p&gt;The right tools make it easier to write good code. Good
Programmers avoid using the wrong tools because they cause
issues.&lt;/p&gt;

&lt;h4 id=&quot;13-a-good-programmer-is-capable-of-cost-benefit-analysis&quot;&gt;13. A Good Programmer is capable of cost-benefit analysis&lt;/h4&gt;

&lt;p&gt;No solution is free of flaws.&lt;/p&gt;

&lt;p&gt;You should be able to evaluate and justify why the benefits
of using one solution outweigh its costs and the benefits
of the solutions you did not use.&lt;/p&gt;

&lt;h4 id=&quot;14-a-good-programmer-sees-the-bigger-picture&quot;&gt;14. A Good Programmer sees the bigger picture&lt;/h4&gt;

&lt;p&gt;Your code does not exist in a vacuum.&lt;/p&gt;

&lt;p&gt;You should be able to understand the surrounding context.
A Good Programmer puts their decisions and their code into
perspective.&lt;/p&gt;

&lt;h4 id=&quot;15-a-good-programmer-engineers-solutions&quot;&gt;15. A Good Programmer engineers solutions&lt;/h4&gt;

&lt;p&gt;The engineering process is an effective way of solving
problems.&lt;/p&gt;

&lt;p&gt;You should be able to make realistic assumptions, design
prototypes, test and verify your solutions and iterate.&lt;/p&gt;

&lt;h4 id=&quot;16-a-good-programmer-builds-off-their-experiences&quot;&gt;16. A Good Programmer builds off their experiences&lt;/h4&gt;

&lt;p&gt;Your experiences are your greatest asset.&lt;/p&gt;

&lt;p&gt;A Good Programmer uses their experiences to inform their
decisions.&lt;/p&gt;

&lt;h4 id=&quot;17-a-good-programmer-sees-opportunities-to-learn-and-grow&quot;&gt;17. A Good Programmer sees opportunities to learn and grow&lt;/h4&gt;

&lt;p&gt;You should be open to adding new experiences and adapting
yourself to critique.&lt;/p&gt;

&lt;p&gt;A Good Programmer is never satisfied with their own level
of knowledge. They continually seek further knowledge and
feedback.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;These precepts are not all that make a Good Programmer.
Learning how to apply these precepts requires experience,
and most importantly, time.&lt;/p&gt;

&lt;p&gt;These are only some of the examples of what many novice
developers commonly miss, but it is not an exhaustive list.
Luckily, it was never meant to be.&lt;/p&gt;

&lt;p&gt;Keep these at the back of your mind. Take a look at it
every once in a while. You have already started on the path
to becoming a Good Programmer just by thinking beyond just
the code itself.&lt;/p&gt;</content><author><name></name></author><summary type="html">I’ve spent a lot of time roaming around programming forums and working with other developers. The way that many developers think about their code is in terms of objectives. How can I make this code be better? How can I make this code faster? How can I make it more readable? Don’t get me wrong - these are all good questions to ask. It is a good thing to be concerned with objectives that your code fulfills.</summary></entry><entry><title type="html">Lessons Learned Debugging: Part 11</title><link href="https://caojohnny.github.io/blog/2020/03/21/lessons-learned-debugging-part-11.html" rel="alternate" type="text/html" title="Lessons Learned Debugging: Part 11" /><published>2020-03-21T19:54:10-07:00</published><updated>2020-03-21T19:54:10-07:00</updated><id>https://caojohnny.github.io/blog/2020/03/21/lessons-learned-debugging-part-11</id><content type="html" xml:base="https://caojohnny.github.io/blog/2020/03/21/lessons-learned-debugging-part-11.html">&lt;p&gt;I didn’t even realize that I haven’t written a post this
year yet. Event handlers are key components of plugins
because they are used as an entry point to most plugin
logic. Think of plugins like WorldGuard, minigame plugins
and other game features like crates, quests etc. All of
them use event handlers as an intrinsic component of their
primary function. Yet, many plugin developers, even those
who should know better, seem to write event handlers that
break the functionality of other plugins or prevent other
plugins from being able to listen to events.&lt;/p&gt;

&lt;h1 id=&quot;event-handlers-should-play-nice&quot;&gt;Event Handlers Should Play Nice&lt;/h1&gt;

&lt;p&gt;The source for a lot of misunderstanding about how event
handlers work is the &lt;a href=&quot;https://hub.spigotmc.org/javadocs/spigot/org/bukkit/event/EventHandler.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@EventHandler&lt;/code&gt;&lt;/a&gt;
annotation. The purpose of this annotation, first and
foremost, is to mark methods which are to be called by the
plugin manager when events are fired. Secondly, it provides
to options: and &lt;code class=&quot;highlighter-rouge&quot;&gt;priority&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoredCancelled&lt;/code&gt;. While
these options both have defaults, those defaults are not
always correct. In fact, many developers don’t even know
what they do or how changing them can impact other plugins.
Let’s take a look at how using the &lt;code class=&quot;highlighter-rouge&quot;&gt;@EventHandler&lt;/code&gt;
annotation &lt;em&gt;correctly&lt;/em&gt; can help plugins maintain
compatibility with each other.&lt;/p&gt;

&lt;h1 id=&quot;event-priorities&quot;&gt;Event Priorities&lt;/h1&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;priority&lt;/code&gt; option allows developers to tell the plugin
manager when, with respect to other plugin event handlers,
they want the event handler to be called. This can be
thought of as the server storing a list of event handlers
to be called each time the appropriate event is being
called. Changing the event priority can allow you to have
your event handler called prior to other event handlers,
or cede to other event handlers to be called first. This
operates on a per-handler basis, meaning that the priority
of event handlers allows them to be reordered with any
other event handler, regardless of whether they belong to
the same plugin or not.&lt;/p&gt;

&lt;p&gt;The first common misconception about event priority is that
it allows you to detect an event earlier. This is false.
Event handlers with different priorities receive events at
the same time. For example, an event handler listening for
&lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerMoveEvent&lt;/code&gt; will not receive &lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerMoveEvent&lt;/code&gt; any
sooner or respond any faster to a player moving by changing
the priority of the event. What changes with different
priorities is the &lt;em&gt;order&lt;/em&gt; that event listeners are called,
&lt;strong&gt;not&lt;/strong&gt; &lt;em&gt;when&lt;/em&gt;. Ultimately, all events are called with
something like the following line:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Bukkit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPluginManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;callEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All event handlers are called by
&lt;code class=&quot;highlighter-rouge&quot;&gt;PluginManager#callEvent(Event)&lt;/code&gt;, so it doesn’t make any
sense for an event to somehow be fired sooner by changing
the event handler priority.&lt;/p&gt;

&lt;p&gt;The second common misconception about event priority is the
order that event handlers are called with respect to their
priority. Many novice developers believe that a
&lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.LOW&lt;/code&gt; event handler is handled after
&lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.HIGH&lt;/code&gt;, event handler. In fact, the opposite
is true: higher priority events are called &lt;em&gt;later&lt;/em&gt; than
lower priority events. From the JavaDoc page:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;First priority to the last priority executed:&lt;/p&gt;

  &lt;ol&gt;
    &lt;li&gt;LOWEST&lt;/li&gt;
    &lt;li&gt;LOW&lt;/li&gt;
    &lt;li&gt;NORMAL&lt;/li&gt;
    &lt;li&gt;HIGH&lt;/li&gt;
    &lt;li&gt;HIGHEST&lt;/li&gt;
    &lt;li&gt;MONITOR&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;Registered events utilize an &lt;code class=&quot;highlighter-rouge&quot;&gt;ArrayList&lt;/code&gt; to organize event
handlers of the same priority, so two event handlers with
&lt;code class=&quot;highlighter-rouge&quot;&gt;NORMAL&lt;/code&gt; priority are executed in insertion order or the
same order they were registered in.&lt;/p&gt;

&lt;p&gt;To understand why this is the case, we need to look at why
you would even want to change your event priority in the
first place.&lt;/p&gt;

&lt;p&gt;The purpose of a &lt;code class=&quot;highlighter-rouge&quot;&gt;HIGH&lt;/code&gt; priority event handler is such that
it has a greater precedence over what happens as a result
of an event being fired. As such, it should fire later than
a &lt;code class=&quot;highlighter-rouge&quot;&gt;LOW&lt;/code&gt; priority event handler because it would be able to
override anything that the &lt;code class=&quot;highlighter-rouge&quot;&gt;LOW&lt;/code&gt; priority event handler
does if it so wishes.&lt;/p&gt;

&lt;p&gt;The crux of many compatibility issues is event handlers
being set to the wrong priority. One personal example is a
plugin that creates mines that used an event handler set to
&lt;code class=&quot;highlighter-rouge&quot;&gt;HIGHEST&lt;/code&gt; priority to detect &lt;code class=&quot;highlighter-rouge&quot;&gt;BlockBreakEvent&lt;/code&gt;s. While the
developer might have thought this was a good idea since
they might want to override any other plugin when it comes
to preventing a block in the mine from being broken at
certain times, this prevented me from being able to use
&lt;code class=&quot;highlighter-rouge&quot;&gt;BlockBreakEvent&lt;/code&gt; to change whether or not the event would
be cancelled. There are a number of hacky workarounds to
this (such as changing the event priority of the plugin or
renaming your plugin jar file so your plugin loads later or
incorrectly using the &lt;code class=&quot;highlighter-rouge&quot;&gt;MONITOR&lt;/code&gt; priority), but the point
still stands: using the wrong priority makes it difficult
for other plugins to provide additional features and
functionality.&lt;/p&gt;

&lt;p&gt;So what is the correct event priority to use? These are not
hard and fast rules, obviously, but in general:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;If you don’t know, leave it alone. The default priority
  is &lt;code class=&quot;highlighter-rouge&quot;&gt;NORMAL&lt;/code&gt;, which is the priority most event handlers
  should use. This is a safe option regardless of what your
  event handler does.&lt;/li&gt;
  &lt;li&gt;If you want other plugins to utilize your plugin’s
  functionality as a principal feature use &lt;code class=&quot;highlighter-rouge&quot;&gt;LOW&lt;/code&gt;. For
  example, protection plugins should use this because
  other plugins depend on whether or not an event is
  allowed (that the event is not cancelled).&lt;/li&gt;
  &lt;li&gt;If you need to override the event handler of another
  plugin, then it is acceptable to use &lt;code class=&quot;highlighter-rouge&quot;&gt;HIGH&lt;/code&gt; priority&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If your plugin &lt;strong&gt;requires&lt;/strong&gt; a certain priority for your
event handler to function correctly on its own (i.e. not
because some other plugin is being overridden), &lt;strong&gt;it is
broken&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Avoid using &lt;code class=&quot;highlighter-rouge&quot;&gt;HIGHEST&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;MONITOR&lt;/code&gt; priorities, even if
you know you are using them correctly. The purpose of a
&lt;code class=&quot;highlighter-rouge&quot;&gt;MONITOR&lt;/code&gt; event priority is for listeners that do not make
any changes to the event, e.g. they don’t cancel or modify
the event the handler listens for in any way. However, this
precludes other plugins from checking for any state changes
to your plugin as a result of an event because the
&lt;code class=&quot;highlighter-rouge&quot;&gt;MONITOR&lt;/code&gt; priority event handlers always run last. As I’ve
already discussed, a &lt;code class=&quot;highlighter-rouge&quot;&gt;HIGHEST&lt;/code&gt; priority event listener
requires other event listeners to use &lt;code class=&quot;highlighter-rouge&quot;&gt;MONITOR&lt;/code&gt; in order
to override them or some other hack, which means that your
plugin impedes other developers from writing correct,
well-defined code.&lt;/p&gt;

&lt;p&gt;Now just to make sure we are all clear, when I say that
something is incorrect, I don’t mean it is disallowed or
that anything bad happens when you do something like
mutate an event inside a &lt;code class=&quot;highlighter-rouge&quot;&gt;MONITOR&lt;/code&gt; event handler. However,
compatibility is based on plugins agreeing to follow the
same “rules.” Breaking these rules without knowing what
you are doing potentially causes other plugins which do
follow these rules to break as well. This is why it is your
responsibility to “play nice” with other plugins by using
the correct event priorities.&lt;/p&gt;

&lt;p&gt;As a side note, I personally believe it is a mistake to use
an enum as an event priority. Event handlers in different
plugins can have many layers, even more than there are enum
constants to use in the &lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority&lt;/code&gt; enum. The standard
way to implement priorities is through a numbering system,
e.g. low priority events use 0 and high priority events use
something like 100. This allows much wider range of event
handlers to build off the functionality of other plugins.
That being said, I do concede that these issues may still
exist if developers use &lt;code class=&quot;highlighter-rouge&quot;&gt;Integer.MAX_VALUE&lt;/code&gt;, for example,
and that too many event handlers overriding each other
generally are very fragile. Nonetheless, food for thought.&lt;/p&gt;

&lt;h1 id=&quot;ignore-cancelled-events&quot;&gt;Ignore Cancelled Events&lt;/h1&gt;

&lt;p&gt;Another commonly misused (actually unused would probably be
more fitting) option is &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled&lt;/code&gt;. The purpose of
this annotation is for that event handlers to be skipped
when the event is cancelled by some other event handler
running before it. The default value of &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled&lt;/code&gt;
is &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt;, meaning that the event handler runs regardless
of whether the event has been cancelled or not. This is the
source for some confusion as many people seem to suggest
checking if an event is being cancelled by another plugin
when &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled&lt;/code&gt; is not specified. As a matter of
fact, your event handler will run anyway if you do not
explicitly use &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt;, so this advice is
a waste of time at best.&lt;/p&gt;

&lt;p&gt;A great many event handlers lack this option when they
should be using it. For example, event handlers that
rely on player actions such as &lt;code class=&quot;highlighter-rouge&quot;&gt;BlockBreakEvent&lt;/code&gt; or
&lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerInteractEvent&lt;/code&gt; that lack &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt;
are generally incorrect. These events are commonly
cancelled by a variety of different plugins, especially
protection plugins such as WorldGuard. This means that
logic that should never ever be executed under any
circumstances, such as spawning a boss inside someone
else’s territory or land claim occurs even when a
protection plugin has cancelled the event. This has been
source of multiple bugs in my personal experience. This
allows players the possibility of griefing the server and
potentially throw the server economy into chaos if they
are able to figure out how to exploit this incorrect
behavior when it is not correctly handled by the plugin.&lt;/p&gt;

&lt;p&gt;The usefulness of &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled&lt;/code&gt; comes from the fact
that you can avoid running any extra logic from an event
that is going to be cancelled (i.e. so that it seems that
the event never even occurred in the first place). You can
boost performance by a considerable amount simply through
the reduction in the amount of logic being run on top of
maintaining compatibility with other plugins.&lt;/p&gt;

&lt;p&gt;In my opinion, &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt; should be the
default. You need a compelling reason to always run an
event handler even when some other plugin has cancelled
the event. For example, a logging plugin might not want
to use &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt; if they want to log every
action and the result of that action. Some events also
cannot be cancelled, which is another reason why it might
not be necessary to use &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;In general, prefer to use &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt;. Once
you determine that your event handler actually does need to
run even when the event is cancelled, then you can remove
this option and use the default of &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;This has been a pretty text and detail-heavy post, so I
hope the justification behind the correct &lt;code class=&quot;highlighter-rouge&quot;&gt;@EventHandler&lt;/code&gt;
options to use is clear enough at this point. I’m still
working on a few personal projects of mine so the next
blog post probably won’t be out for another while since I’m
trying to juggle school along with my own projects
currently, and potentially some work in the near future if
I find the time for that.&lt;/p&gt;

&lt;p&gt;While event priorities are not often the source for bugs,
the lack of &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled&lt;/code&gt; most definitely has caused a
few major bugs. My personal opinion is that the latter of
the two is not set to a sane default, so always make sure
to &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled = true&lt;/code&gt; first and think about it later,
because it is much easier to debug an event handler that
doesn’t run than it is to debug an event handler that is
incorrectly written to handle an edge-case scenario that
should have been cancelled.&lt;/p&gt;

&lt;p&gt;And once again, I leave with the following quote from
&lt;a href=&quot;http://spinroot.com/gerard/pdf/P10.pdf&quot;&gt;The Power of Ten&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If the rules seem Draconian at first, bear in mind that
they are meant to make it possible to check code where very
literally your life may depend on its correctness: code
that is used to control the airplane that you fly on, the
nuclear power plant a few miles from where you live, or the
spacecraft that carries astronauts into orbit. The rules
act like the seat-belt in your car: initially they are
perhaps a little uncomfortable, but after a while their use
becomes second-nature and not using them becomes
unimaginable.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name></name></author><summary type="html">I didn’t even realize that I haven’t written a post this year yet. Event handlers are key components of plugins because they are used as an entry point to most plugin logic. Think of plugins like WorldGuard, minigame plugins and other game features like crates, quests etc. All of them use event handlers as an intrinsic component of their primary function. Yet, many plugin developers, even those who should know better, seem to write event handlers that break the functionality of other plugins or prevent other plugins from being able to listen to events.</summary></entry><entry><title type="html">Lessons Learned Debugging: Part 10</title><link href="https://caojohnny.github.io/blog/2019/12/22/lessons-learned-debugging-part-10.html" rel="alternate" type="text/html" title="Lessons Learned Debugging: Part 10" /><published>2019-12-22T17:19:55-08:00</published><updated>2019-12-22T17:19:55-08:00</updated><id>https://caojohnny.github.io/blog/2019/12/22/lessons-learned-debugging-part-10</id><content type="html" xml:base="https://caojohnny.github.io/blog/2019/12/22/lessons-learned-debugging-part-10.html">&lt;p&gt;This is a follow-up of sorts to
&lt;a href=&quot;https://caojohnny.github.io/blog/2019/07/13/lessons-learned-debugging-part-6.html&quot;&gt;Part 6&lt;/a&gt;
of this series of posts. I felt that the topic of inventory
management is so important for most servers that it is
worth taking a look at a few more ways players get access
to items that they shouldn’t have in the first place. These
are logical oversights that developers tend to forget about
which players exploit in order to get access to those
items.&lt;/p&gt;

&lt;h1 id=&quot;there-are-many-ways-to-get-items-you-shouldnt-have&quot;&gt;There Are Many Ways To Get Items You Shouldn’t Have&lt;/h1&gt;

&lt;p&gt;Of course, as I’ve stated before, any exceptions or logical
errors will often lead to “duplication”-style bugs where
players get more of the item than they are supposed to.
However, the lack of logic or logical oversight where you
forget to check something or forget to prevent access to
inventory items are just as serious. As I will also again
reiterate, inventories and item management in Bukkit is a
death trap. There are so many different things that can go
wrong and so many different creative ways to exploit flawed
logic that most developers will need to break a server’s
economy multiple times before becoming proficient in being
able to spot some of these bugs while they are writing
their code. I’ve made a list of some of the common ones
I’ve made myself.&lt;/p&gt;

&lt;h1 id=&quot;item-stacking&quot;&gt;Item Stacking&lt;/h1&gt;

&lt;p&gt;One important way that servers reduce lag is through
stacking items, or using a single item entity to represent
many items of exactly the same type. For example, if you
kill a zombie and it drops 3 rotten flesh items, then a
stacked item automatically prevents 2 of the rotten flesh
items from spawning, instead marking the one item that does
spawn as a “stack of 3.” If the entire server consists of
killing zombies, then you cut the number of entities
globally by 66%, which is a massive performance boost.&lt;/p&gt;

&lt;p&gt;Regardless, developers often forget about this
functionality when dropping items. Items that are supposed
to be behind walls or otherwise not supposed to despawn
can be collected by players if they drop an item of the
same type. Oftentimes, developers try to fix this by
causing the oldest item to become the “stacked” item, but
this doesn’t actually fix it either because then players
who accidentally drop their items will &lt;em&gt;lose&lt;/em&gt; them instead.&lt;/p&gt;

&lt;p&gt;In my personal opinion, it should be the burden of the item
stacking plugin to not mess up and stack up items it
shouldn’t. The scope of these plugins should be limited to
high-impact actions such as mass mob drops rather than
items dropped by players. However, this cannot account for
every possible scenario. There are times where there simply
isn’t a way around items being automatically stacked. In
this case, there must be a way provided to flag items your
plugin drops as “do not stack me.” This usually comes in
the form of a persistent data container or some metadata
added to an item entity. It can also be some collection
provided by the item stacking plugin which other plugins
can use to blacklist items entities from being stacked.
There are no easy catchall solutions for this, and it just
comes with familiarity and anticipating how the actions of
other plugins need to coexist.&lt;/p&gt;

&lt;p&gt;As a minor aside, the same sort of concept exists for item
cleanup plugins as well, which remove item entities over a
sufficient age to prevent item entities spawned an eternity
ago and never being picked up from taking up server memory
and CPU. You need to anticipate that the item you are
dropping might need to be persistent, so you need to both
cancel anything that picks up the item entity, destroys the
item entity, or item cleaning plugins from deleting the
item using any of the 3 different options I discussed above
(persistent data container, metadata or blacklist
collection).&lt;/p&gt;

&lt;h1 id=&quot;custom-inventory-holders&quot;&gt;Custom Inventory Holders&lt;/h1&gt;

&lt;p&gt;I’ve made a fair few plugins where I’ve needed to make my
own “inventory holder.” Things such as blocks that can
store items such as a mineral generator or custom backpacks
that are held by items.&lt;/p&gt;

&lt;p&gt;This is again another place where you need to be careful of
people getting items or losing their items. First of all,
it is imperative that once you remove the inventory holder,
the you must also &lt;em&gt;close the inventory to all viewers as
well&lt;/em&gt;. Otherwise, players with access to the inventory
after you finish managing it effectively extend the
lifetime of the inventory. Things such as automated mineral
generators will continue filling their inventory and
players may continue to place items into the defunct
inventory. One notorious example of this in the real world
is the inventory for managing NPC entities or minion
entities. If you do not close the inventory when the holder
is removed, then you can remove the holder an unlimited
number of times, thus “giving back” to the player whatever
item they used to spawn the holder.&lt;/p&gt;

&lt;p&gt;As far as closing the inventories for each viewer goes,
I’ve written yet another blog post about this in the &lt;a href=&quot;https://caojohnny.github.io/blog/2019/04/08/lessons-learned-debugging-part-2.html&quot;&gt;2nd
edition&lt;/a&gt;
of this series. Make sure you don’t hit any CMEs in the
closing of inventories, or you may still end up with a
duplication bug!&lt;/p&gt;

&lt;h1 id=&quot;hoppers&quot;&gt;Hoppers&lt;/h1&gt;

&lt;p&gt;Also note that players don’t actually need to have
inventories open to take items away from them! The stock
containers in Minecraft such as chests are can have their
items hoppered out if checks on such exploits are not
implemented by developers. Private chests and sign shops
are especially vulnerable to this kind of exploit.&lt;/p&gt;

&lt;p&gt;Again, the only real way to mitigate this kind of bug is to
realize the fact that most inventory handling code is
almost always flawed the first iteration. You can test all
you want, but if you don’t specifically think about how
players take advantage of gaps in your logic, then you’ll
never be able to test out this bug. Typically, when writing
inventory management code, I get a sense that I haven’t
implemented a sufficient number of protection checks (e.g.
&lt;code class=&quot;highlighter-rouge&quot;&gt;InventoryMoveItemEvent&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;BlockBreakEvent&lt;/code&gt; for blocks,
checks for where an inventory holder might be located in
case someone uses pistons, etc).&lt;/p&gt;

&lt;p&gt;People are coming up with new concepts and new ideas every
single day, and there again is no catchall solution to
ensuring that your plugins are exploit free except for cold
hard experience.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;It’s disheartening to have to be so vague about many of the
issues I see with my own code and how to fix them. In all
honesty, I myself have not come up with perfect solutions
for them all either. One of my own flaws is that I don’t
actually play Minecraft all that often myself. I do try my
best to be up-to-date with the communities on the servers I
work for, but ultimately, I care a lot more about the code
on its own than the game. I definitely need to work on
that.&lt;/p&gt;

&lt;p&gt;While less relevant to this post since I don’t set any
rules (at least any hard and fast rules), this has been
the typical end note for the past 9 posts, so why not give
&lt;a href=&quot;http://spinroot.com/gerard/pdf/P10.pdf&quot;&gt;The Power of Ten&lt;/a&gt;
another go:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If the rules seem Draconian at first, bear in mind that
they are meant to make it possible to check code where very
literally your life may depend on its correctness: code
that is used to control the airplane that you fly on, the
nuclear power plant a few miles from where you live, or the
spacecraft that carries astronauts into orbit. The rules
act like the seat-belt in your car: initially they are
perhaps a little uncomfortable, but after a while their use
becomes second-nature and not using them becomes
unimaginable.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name></name></author><summary type="html">This is a follow-up of sorts to Part 6 of this series of posts. I felt that the topic of inventory management is so important for most servers that it is worth taking a look at a few more ways players get access to items that they shouldn’t have in the first place. These are logical oversights that developers tend to forget about which players exploit in order to get access to those items.</summary></entry><entry><title type="html">Lessons Learned Debugging: Part 9</title><link href="https://caojohnny.github.io/blog/2019/10/14/lessons-learned-debugging-part-9.html" rel="alternate" type="text/html" title="Lessons Learned Debugging: Part 9" /><published>2019-10-13T23:27:30-07:00</published><updated>2019-10-13T23:27:30-07:00</updated><id>https://caojohnny.github.io/blog/2019/10/14/lessons-learned-debugging-part-9</id><content type="html" xml:base="https://caojohnny.github.io/blog/2019/10/14/lessons-learned-debugging-part-9.html">&lt;p&gt;The problem I usually see with novice developers when they
are debugging is that they test what their code is supposed
to do, but they are suprised when their code works when it
isn’t supposed to.&lt;/p&gt;

&lt;h1 id=&quot;check-your-code-isnt-running-inadvertently&quot;&gt;Check Your Code Isn’t Running Inadvertently&lt;/h1&gt;

&lt;p&gt;It sounds ridiculous, but really think about it for a
moment. The majority of time, you are probably either
writing or fixing code that runs some kind of process or
logic. Only 1 or 2 lines of code are checking if all of
that code is even supposed to be executing. You don’t
actually spend that much time on it. There are a variety of
different places this happens. In my case, I often forget
to check what item type the player is holding whenever a
&lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerInteractEvent&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;BlockPlaceEvent&lt;/code&gt; is being called.
This leads to the event handler logic being executed for
every single interaction, or a &lt;code class=&quot;highlighter-rouge&quot;&gt;NullPointerException&lt;/code&gt; being
thrown if they aren’t even holding anything. Another place
I’ve been burned by this is when handling
&lt;code class=&quot;highlighter-rouge&quot;&gt;PlayerCommandPreprocessEvent&lt;/code&gt;, where I’m forgetting to
check what command is even being run. Every command then
causes the logic to be executed, even though the intention
was for only one command or one group of commands to be
handled.&lt;/p&gt;

&lt;h1 id=&quot;the-debugging-process&quot;&gt;The Debugging Process&lt;/h1&gt;

&lt;p&gt;A large quantity of bugs I’ve found comes just from playing
the game normally. Usually, when people say they are
“playtesting,” they are referring to testing one specific
thing or plugin. However, my argument is that many bugs
stem from the code running when it isn’t intended to. The
problem with the aforementioned playtesting is that the
tester is specifically looking for something to happen
because they perform some action. The problem with this
targeted style of playtesting is that you can’t tell
whether or not say, placing a specific block, will cause
the plugin to do whatever it needs to do, or if placing
&lt;em&gt;any&lt;/em&gt; block will cause the plugin to do that as well.&lt;/p&gt;

&lt;p&gt;This is why it is important to actually play the game as
if the plugin didn’t exist for a certain time period. Sure,
it takes a little bit more time, and good programmers tend
to not make any mistakes in this area. However, I believe
there is merit to this even if you don’t find any bugs.
When I play someone else’s game and I run into a
game-breaking bug, I sometimes feel like the developers
don’t even play their own game. Bugs that are obscure to a
developer are often obvious to players because it impacts
standard gameplay. When you say,”that didn’t come up in
testing,” of course it fucking didn’t, because if you are
playtesting just to test the plugin, you were playing the
game in the way that a developer would, not a player. Finding
the bugs from a development standpoint is important, but you
need to recognize who your product is targeted towards: the
player. The point of all this is to say that you should play
your own game &lt;em&gt;as a player would&lt;/em&gt; for some fixed minimal
amount of time as a part of the debugging process. It
doesn’t even need to be that long, 15-30 minutes should do
it.&lt;/p&gt;

&lt;p&gt;One example of this is when I was writing a hack around
dispensers firing EXP bottles. However, I didn’t notice
the fact that droppers could also fire EXP bottles as well.
This lead to a &lt;code class=&quot;highlighter-rouge&quot;&gt;ClassCastException&lt;/code&gt; as I tried to cast a
&lt;code class=&quot;highlighter-rouge&quot;&gt;Dropper&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;Dispenser&lt;/code&gt;. In hindsight, this was a stupid
mistake on my part because one should always typecheck
before doing a cast. However, this is something that would
have easily been caught if I just played the game on the
same server that the players used. When I was testing this
plugin in a controlled test server, I couldn’t account for
what other players were doing. Had I instead tested on the
same environment that players were actually using, this
would have easily been found before being deployed. This
brings us to another point about how the testing
environment should as closely replicate the production
evinronment as possible, but that is a topic for another
blog post.&lt;/p&gt;

&lt;h1 id=&quot;fix-your-thinking&quot;&gt;Fix Your Thinking&lt;/h1&gt;

&lt;p&gt;On the other hand, fixing the fact that your code might be
running inadvertently during development rather than
testing requires a lot of practice. It took me almost a
full year to really start hitting all the conditions on a
consistent basis. You need to spend almost as much time
thinking about the conditions at which you are either going
to “do” or “not do” any subsequent actions as the amount of
time you are spending actually writing those actions.&lt;/p&gt;

&lt;p&gt;One thing that helps immensely is to use &lt;code class=&quot;highlighter-rouge&quot;&gt;if-return&lt;/code&gt; blocks
rather than building a long chain of &lt;code class=&quot;highlighter-rouge&quot;&gt;if&lt;/code&gt;s. For example:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// Logic&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Prefer something like this:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!...)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Logic&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Writing your code this way forces you to invert your
thinking in a way. Instead of thinking, “if this is the
case, do this,” you need to think “if this shouldn’t
be done, then return.” This is significantly more effective
because it drastically simplifies your logic.&lt;/p&gt;

&lt;p&gt;Sure, it takes up more lines of code. Sure, it’s a little
more writing. However, not only does it separate the
conditions and control flow from your actual execution
logic, it reduces the indentation of your code. It makes it
significantly easier to read. When you isolate your control
flow in this way, it is easier to see what conditions you
are constantly checking for. This makes code review so much
easier. Once you hit some condition that doesn’t hold true,
you don’t need to think about it anymore since you
&lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt;.  On the other hand, if you have several nested
&lt;code class=&quot;highlighter-rouge&quot;&gt;if&lt;/code&gt; statements, the reviewer has to keep all of the
conditions in their head because all of the previous
statements impact all of the logic afterwards as well.
Finally, conditions are common accross many different types
of event handlers and situations. If you can easily build a
repertoire of conditions you are checking really often over
time, it will be harder for you to forget in the future.&lt;/p&gt;

&lt;p&gt;The list of benefits of using &lt;code class=&quot;highlighter-rouge&quot;&gt;if-return&lt;/code&gt; keeps going on
and on. I cannot stress enough how beneficial this
technique is.&lt;/p&gt;

&lt;h1 id=&quot;condition-counting&quot;&gt;Condition Counting&lt;/h1&gt;

&lt;p&gt;As an interesting side discussion, I want to include an
excerpt from
&lt;a href=&quot;https://www.fastcompany.com/28121/they-write-right-stuff&quot;&gt;They Write the Right Stuff&lt;/a&gt;,
an article that discusses the lengths that the authors of
the Space Shuttle software go to in order to ensure that
their code is bug free:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The group has so much data accumulated about how it does
its work that it has written software programs that model
the code-writing process. Like computer models predicting
the weather, the coding models predict how many errors the
group should make in writing each new version of the
software. True to form, if the coders and testers find too
few errors, everyone works the process until reality and the
predictions match.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;While I think that bug-finding models of software are a
little extreme for writing plugins, especially when lives
aren’t exactly at stake here, I think there is still merit
in the idea of expecting there to be some number of
conditions. As you get more experienced, you’ll probably
get a feel for how many &lt;code class=&quot;highlighter-rouge&quot;&gt;if-return&lt;/code&gt; statements you should
be writing. If you think there are too few, your intuition
might be indicating something. I’m not saying that I can
clearly advocate for consciously thinking about this, as
you are writing code. I certainly don’t. I the situations
vary far too much for this sort of thing to be worthwhile.
That being said, it would be a lie for me to say that I’ve
never thought something along the lines of “I don’t think
that’s enough code.” Something that looks too good to be
capable of handling all edge cases may well be!&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;There are a variety of techniques you can use to mitigate
the bugs involving logic that shouldn’t be run from
creeping into your code. This includes playtesting as a
player would, using &lt;code class=&quot;highlighter-rouge&quot;&gt;if-return&lt;/code&gt; statements, and possibly
condition counting if you are interested in a little
exercise.&lt;/p&gt;

&lt;p&gt;These blog posts probably will come with less frequency in
the coming months since I want to focus on college. I’ve
also got my current personal project,
&lt;a href=&quot;https://github.com/caojohnny/gate&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;gate&lt;/code&gt;&lt;/a&gt; that I’m
desparately close to finishing and I want to complete, so
I’ll probably be focusing on that, then on my newest
project, &lt;a href=&quot;https://github.com/caojohnny/liftoff&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;liftoff&lt;/code&gt;&lt;/a&gt;
before focusing back on blogging and finishing the
On Thread Safety post that continually is on TODO…&lt;/p&gt;

&lt;p&gt;As always, I always leave readers with the following quote
from
&lt;a href=&quot;http://spinroot.com/gerard/pdf/P10.pdf&quot;&gt;The Power of Ten&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If the rules seem Draconian at first, bear in mind that
they are meant to make it possible to check code where very
literally your life may depend on its correctness: code
that is used to control the airplane that you fly on, the
nuclear power plant a few miles from where you live, or the
spacecraft that carries astronauts into orbit. The rules
act like the seat-belt in your car: initially they are
perhaps a little uncomfortable, but after a while their use
becomes second-nature and not using them becomes
unimaginable.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name></name></author><summary type="html">The problem I usually see with novice developers when they are debugging is that they test what their code is supposed to do, but they are suprised when their code works when it isn’t supposed to.</summary></entry><entry><title type="html">Lessons Learned Debugging: Part 8</title><link href="https://caojohnny.github.io/blog/2019/08/09/lessons-learned-debugging-part-8.html" rel="alternate" type="text/html" title="Lessons Learned Debugging: Part 8" /><published>2019-08-09T02:03:35-07:00</published><updated>2019-08-09T02:03:35-07:00</updated><id>https://caojohnny.github.io/blog/2019/08/09/lessons-learned-debugging-part-8</id><content type="html" xml:base="https://caojohnny.github.io/blog/2019/08/09/lessons-learned-debugging-part-8.html">&lt;p&gt;One of the most frustrating things about a large plugin
ecosystem is that at one point or another, you will need to
start handling the dependencies between each plugin for
particular actions - e.g. who gets to break what block and
where they are allowed. How can you constrain the scope of
some certain plugin, due to the functionality of another
plugin, or how can you bypass something?&lt;/p&gt;

&lt;h1 id=&quot;have-one-plugin-handle-protection-checks&quot;&gt;Have One Plugin Handle Protection Checks&lt;/h1&gt;

&lt;p&gt;On most servers, you’ll find some sort of system for
protection, whether it be protecting players from damage
or protecting blocks from being broken. For example, most
Skyblock servers will disallow all damage to players while
they are on their island. This is problematic in some cases
because you actually want players to take damage. In other
cases, a protection plugin doesn’t handle an edge case
involving new capabilities you’ve written for, say, a boss
entity. You’ll find that in order to handle these edge
cases, it often requires you to write the same code over
and over again, and that each time you add a new feature
that needs to interoperate with existing features, these
edge case handlers are either thrown out the window or
simply don’t work anymore. I’ve seen bugs introduced almost
every feature update due to the fact that protection must
either be checked or overridden for each and every single
feature independently. If the boilerplate for doing this
could be eliminated or reduced, then it would be easier to
write your checks to protection plugins without worrying
about forgetting something. Doing something that is easy
means that you’ll do it more often, and before long, it
will become second-nature rather than something that you
explicitly need to think about.&lt;/p&gt;

&lt;p&gt;Luckily, there is an elegant solution to the potentially
messy business of interdependent protections. You’ll need
a single plugin to handle protection for your specific
server ecosystem. All protection checks can be described
by the following function:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In many cases, one can boil down &lt;em&gt;all&lt;/em&gt; protection checks to
a single method. For example, the if you are writing a
plugin for a skyblock server, then almost all protection
is determined by which island a player belongs to and what
island is being affected by that player. Here’s what a
boiled-down check if an action &lt;code class=&quot;highlighter-rouge&quot;&gt;isAllowed&lt;/code&gt; would look like:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For ASkyBlock, a player may belong to a few different
islands due to co-oping. A server running ASkyBlock might
want to use this to determine whether something
&lt;code class=&quot;highlighter-rouge&quot;&gt;isAllowed&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;anyMatch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;island&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is our base ruleset. Since all actions, whether they
be block placement, which islands players can enter, block
breaking, who can be damaged and when, etc. is determined
by the island the respective parties belong to, we now only
need to translate players, entities, and locations to
islands. In fact, it is conceivable that one can cover
most, if not all possible use cases with just definitions
to translate those 3 objects. Further, it is possible
through the use of &lt;code class=&quot;highlighter-rouge&quot;&gt;ActionType&lt;/code&gt; to make this both type-safe
and extensible in case plugins want to add their own
translation methods:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ProtectionHandler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;translateAffector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;translateTarget&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Player&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PLAYER_PLACE_BLOCK&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
                &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;translateAffector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Player&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affectorId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getUniqueId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerIsland&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SkyBlockApi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayerIsland&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;affectorId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                    &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coopIslands&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;SkyBlockApi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayerCoops&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;affectorId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;coopIslands&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;playerIsland&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coopIslands&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
                &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;translateTarget&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;Location&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;blockLocation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SkyBlockApi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getIslandAtLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;translateAffector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;translateTarget&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The beauty of using this is that the translation methods
can take into account other factors, such as if there is
another plugin that controls the finer-grained permissions.
For example, when I worked at MineSaga, one could enable or
disable the ability of co-oped players to place blocks. By
only having to take this into account once through the use
of &lt;code class=&quot;highlighter-rouge&quot;&gt;ActionType&lt;/code&gt; constants, you no longer need to remember
to check with that plugin each time you do a protection
check. Each plugin fewer that you need to check is one
fewer check you can possibly forget. If you recall my last
blog post, you can throw all of your protection handling
code into a
&lt;a href=&quot;https://caojohnny.github.io/blog/2019/07/24/lessons-learned-debugging-part-7.html&quot;&gt;central library&lt;/a&gt;.
If you ever add a new plugin that actually adds new
behavior that the &lt;code class=&quot;highlighter-rouge&quot;&gt;isAllowed&lt;/code&gt; check needs to handle, all
of your plugins using the protection handler provided by
the core plugin benefit from a change to just that one
core plugin to account for that new check. Additionally,
this means that only new plugins will need to depend on a
single core plugin that also handles protection. Assuming
that you don’t need to add any &lt;code class=&quot;highlighter-rouge&quot;&gt;ActionType&lt;/code&gt;s, you can get
away with not even modifying the core plugin. You can
focus your efforts on implementing features instead of
writing hacky and fragile code just to make sure your
protection ruleset is being honored.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BlockPlaceEvent&lt;/code&gt; is not one of the things that you usually
need to check with a protection handler, since that
function is normally handled by whatever protection plugin
you are using. You can exploit this by calling
&lt;code class=&quot;highlighter-rouge&quot;&gt;BlockPlaceEvent&lt;/code&gt; for every block that needs to be checked,
then seeing if it has been cancelled. The framework I’ve
discussed is useful for cases where there is not an
existing event handled by protection plugins. For example,
if a minion (on MineSaga, a zombie entity) “places” a
block, it would be a good idea to translate the minion’s
owner UUID to whichever island that player belongs to in
order to check if the minion &lt;code class=&quot;highlighter-rouge&quot;&gt;isAllowed&lt;/code&gt; to place that
block:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Minion&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MINION_PLACE_BLOCK&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;@Overide&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;translateAffector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Minion&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;UUID&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ownerId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;minion&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getOwner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;playerIsland&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SkyBlockApi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayerIsland&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ownerId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coopIslands&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;SkyBlockApi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPlayerCoops&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ownerId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;coopIslands&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;playerIsland&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coopIslands&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Island&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;translateTarget&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;PLAYER_PLACE_BLOCK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;translateTarget&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The extensibility of this system is a valuable feature
because it means that one doesn’t need to go through the
trouble of storing the &lt;code class=&quot;highlighter-rouge&quot;&gt;Player&lt;/code&gt; object itself in order to
perform protection checks which depend on the fact that
the something performing some modification action is a
player. It could be a boss entity or a minion entity as
demonstrated by the above snippet.&lt;/p&gt;

&lt;p&gt;However, for the sake of completeness, let’s assume for a
moment that you have a really bad skyblock plugin, or a
really bad protection plugin that doesn’t handle
&lt;code class=&quot;highlighter-rouge&quot;&gt;BlockPlaceEvent&lt;/code&gt;. What would, say, a multiblock place event
listener look like?&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@EventHandler&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onPlace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BlockPlaceEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getBlockPlaced&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Location&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ProtectionHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ph&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Location&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newLocation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Block&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newBlock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getBlock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ph&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isAllowed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActionType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MINION_PLACE_BLOCK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newBlock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Set block, remove item, etc...&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not so bad!&lt;/p&gt;

&lt;h1 id=&quot;overriding-protections&quot;&gt;Overriding Protections&lt;/h1&gt;

&lt;p&gt;Now that we’ve covered how protection checks can be done in
an elegant, extensible way, how do we handled overriding an
existing protection plugin?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Before I get into this section, a small personal
anecdote:&lt;/p&gt;

  &lt;p&gt;The correct way to write protection event listeners is to
use an &lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.LOW&lt;/code&gt; event handler method so that
non-protection plugins can use &lt;code class=&quot;highlighter-rouge&quot;&gt;ignoreCancelled&lt;/code&gt; without
having to change their priority. Unfortunately, I’ve seen
a number of excessively dumb plugins which set their
protection listeners to &lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.HIGHEST&lt;/code&gt; (or in
extreme cases, &lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.MONITOR&lt;/code&gt;), under the
assumption that they want their event listener to take
precedence. For the love of all that is good in this
world &lt;strong&gt;please stop doing this&lt;/strong&gt;. This causes issues with
plugins that need to piggyback off of that protection to
have no way of checking whether or not an event will be
cancelled without doing hacks like scheduling a task to
check if the event is cancelled once all event listeners
have run or refiring the event and storing it to make
sure it doesn’t get handled in an infinite loop, etc.
I’ve had to write an enchanted pickaxe plugin that
shouldn’t run any enchantments if a block was broken
outside of a mine. However, the mine plugin, which
handled block break protection registered their listener
with &lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.HIGHEST&lt;/code&gt;, and in the interests of
keeping &lt;code class=&quot;highlighter-rouge&quot;&gt;EventPriority.MONITOR&lt;/code&gt; clear, I unregistered
their listener from the &lt;code class=&quot;highlighter-rouge&quot;&gt;BlockBreakEvent&lt;/code&gt;’s
&lt;code class=&quot;highlighter-rouge&quot;&gt;HandlerList&lt;/code&gt; and re-registered it under a lower
priority.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Unlike writing protection checks, overriding protection is
independent. If we are overriding a protection, that means
that the protection itself is irrelevant (otherwise, we
wouldn’t really be overriding anything). Mind you, limits
can still be placed on where or when overriding is done.
However, this is up to each individual plugin, so it
wouldn’t make sense to include this feature in a central
core plugin.&lt;/p&gt;

&lt;p&gt;Overriding protection listeners can be done in two ways.
Firstly, you can bypass the listener entirely and manually
perform some action on its own. For example, if a plugin
cancels damage events, you can manually set the health of
an entity instead. Secondly, you can set a listener to a
higher priority and then use
&lt;code class=&quot;highlighter-rouge&quot;&gt;Cancellable#setCancelled(boolean)&lt;/code&gt; to &lt;em&gt;uncancel&lt;/em&gt; the
event if certain conditions are met. If you can’t edit the
source of a plugin using a scheduler to protect some region
or entity or block, then you can consider cancelling that
scheduler task and then running your own task which does
everything except for whatever protection you are
overriding.&lt;/p&gt;

&lt;p&gt;The short of it is that overriding a protection is much
easier than checking for a protection. You don’t need to
worry about the limitations for the former because you are
already overriding the protection. However, for the latter,
I’ve presented a good way of structuring a protection
handler to reduce boilerplate and reduce the number of bugs
you are getting from forgetting protection checks.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;I have little else to say except for the tradition of
leaving readers with the following words from
&lt;a href=&quot;http://spinroot.com/gerard/pdf/P10.pdf&quot;&gt;The Power of Ten&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If the rules seem Draconian at first, bear in mind that
they are meant to make it possible to check code where very
literally your life may depend on its correctness: code
that is used to control the airplane that you fly on, the
nuclear power plant a few miles from where you live, or the
spacecraft that carries astronauts into orbit. The rules
act like the seat-belt in your car: initially they are
perhaps a little uncomfortable, but after a while their use
becomes second-nature and not using them becomes
unimaginable.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name></name></author><summary type="html">One of the most frustrating things about a large plugin ecosystem is that at one point or another, you will need to start handling the dependencies between each plugin for particular actions - e.g. who gets to break what block and where they are allowed. How can you constrain the scope of some certain plugin, due to the functionality of another plugin, or how can you bypass something?</summary></entry><entry><title type="html">Let’s Talk Privacy</title><link href="https://caojohnny.github.io/blog/2019/07/28/lets-talk-privacy.html" rel="alternate" type="text/html" title="Let's Talk Privacy" /><published>2019-07-28T15:41:15-07:00</published><updated>2019-07-28T15:41:15-07:00</updated><id>https://caojohnny.github.io/blog/2019/07/28/lets-talk-privacy</id><content type="html" xml:base="https://caojohnny.github.io/blog/2019/07/28/lets-talk-privacy.html">&lt;p&gt;This post should come with a big red disclaimer that says
I’m not an expert, but since my screen is redshifted to
hell, plain black will have to do. I’m just a Java
programmer with a blog.&lt;/p&gt;

&lt;p&gt;With that out of the way, I am subscribed to
&lt;a href=&quot;https://t.me/hackernewslive&quot;&gt;Hacker News Live&lt;/a&gt; channel,
which posts updates regarding Google Chrome a few times,
every time with dozens of thumbs-ups and only a few
thumbs-down votes. A few weeks ago, I decided to just check
&lt;a href=&quot;https://www.siliconvalley.com/2019/06/21/google-chrome-has-become-surveillance-software-its-time-to-switch/&quot;&gt;the link&lt;/a&gt;,
which I found to be an interesting read indeed. It’s not
everyday you see almost 20 thumbs-ups on a single article
on the Hacker News Live channel, so there must either be a
really compelling point made or there are anti-Google bots
on the channel.&lt;/p&gt;

&lt;p&gt;That was the beginning of a pretty long journey.&lt;/p&gt;

&lt;h1 id=&quot;why-privacy-is-important&quot;&gt;Why Privacy is Important&lt;/h1&gt;

&lt;p&gt;If you don’t think privacy is important, then I doubt
anything I say will change your mind. That being said, I
think that it is a topic worth being informed on. I’m not
an expert on this subject, but there are plenty of people
who are and can convince you of the importance of privacy
if I fail to do so. I’ll be sure to give links.&lt;/p&gt;

&lt;p&gt;The classic counter to digital privacy is, of course,
the “&lt;a href=&quot;https://en.wikipedia.org/wiki/Nothing_to_hide_argument&quot;&gt;Nothing to hide&lt;/a&gt;”
argument. The reasoning goes that if you have nothing to
hide, then you have nothing to fear. You can allow for
your privacy to be violated because you don’t care about
what people are going to find. This is far and away the
most common counterpoint I tend to hear about why people
shouldn’t care about privacy. This is a vastly flawed
argument in a number of ways. There are a lot of details
on the Wikipedia page I linked, but you can find further
information here:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.reddit.com/r/privacy/wiki/index#wiki_why_should_i_care_about_privacy.3F&quot;&gt;r/privacy Wiki&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.privacytools.io/&quot;&gt;privacytoolsIO Main page&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The links above are a fantastic starting place to learn
more about privacy and why you should care. I’ll even
talk about why I care about privacy myself later on. But
first, I’ll get back to why “having nothing to hide” is a
terrible argument. First of all, it is overly presumptuous
and implies that only criminals should expect privacy. It
implies that law-abiding citizens should not be afraid of
having their personal information exposed, because no harm
can come to them if they can prove that they are completely
innocent. However, even if you don’t have anything to hide,
“&lt;a href=&quot;https://www.aclu.org/blog/national-security/secrecy/you-may-have-nothing-hide-you-still-have-something-fear&quot;&gt;you still have something to fear&lt;/a&gt;.”
If you did not care about your personal information, would
you be comfortable with someone using your identity to
&lt;a href=&quot;https://www.reddit.com/r/privacy/comments/3hynvp/how_do_you_counter_the_i_have_nothing_to_hide/&quot;&gt;commit a crime&lt;/a&gt;?
Would you let someone in to your bathroom to watch you
shower and use the toilet? Would you invite people passing
by to watch you sleep? Having nothing to hide is a poor
argument for not caring about privacy. The truth is, you
probably do have something to hide. You are not
infalliable. If you have nothing to hide, you probably need
to look harder. And even then, you &lt;em&gt;should not have
something to hide in order to expect privacy&lt;/em&gt;. You expect
privacy when you are using the bathroom or spending time
with your family. It would be creepy to have someone
staring through your window, watching your every move. But
you don’t have to take my word for it, there are lots of
arguments for and against having anything to hide and
whether that entitles you to privacy. Let’s keep moving.&lt;/p&gt;

&lt;p&gt;According to the linked r/privacy wiki:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;there is an ever increasing portion of our lives which is
being recorded by corporations and governments, and these
records can be used to our disadvantage, at any time, now
or any-time in the future&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Corporations and governments have an immense amount of
power armed with the data they have collected from users
and citizens. If you do have something to hide (which you
almost certainly do, otherwise, do not ever lock your doors
again), the question now becomes can they be accountable
for that data. I believe I read an article which I’m
currently unable to find about how Google’s reCAPTCHA v3
technology could even be used to detect Parkinsons based
on the movement of a user’s mouse. This is a fantastic way
to inform people who may not have been diagnosed yet. But
on the other hand, this information may also be
inadvertently published, for example, to insurance
companies who will raise your premiums. Even if Google
never ends up doing this, deducing health conditions based
simply on mouse movements is a testament to the data
collection power of Internet corporations. Even if Google
cannot collect this data, someone else may exploit this
technology themselves. Even if you don’t care if your rates
increase, even if you don’t care if everybody in the whole
world knew you had Parkinsons, it isn’t like it would help
you to be in that situation. &lt;em&gt;Even if it did help&lt;/em&gt;, it
might hurt others. Even if companies and governments are
good stewards of your data, assuming that no nefarious
employees access that data, assuming that no one is able to
read your data when you are sending it, assuming that there
is “no one out to get you,” and assuming a plethora of
other unrealistic expectations about how your data is
handled, privacy still matters to you. The mere fact that
you do not care about your privacy is an exploitable data
point, because you be expected to give up your data
needlessly. And this is in the best possible scenario.
In reality, companies profit off of collecting and selling
data. Allowing yourself to be complacent is like putting
your wallet with all of your cash on the ground. Some
people will try to find to owner or report it to police,
but others are going to make a profit. Even if you do not
value your own personal information, &lt;em&gt;someone else will&lt;/em&gt;.
Your data cannot help you if the government has access to
both exculpatory information and incriminating information
if their sole goal is to arrest you. It doesn’t matter if
you have not committed a crime and it doesn’t matter that
you have nothing to hide.&lt;/p&gt;

&lt;p&gt;All of this is not to say that your information has been
or will be used against you. Only that it may be, and that
it is a very real threat. You may not be impacted yourself,
but others already have. Look no further than the
totalitarian governments. If you think that you don’t have
anything to hide, think again, because chances are, you
probably do.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.zdnet.com/article/a-case-against-online-privacy/&quot;&gt;One article&lt;/a&gt;
claims that services that collect data
“provide […] some value.” Let’s say that you aren’t like
me and you do care about ads. You think that being tracked,
having your preferences recorded, and having a slower
browser is a good thing because you benefit in the end.
But the argument is severely flawed. The author
subsequently points fingers at ISPs since they allegedly
don’t provide you a better service, they give data to
the cops, and they don’t tell you you are being tracked.
These are all debunked by Facebook’s
&lt;a href=&quot;https://www.facebook.com/policy.php&quot;&gt;Data Policy&lt;/a&gt;,
which states that they also comply with law enforcement,
and by Comcast’s
&lt;a href=&quot;https://www.xfinity.com/corporate/customers/policies/customerprivacy#to-provide-and-improve-the-services&quot;&gt;Customer Privacy Notice&lt;/a&gt;,
which literally says that they collect traffic and use
the data they collect to improve their services. I’m sure
other ISPs will have similar policies. But never mind that
fact, the whole point is that there still is value to be
gained from expectation of privacy, even if you think you
benefit from not having that expectation. Again, just
because the data isn’t being abused right now doesn’t mean
it won’t be in the future (on the other hand, as I keep
saying, it doesn’t mean that it &lt;em&gt;will&lt;/em&gt; either). The data
and the conclusions that can be drawn from it are powerful
bargaining tools if they reveal information that you don’t
want people to know. But let’s say that you don’t care.
That does not mean that you shouldn’t be entitled to be
able to control the data advertising companies collect.
Like I will describe in the reasons why I personally care
about privacy, I state that it is about controlling my
information. If you do not care about your information,
you are implicitly allowing for that information to be
released about yourself. So although you don’t care about
the data being collected itself, you do care about
controlling it. Even if you don’t do anything to hide
that data in the first place, your lack of control is in
of itself your decision. You should have the option halt
the collection of data if that is your choice as well.
Allowing your personal data to be collected is as much of
a decision based on your privacy preference as is not
allowing it to be.&lt;/p&gt;

&lt;p&gt;There are so many more points and counterpoints that I can’t
list them all here. Instead, I’ll leave more links so you
can read them yourself.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://pages.gseis.ucla.edu/faculty/agre/arguments.html&quot;&gt;Arguments Against Privacy and What’s Wrong With Them&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.livemint.com/Opinion/03L1A2tOAFw6sXpsu4cweL/The-problem-with-the-right-to-privacy.html&quot;&gt;The problem with the right to privacy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://spreadprivacy.com/three-reasons-why-the-nothing-to-hide-argument-is-flawed/&quot;&gt;Three Reasons Why the “Nothing to Hide” Argument is Flawed&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.theatlantic.com/technology/archive/2013/02/why-does-privacy-matter-one-scholars-answer/273521/&quot;&gt;Why Does Privacy Matter? One Scholar’s Answer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;edit-2019-20-11-210125&quot;&gt;EDIT 2019-20-11 21:01:25:&lt;/h1&gt;

&lt;p&gt;I found yet another gem a few days ago but I seem to be
unable to figure out where it came from. Nevertheless, I
feel that it is worth putting here: the “I have nothing to
hide” argument is inherently flawed because your digital
life and the profiles that Internet companies build on
their users is so vast and complex that you might not even
realize that you have something to hide in the first place.&lt;/p&gt;

&lt;h4 id=&quot;why-i-care&quot;&gt;Why I Care&lt;/h4&gt;

&lt;p&gt;I myself have my own personal reasons to care about
privacy.&lt;/p&gt;

&lt;p&gt;In no particular order, I care about my privacy because I
think that it is important for me to control my personal
information. For example, the front page of my GitHub
profile has my name right on it, but it’s not like I go
around on public forums announcing my name. This is a
deliberate choice. While I’m not keeping my identity
private, I think an important part of privacy is the
element of control. I’m not preventing anyone from finding
out who I am, because I post plenty of that information on
the web. If people are curious, they can find out more
about me. There are going to be creeps online of course,
but from my own personal experience, I feel that having
this information in public has benefitted me much more than
it has been a detriment. It has helped me connect with
people on more than one occaision. But you may be curious,
how does controlling my data relate to privacy? Here is
what the
&lt;a href=&quot;https://iapp.org/about/what-is-privacy/&quot;&gt;IAPP&lt;/a&gt; has to say
on that matter:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Broadly speaking, privacy is the right to be let alone,
or freedom from interference or intrusion. Information
privacy is the right to have some control over how your
personal information is collected and used.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;By making my information less visible in some contexts and
more so in others, I am controlling my privacy. However,
in other contexts, that could also mean hiding my
information more or less completely. For example, I share
my Discord information with very few people, same deal with
my Steam account. I don’t share my passwords with anyone.
Privacy doesn’t mean that you explicitly need to hide
anything, only that you are in control of information.&lt;/p&gt;

&lt;p&gt;Secondly, I care about my privacy because I think that some
of my information shouldn’t fall into the hands of hackers.
Online accounts often link information such as birthdate,
phone number, friendships, etc. Many companies have privacy
policies that say that your information is encrypted or
stored safely and all of that. However, the IAPP states:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;While security is necessary for protecting data, it’s not
sufficient for addressing privacy.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;And they’re right. There are many examples of this being
exhibited in the real world, such as in the case of
&lt;a href=&quot;https://newsroom.fb.com/news/2018/09/security-update/&quot;&gt;Facebook&lt;/a&gt;
just last year. The truth is, once you give your data to
a company, it is stored inside of a black box. I don’t
want to sound like a consspiracy theorist or anything,
but I don’t want my data to be in the hands of someone
I don’t know, running software that might have
vulnerabilities, or servers that are behind on security
updates. I expect that companies I give my personal
information to protect that information. Even companies
proclaim themselves to
&lt;a href=&quot;https://blog.mozilla.org/firefox/firefox-data-privacy-promise/&quot;&gt;protect your privacy&lt;/a&gt;
make
&lt;a href=&quot;https://www.reddit.com/r/firefox/comments/anxfz8/firefox_is_spyware_extension_recommendation/eg1hekf/&quot;&gt;mistakes&lt;/a&gt;
as well. (See the comments, the main post is entirely
outrage bait and spreading FUD).&lt;/p&gt;

&lt;p&gt;The simple fact is, I personally don’t see why companies
should have access to data that they don’t need. I don’t
care if they encrypt it, I don’t care if it is anonymized
or if they never sell it, or if they don’t even have it
stored in the first place. Why am I sending this data then?
That would be analogous to going out to lunch and then
suddenly informing everyone there of my personal health
issues. Not only would this be completely inappropriate,
but the information I’m announcing is completely unecessary
because I’m going to eat, not going to the doctor. To apply
this to a browser for example, why is Google Chrome sending
information back to Google when my browser would work
completely fine without that data sent anywhere? I don’t
care what is being sent, why is it even sent in the first
place?&lt;/p&gt;

&lt;p&gt;Finally, I personally care about my privacy because
tracking takes up my computer’s resources. Loading ads
and spyware implanted on websites that are designed to
track you takes up CPU, RAM, and battery power. If I’m on
a slow WiFi connection, I want every little bit of
bandwidth to load the fucking website, not a bunch of ads.
I’d be happy to donate my money to subscription-based
services such as reputable news sites and content creators
if it means getting rid of ads and they get 100% of the
revenue. Nevermind the fact that advertising companies
want to collect every bit of data possible about me to
“tailor” their ads, I literally just don’t want my battery
to be drained any faster than it already is by being
tracked.&lt;/p&gt;

&lt;h1 id=&quot;what-you-can-do&quot;&gt;What You Can Do&lt;/h1&gt;

&lt;p&gt;I will warn you before this that when regarding privacy,
many of the sources that you’ll run into are not shy about
coming off as tinfoil hatters. I’ve found sources that run
articles about the fall of capitalism, the end of the
world, etc., which can be expected of people who tend to be
paranoid, if not overly so at times. However, privacy and
security are real issues that governments are interested in
as well, and I advise that you ignore the more extreme
conspiracy theorizing and select the portions of the
articles that are rational, or the ones that match your
own
&lt;a href=&quot;https://ssd.eff.org/en/module/your-security-plan&quot;&gt;threat profile&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Again, I will reference the r/privacy wiki that I linked
early in this blog post. It has a lot of references to
many different tools to minimize or take control of the
data being collected on you. Another great resource is
not only looking at other reputable sources of information
on privacy-respecting software such as
&lt;a href=&quot;https://prism-break.org/en/&quot;&gt;PRISM Break&lt;/a&gt;, but also
looking at discussions about privacy and the strengths and
weaknesses of different services on their GitLab
&lt;a href=&quot;https://gitlab.com/prism-break/prism-break/issues&quot;&gt;issues&lt;/a&gt;
page as well.&lt;/p&gt;

&lt;p&gt;I don’t give a comprehensive list here, but it should be
enough to give you an idea of my personal preferences and
where you can find more information. In general, if you
use any software or website that visits the Internet, you
should check on its Privacy Policy and look for informed
opinions about whether or not that service respects your
privacy. Being informed is the most powerful defense for
your freedoms and your right to privacy.&lt;/p&gt;

&lt;h4 id=&quot;web-browser&quot;&gt;Web Browser&lt;/h4&gt;

&lt;p&gt;Another great resource is the
&lt;a href=&quot;https://spyware.neocities.org/articles/browsers.html&quot;&gt;Spyware Watchdog&lt;/a&gt;,
with the linked page going to a comparison of different
web browsers. I personally use Ungoogled Chromium because
I prefer a Chromium based browser that had all of the
spyware disabled right out of the box. I have the following
extensions installed:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Bitwarden&lt;/li&gt;
  &lt;li&gt;Cookie AutoDelete&lt;/li&gt;
  &lt;li&gt;Decentraleyes&lt;/li&gt;
  &lt;li&gt;EditThisCookie&lt;/li&gt;
  &lt;li&gt;HTTPS Everywhere&lt;/li&gt;
  &lt;li&gt;NoScript&lt;/li&gt;
  &lt;li&gt;Privacy Badger&lt;/li&gt;
  &lt;li&gt;uBlock Origin&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There are plethora of different extensions for Firefox as
well, but since I’ve moved on from using Firefox, I won’t
list them here. I personally prefer the UI on Chromium
and I liked not having to configure anything.&lt;/p&gt;

&lt;p&gt;As an extended note, be aware that Chromium is &lt;strong&gt;NOT&lt;/strong&gt; the
same as Ungoogled Chromium! Using the stock Chromium is
just as risky for your privacy as using Google Chrome. You
can find Ungoogled Chromium &lt;a href=&quot;https://github.com/Eloston/ungoogled-chromium&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;os&quot;&gt;OS&lt;/h4&gt;

&lt;p&gt;If you are not using Linux, I highly recommend switching.
Since I already use Debian by default, I have little to say
on this matter. You should read up
&lt;a href=&quot;https://www.privacytools.io/operating-systems/#os&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;search-engine&quot;&gt;Search Engine&lt;/h4&gt;

&lt;p&gt;&lt;del&gt;I personally use StartPage. I’ve used DuckDuckGo in the
past but I’ve personally found StartPage to be a lot better
in terms of search results.&lt;/del&gt; Your milage may vary. Again,
see
&lt;a href=&quot;https://www.privacytools.io/providers/search-engines/&quot;&gt;privacytoolsIO&lt;/a&gt;
for more alternatives.&lt;/p&gt;

&lt;h1 id=&quot;edit-2019-20-11-210125-1&quot;&gt;EDIT 2019-20-11 21:01:25:&lt;/h1&gt;

&lt;p&gt;StartPage was &lt;a href=&quot;https://blog.privacytools.io/delisting-startpage/&quot;&gt;delisted&lt;/a&gt;
on privacytoolsIO and I can no longer recommend them in
good conscience. I now personally use privacytoolsIO’s
Searx instance, which can be found
&lt;a href=&quot;https://search.privacytools.io/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;deleting-accounts&quot;&gt;Deleting Accounts&lt;/h4&gt;

&lt;p&gt;Before writing this article, I had hundreds of logins. I’ve
sent dozens and dozens of emails to the different sites
that I’ve had accounts on asking for them to delete accounts
I no longer use. Before deleting your account, you should
try to obfuscate some of your personal data if you see fit.
You can read each website’s privacy policies if you don’t
know who to contact to delete your account. Deleting your
account means that the data is (hopefully) removed from
the service provider’s servers, and you will (hopefully)
reduce the size of your digital footprint. You can reduce
the chance of having an account compromised if you don’t
have as many accounts.&lt;/p&gt;

&lt;h4 id=&quot;spread-the-word&quot;&gt;Spread the Word&lt;/h4&gt;

&lt;p&gt;If you’ve made it this far, you probably at least care
about privacy enough to think that it is an issue worth
promoting. Tell your friends, advise them to move away
from using services that track users and services that do
not respect their users’ privacy. Privacy is an issue of
complacency. It is easy to have your rights taken away and
your freedoms to be violated if you never knew you had them
in the first place. At worst, at least people will be more
informed if they do not choose to control their personal
data.&lt;/p&gt;

&lt;p&gt;These are only some of the ways that I’ve tried to control
my data and my privacy. There are of course, many more
ways to improve even what I’ve listed here, and there are
other services that are worth giving up that the reader
might be using that I don’t know of. Evaluate what your
risk profile is, minimize your digital footprint, and
assert your right to privacy.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Obviously, this isn’t a programming-related post, but I
still hope that you’ve learned something nevertheless.
Privacy is not only about the here and now, but also about
the future. Now that we are hearing more and more of the
media publicizing hacks for political gain such as the
Clinton email leak and the Cambridge Analytica scandal, it
is more important than ever to take a hard look at how much
we really value our privacy, and by extension, how much we
value our democracy. Privacy is obviously a controversial
issue because it is so politically charged, but I’ve tried
my best to try to stay neutral on this matter. I don’t
think it matters what political party you subscribe to, or
how much you think you care about your privacy, it is an
important issue in the digital age.&lt;/p&gt;</content><author><name></name></author><summary type="html">This post should come with a big red disclaimer that says I’m not an expert, but since my screen is redshifted to hell, plain black will have to do. I’m just a Java programmer with a blog.</summary></entry><entry><title type="html">Lessons Learned Debugging: Part 7</title><link href="https://caojohnny.github.io/blog/2019/07/24/lessons-learned-debugging-part-7.html" rel="alternate" type="text/html" title="Lessons Learned Debugging: Part 7" /><published>2019-07-24T00:07:20-07:00</published><updated>2019-07-24T00:07:20-07:00</updated><id>https://caojohnny.github.io/blog/2019/07/24/lessons-learned-debugging-part-7</id><content type="html" xml:base="https://caojohnny.github.io/blog/2019/07/24/lessons-learned-debugging-part-7.html">&lt;p&gt;I haven’t explicitly identified it until now, but it seems
that I have a habit of putting exactly the same thing in my
introductory paragraph in basically all of the posts in
this series. This particular lesson doesn’t sound all that
bad at first, but I can assure you that I have literally
crashed a server by not following it.&lt;/p&gt;

&lt;h1 id=&quot;strongly-consider-whether-you-can-put-something-in-a-shared-library&quot;&gt;Strongly Consider Whether You Can Put Something In a Shared Library&lt;/h1&gt;

&lt;p&gt;There are so, so many benefits to having a centralized
core library you can depend on for your plugins with
virtually no drawbacks whatsoever.&lt;/p&gt;

&lt;p&gt;The first thing that comes to mind, of course, is having
a set of pre-written classes available to you. For example,
menus, handy utilities for things such as I/O, databases,
and data management primitives. Chances are, if you are not
using a central library, you are writing a significant
amount of boilerplate in your non-trivial plugins. If that
is the case, you should consider generifying what you have
written so that it fits the purpose of multiple plugins.
Although you might be spending more time now trying to
write part of your core library and also the plugin that
currently needs it, you will spend less time writing the
same boilerplate later on. You can significantly increase
productivity if you aren’t stuck writing basically the
same thing for every plugin you write each time you write
a new plugin. Secondly, it is inevitable that you will
make mistakes, and as hard as I try to push for care and
slowing down to think through your code, even I myself
make mistakes as well. If you are writing similar or even
the same code on each of your plugins, ALL of your plugins
need to be updated in the case that you find out you’ve
been doing it wrong the entire time. On the other hand, if
all of your plugins depend on just one library, you only
need to fix the bug once. The counterargument is often that
you can minimize the impact of a mistake if you spot it
when you write the same thing again. However, this is
wishful thinking. This is not how it works in the real
world. I would strongly argue that writing boilerplate is a
mindless activity. You are not likely to catch that you are
making a mistake if you are writing the same code you wrote
last time. On top of that, the more you get used to the
same workflow, the more complacent you become, and more
importantly, the bigger the cost of fixing that said code
once it breaks. Think of it this way: if you only write the
code once, then you only have that one chance to make a
mistake. If you are writing the same code over and over
again, you take that risk every. Single. Time. Thirdly,
even if you Ctrl+C and Ctrl+V your code, there are still
no guarantees. It might work for small snippets of code,
but once you get to large amounts of boilerplate such as
when writing inventory GUIs for example, then things start
to fall apart. You &lt;em&gt;still&lt;/em&gt; suffer from the possibility that
the snippet you’ve been copying from is also wrong as well.
You are not only duplicating what works across your entire
codebase, you are also duplicating anything that
potentially doesn’t. Again, the impact of a bug can be
mitigated, but the cost of fixing it cannot. Do yourself a
favor. When you are writing a lot of boilerplate that can
be abstracted away, consider putting it on your core
library.&lt;/p&gt;

&lt;p&gt;A core library is not only good for putting your own code,
but the code of others as well. You can shade various
common dependencies into your core. The following argument
is terrible, for obvious reasons, but you are reducing the
total JAR sizes of all your plugins if only the one core
plugin contains a big library. But, for those of you who
are for some inexplicable reason scared of large JARs, then
throwing everything into one super JAR file might help
settle your conscience. For me personally, I need to
configure certain libraries such as Guice that need their
own namespaces each time I shade it using Maven, so it
helps if I don’t even need to write anything extra by
using a &lt;code class=&quot;highlighter-rouge&quot;&gt;provided&lt;/code&gt; dependency on the central library. This
isn’t to say that you should put every single dependency in
your core library, but commonly used libraries like
HikariCP are always helpful to have lying around,
especially when a significant portion of your plugin
ecosystem might depend on it. Again, I’m going back to the
JAR size argument, but it also can’t hurt to reduce the
amount of time it takes to download every other plugin if
only the super JAR takes a long time since it has all the
libraries shaded into it.&lt;/p&gt;

&lt;p&gt;Finally, a core library can be used to enforce a specific
standard or policy. For example, if you are including
MySQL utilities, you can use the &lt;code class=&quot;highlighter-rouge&quot;&gt;config.yml&lt;/code&gt; to provide
the MySQL credentials to all the plugins using that core
library. The server owner will not need to configure the
credentials more than once. Secondly, by having a library
of different utilities, you can centralize the way a
certain action is performed. For example, you might want
to make sure that caching is done in a particular way, or
that all of the caches used on the various dependent
plugins are configured to have a specific eviction time.
By including this into the core library, you can enforce
that specific policy on all of your plugins. You can even
have a hierarchy of core plugins if certain developers
prefer some other ways, or would like to use open-source
core libraries instead. By changing specific portions of
their desired library to comply with the “master” core
library, they can use both the “master” and their custom
core in conjunction, or simply utilize the custom
library if the desired features are fully reimplemented.&lt;/p&gt;

&lt;p&gt;It may actually take longer to maintain a core library
if you are developing it alongside whatever plugin
you need to complete because you are abstracting away some
feature, but I can assure you that this effort is well
worth it. Because your core library matures in the long
run, it is a net gain rather than a loss as it becomes more
and more useful. Had I have had the foresight to write my
boilerplate into a centralized library, I would not have
crashed servers and caused multitudes of plugins to have
independent visual glitches as a result of making one
mistake.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;As has been tradition, I leave with the following from
&lt;a href=&quot;http://spinroot.com/gerard/pdf/P10.pdf&quot;&gt;The Power of Ten&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If the rules seem Draconian at first, bear in mind that
they are meant to make it possible to check code where very
literally your life may depend on its correctness: code
that is used to control the airplane that you fly on, the
nuclear power plant a few miles from where you live, or the
spacecraft that carries astronauts into orbit. The rules
act like the seat-belt in your car: initially they are
perhaps a little uncomfortable, but after a while their use
becomes second-nature and not using them becomes
unimaginable.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I’ve recently become more interested in Internet privacy.
I consider myself to be relatively informed on the topic,
but there are a lot of things that I’ve found that I didn’t
know about within the past few weeks. I’ll be doing a post
on that soon, because I think it is an issue worth talking
about. And for readers who don’t think privacy is an
important issue, I only ask that you hear me out. I’m not a
popular blogger by any means, so if you are reading my blog
in the first place, that probably indicates that you don’t
have anything better to do anyways. I encourage you to use
that time to become at least a little bit more informed :).&lt;/p&gt;

&lt;h1 id=&quot;addenum-2019-08-14-0315&quot;&gt;Addenum 2019-08-14 03:15&lt;/h1&gt;

&lt;p&gt;I hadn’t actually thought of this earlier, but I’ve
recently run into another situation where a standardized
library would have made life a lot easier. Especially in
teams with several developers, providng a single paradigm
provided by a core plugin makes the code easier for other
developers to parse and less error prone. Because you can
be assured that some portion of the code that calls on a
standardized function works, you can debug and review code
much faster at a reduced cost.&lt;/p&gt;</content><author><name></name></author><summary type="html">I haven’t explicitly identified it until now, but it seems that I have a habit of putting exactly the same thing in my introductory paragraph in basically all of the posts in this series. This particular lesson doesn’t sound all that bad at first, but I can assure you that I have literally crashed a server by not following it.</summary></entry><entry><title type="html">What The Fuck Does Guice ‘zip file closed’ Exception Mean?</title><link href="https://caojohnny.github.io/blog/2019/07/18/what-the-fuck-does-guice-zip-file-closed-exception-mean.html" rel="alternate" type="text/html" title="What The Fuck Does Guice 'zip file closed' Exception Mean?" /><published>2019-07-18T01:00:15-07:00</published><updated>2019-07-18T01:00:15-07:00</updated><id>https://caojohnny.github.io/blog/2019/07/18/what-the-fuck-does-guice-zip-file-closed-exception-mean</id><content type="html" xml:base="https://caojohnny.github.io/blog/2019/07/18/what-the-fuck-does-guice-zip-file-closed-exception-mean.html">&lt;p&gt;I’ve had a lot of time to work with &lt;a href=&quot;https://github.com/google/guice&quot;&gt;Guice&lt;/a&gt;
when I worked with Skytropia. However, working on a
personal project with more up-to-date versions of Spigot
and Guice, I was met with the strangest possible exception.
But what does it mean? Honestly, I haven’t quite figured it
all out myself either.&lt;/p&gt;

&lt;p&gt;That being said, the “solution” is deceptively simple and
if you’re just here for that, scroll down and skip the
introductory fluff.&lt;/p&gt;

&lt;h1 id=&quot;the-setup&quot;&gt;The Setup&lt;/h1&gt;

&lt;p&gt;Obviously, it would be out of place if I didn’t show what
I’m running. Here’s the Java/OS info:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;System Info: Java 11 (OpenJDK 64-Bit Server VM 11.0.3+7) Host:  Linux 4.19.0-5-amd64 (amd64)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now here’s the server info:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[01:05:37 INFO]: This server is running Paper version git-Paper-133 (MC: 1.14.3) (Implementing API version 1.14.3-R0.1-SNAPSHOT)
[01:05:37 INFO]: Previous version: git-Paper-123 (MC: 1.14.3)
[01:05:37 INFO]: You are 1 version(s) behind
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this is my dependencies &lt;code class=&quot;highlighter-rouge&quot;&gt;pom.xml&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.google.inject&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;guice&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;4.2.2&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;compile&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;exclusions&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;exclusion&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.google.guava&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;guava&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/exclusion&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/exclusions&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.google.inject.extensions&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;guice-assistedinject&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;4.2.2&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;compile&lt;span class=&quot;nt&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am using relocations to move &lt;code class=&quot;highlighter-rouge&quot;&gt;com.google.inject&lt;/code&gt; to a
different package. It is worth noting that you can get an
equally strange error if you shade Guice in the same
namespace, but that applies to all plugins (and the server
namespace as well, which is why you should NEVER shade
database drivers in a plugin, relocation doesn’t work). The
error will obviously look a little bit different, but if I
recall, it should be an &lt;code class=&quot;highlighter-rouge&quot;&gt;IllegalAccessException&lt;/code&gt; or
something similar. That being said, this post is &lt;strong&gt;not&lt;/strong&gt;
on that topic.&lt;/p&gt;

&lt;h1 id=&quot;the-error&quot;&gt;The Error&lt;/h1&gt;

&lt;p&gt;Now onto the error. This is what I have been tearing my
hair over the last hour:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; 2019-07-18 00:30:34,444 Log4j2-TF-1-AsyncLogger[AsyncContext@70dea4e]-1 ERROR An exception occurred processing Appender File com.google.common.util.concurrent.UncheckedExecutionException: java.lang.IllegalStateException: zip file closed
        at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2217)
        at com.google.common.cache.LocalCache.get(LocalCache.java:4154)
        at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:4158)
        at com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:5147)
        at com.google.common.cache.LocalCache$LocalLoadingCache.getUnchecked(LocalCache.java:5153)
        at com.google.inject.internal.util.StackTraceElements.forMember(StackTraceElements.java:71)
        at com.google.inject.internal.Messages.formatParameter(Messages.java:286)
        at com.google.inject.internal.Messages.formatInjectionPoint(Messages.java:273)
        at com.google.inject.internal.Messages.formatSource(Messages.java:229)
        at com.google.inject.internal.Messages.formatSource(Messages.java:220)
        at com.google.inject.internal.Messages.formatMessages(Messages.java:90)
        at com.google.inject.ConfigurationException.getMessage(ConfigurationException.java:73)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.&amp;lt;init&amp;gt;(ThrowableProxy.java:134)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.&amp;lt;init&amp;gt;(ThrowableProxy.java:122)
        at org.apache.logging.log4j.core.async.RingBufferLogEvent.getThrownProxy(RingBufferLogEvent.java:330)
        at org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter.format(ExtendedThrowablePatternConverter.java:61)
        at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:38)
        at org.apache.logging.log4j.core.layout.PatternLayout$PatternSelectorSerializer.toSerializable(PatternLayout.java:455)
        at org.apache.logging.log4j.core.layout.PatternLayout.toText(PatternLayout.java:232)
        at org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:217)
        at org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:57)
        at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.directEncodeEvent(AbstractOutputStreamAppender.java:177)
        at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.tryAppend(AbstractOutputStreamAppender.java:170)
        at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:161)
        at org.apache.logging.log4j.core.appender.RollingRandomAccessFileAppender.append(RollingRandomAccessFileAppender.java:218)
        at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156)
        at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129)
        at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120)
        at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)
        at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:448)
        at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:433)
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:417)
        at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:79)
        at org.apache.logging.log4j.core.async.AsyncLogger.actualAsyncLog(AsyncLogger.java:337)
        at org.apache.logging.log4j.core.async.RingBufferLogEvent.execute(RingBufferLogEvent.java:161)
        at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:45)
        at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:29)
        at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:168)
        at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.IllegalStateException: zip file closed
        at java.util.zip.ZipFile.ensureOpen(ZipFile.java:686)
        at java.util.zip.ZipFile.getEntry(ZipFile.java:315)
        at java.util.jar.JarFile.getEntry(JarFile.java:240)
        at java.util.jar.JarFile.getJarEntry(JarFile.java:223)
        at org.bukkit.plugin.java.PluginClassLoader.findClass(PluginClassLoader.java:101)
        at org.bukkit.plugin.java.PluginClassLoader.findClass(PluginClassLoader.java:85)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at com.google.inject.internal.util.StackTraceElements$1.load(StackTraceElements.java:49)
        at com.google.inject.internal.util.StackTraceElements$1.load(StackTraceElements.java:45)
        at com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3716)
        at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2424)
        at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2298)
        at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2211)
        ... 41 more
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My reaction was immediate. What. The. Fuck.&lt;/p&gt;

&lt;p&gt;What is this supposed to even mean? None of this makes any
sense. Why is Guice even in this stacktrace? Where does the
stacktrace even come from? How is the logger looping back
to Guice in the first place? I mean from the looks of it,
it kinda looked like it had something to do with logging,
but there are several things out of place here - it deals
with the class loader, and Guice had something to do with
it. So obviously, the knee-jerk reaction was incorrect.
(I &lt;code class=&quot;highlighter-rouge&quot;&gt;rm -fR logs/&lt;/code&gt; anyways for good measure, but no dice).&lt;/p&gt;

&lt;p&gt;So how am I supposed to fix it?&lt;/p&gt;

&lt;h1 id=&quot;lets-google-it&quot;&gt;Let’s Google It&lt;/h1&gt;

&lt;p&gt;I was actually unable to find anything about this specific
exception. The only thing I could find were questions like
&lt;a href=&quot;https://stackoverflow.com/q/50693221/3308999&quot;&gt;these&lt;/a&gt; where
they were having issues with the Java version, but that
can’t be right because the exceptions don’t match up first
of all, and second, I know for a fact that Java 11 works
completely fine since I’ve used Guice in the past on Java
11 platforms. Finally, I know that assisted inject isn’t
the issue either because I literally commented it out in
the &lt;code class=&quot;highlighter-rouge&quot;&gt;pom.xml&lt;/code&gt; and made the necessary deletions without
effect.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/q/54174855/3308999&quot;&gt;This&lt;/a&gt; also
came up, but this is another lifeless StackOverflow post
with no answers to it.&lt;/p&gt;

&lt;h1 id=&quot;debugging&quot;&gt;Debugging&lt;/h1&gt;

&lt;p&gt;Since I know that Guice is part of the problem, I decided
to comment out all the initialization it is doing, from
creating the injector to the usages of
&lt;code class=&quot;highlighter-rouge&quot;&gt;Injector#getInstance(...)&lt;/code&gt;. Since I was using a newer
Guice version, perhaps simply having the classes in the JAR
or perhaps the relocation could be messing with something?
The answer was no, the exception didn’t come up with simply
the files in the JAR. This means that when I’m initializing
something, obviously there was something wrong with either
the way I’m configuring or my constructors, or something
along those lines.&lt;/p&gt;

&lt;p&gt;I uncommented &lt;code class=&quot;highlighter-rouge&quot;&gt;Guice#createInjector(...)&lt;/code&gt; and ran again
with no exception. Good, configuration should probably be
fine as-is unless I forgot something, but I’ll have to
start uncommenting the usages of
&lt;code class=&quot;highlighter-rouge&quot;&gt;Injector#getInstance(...)&lt;/code&gt; to know for sure. As I
uncommented those lines, I finally hit an exception, but
it wasn’t the big long meaningless one I pasted above, it
was a readable Guice configuration exception. As it turns
out, I failed to configure a binding for &lt;code class=&quot;highlighter-rouge&quot;&gt;Plugin&lt;/code&gt;, which I
used in place of the actual main class. However, using
&lt;code class=&quot;highlighter-rouge&quot;&gt;Plugin&lt;/code&gt; in the first place was a mistake. The particular
class I was working with belonged specifically to the
project and wasn’t a utility or anything, so it was
supposed to use the main class rather than a generic
&lt;code class=&quot;highlighter-rouge&quot;&gt;Plugin&lt;/code&gt;. Since I already had my plugin module correctly
configured, I simply fixed the constructor to take the main
class instead. Ta da, no more exception. In the end, it
turns out that by fixing that configuration exception, the
big meaningless one also went away as well.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;In the end, my best guess is that there is an issue with
loading the classes that are contained in the exception
trace, which led to the large spaghetti exception that I
pasted to be printed out. An exception caused by printing
an exception. I’m not sure why the underlying exception
that I solved was printed in plaintext when I suddenly
commented out a few lines, but by fixing the actual error,
it won’t be thrown, and therefore the pasted exception
won’t be thrown either. I’m not sure why this even occurs
in the first place, what the problem is with exceptions
that require class loading and such. Perhaps it is needed
to find line numbers or something to display more
debugging information? Perhaps because it ends up having
to resolve classes through &lt;code class=&quot;highlighter-rouge&quot;&gt;PluginClassLoader&lt;/code&gt;, and the JAR
file has already been read, it can’t read from the closed
JAR stream? I honestly can only speculate. That being said,
it is ironic that something which may have originally been
intended to expedite the debugging process actually
hindered it in this case. Go figure.&lt;/p&gt;

&lt;p&gt;I’m working on getting the project out as soon as I can.
This is simply a quick post I decided to write in case
anyone else also runs into this issue.&lt;/p&gt;

&lt;h1 id=&quot;quick-update-2019-07-21-2347&quot;&gt;Quick update 2019-07-21 23:47&lt;/h1&gt;

&lt;p&gt;I figured out that it has something to do with unchecked
exceptions being thrown; if you wrap all of your code
that uses &lt;code class=&quot;highlighter-rouge&quot;&gt;Injector#getInstance(...)&lt;/code&gt; with a try-catch
block and print with &lt;code class=&quot;highlighter-rouge&quot;&gt;Exception#printStackTrace()&lt;/code&gt; instead,
you can print the actual exception. Since
&lt;code class=&quot;highlighter-rouge&quot;&gt;#getInstance(...)&lt;/code&gt; should only be used in a few entry
points, it should be relatively straightforward (if it
is being used literally everywhere, you’ve probably missed
the point of Guice…).&lt;/p&gt;</content><author><name></name></author><summary type="html">I’ve had a lot of time to work with Guice when I worked with Skytropia. However, working on a personal project with more up-to-date versions of Spigot and Guice, I was met with the strangest possible exception. But what does it mean? Honestly, I haven’t quite figured it all out myself either.</summary></entry></feed>