<p><strong>MAJOR EDIT: <a href="https://wiki.debian.org/DontBreakDebian">DO NOT DO THIS</a>!!</strong></p>

<p>PLEASE PLEASE avoid using sid/jessie repos at the same time, I SEVERELY broke the apt-get package manager by doing this and ended up not being able to recover. I ended up having to reinstall the entire Debian OS, lmao.</p>

<p><del>Recently adding the <a href="">Debian sid</a> repos to my <code class="highlighter-rouge">sources.list</code>, I found that upgrading a certain few packages related to <a href="https://wiki.debian.org/iPhone"><code class="highlighter-rouge">libimobiledevice-dev</code></a> (in order to transfer photos from my iPhone 6S to my computer) caused other libraries to be needed to be upated. Of course, out of all the possible libraries, one of the libraries that was updated broke FFmpeg.</del></p>

<h1 id="background"><del>Background<del></del></del></h1>

<p><del>I was led on this frustrating adventure by my desire to move pictures from my iPhone to my computer. I could have gone the simple way and just used iTunes or something on a Windows computer, but you know what? It just happens that I have a backup folder already with all my photos on my Debian computer.</del></p>

<p><del>Simply the most magical thing about Debian is how I was able to USB transfer all the earlier photos from my phone to my computer without trouble, but I’d get Unhandled lockdown errors whenever I mount my iPhone this time around.</del></p>

<p><del>Forgetting to read the portion about using the <a href="https://wiki.debian.org/iPhone#backporting_libimobiledevice_1.1.1_to_Squeeze"><code class="highlighter-rouge">jessie-backports</code> workaround</a>, I rashly went to use the <code class="highlighter-rouge">sid</code> repos instead…</del></p>

<h1 id="the-problem"><del>The Problem</del></h1>

<p><del>A few packages later (using <code class="highlighter-rouge">apt-get dist-upgrade</code> I think?), I was rather surprised to find that <a href="https://obsproject.com/">OBS</a> had stopped working. Whenever I’d enter <code class="highlighter-rouge">obs</code> into terminal, it would spit out something like the following:</del></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>obs: symbol lookup error: /usr/lib/x86_64-linux-gnu/libass.so.5
undefined symbol: FT_Outline_EmboldenXY
</code></pre></div></div>

<p><del>No problem. Can’t be part of the package update, right… (it was)? I do a quick google search and discovered the <a href="http://askubuntu.com/a/659630">following</a>:</del></p>

<ol>
  <li><del>This was related to FFmpeg, not actually OBS</del></li>
  <li><del>This works:</del></li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /usr/lib/x86_64-linux-gnu
ffmpeg
</code></pre></div></div>

<p><del>The latter point was in particular, the most baffling thing about the whole issue. I couldn’t comprehend how being in a specific library directory ended up allowing FFmpeg to work. I did not want to have to switch into this directory every time I needed to use FFmpeg, so I decided to attempted to fix the issue by compiling a new version of FFmpeg…</del></p>

<h1 id="fixing-it"><del>Fixing it</del></h1>

<p><del>I decided to recompile FFmpeg to try my luck and see if it is simply a minor library error (?? not even sure what I was thinking at the time).</del></p>

<p><del>Now I tried a wide variety of different compile options, including <a href="https://github.com/lutris/ffmpeg-nvenc">this nifty script</a> which I used previously to install OBS and FFmpeg.</del></p>

<p><del>Surprise, surprise. It didn’t work.</del></p>

<p><del>Knowing that it was a problem with <code class="highlighter-rouge">libass</code>, I was damned to find that even the FFmpeg build in the <code class="highlighter-rouge">sid</code> repos did not even work with the <code class="highlighter-rouge">libass</code> version packaged for that <code class="highlighter-rouge">jessie</code> or <code class="highlighter-rouge">testing</code>.</del></p>

<p><del>Basically in order to fix the problem, I cannot use dynamic links to the new version of libass, but I needed to retain a static link to the previous one with the FFmpeg binary.</del></p>

<p><del>I actually had modified the previous script exactly for this purpose, but in being new to this whole static thing, I mixed up <code class="highlighter-rouge">--enable-shared</code> and <code class="highlighter-rouge">--enable-static</code> flags multiple times. It turns out however, that the two don’t really have anything in particular that relates them. Unbeknownst to me, I kept trying different combinations of fruitlessly changing the flags only to get linking errors with <code class="highlighter-rouge">x264</code> and <code class="highlighter-rouge">libass</code>.</del></p>

<p><del>In short, shared vs. static:</del></p>

<ol>
  <li><del>Shared flag - writes <code class="highlighter-rouge">.so</code> files to the library path for other binaries that use dynamic libraries to load the library. Newer versions replace this <code class="highlighter-rouge">.so</code> file with the newer version, thus updating for all binaries using this library.</del></li>
  <li><del>Static flag - does not use <code class="highlighter-rouge">.so</code> file, but rather an <code class="highlighter-rouge">.a</code> file that is always the same. Updates do not affect static libraries, as the name “static” implies.</del></li>
</ol>

<p><del>In the end, I went with using <a href="https://github.com/zimbatm/ffmpeg-static">this script</a>, but with a few minor modifications:</del></p>

<div class="language-patch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/build.sh b/build.sh
index f94fdbe..cfc8a61 100755
</span><span class="gd">--- a/build.sh
</span><span class="gi">+++ b/build.sh
</span><span class="gu">@@ -160,7 +160,7 @@ make install
</span> echo "*** Building libvpx ***"
 cd $BUILD_DIR/libvpx*
 [ $rebuild -eq 1 -a -f Makefile ] &amp;&amp; make distclean || true
<span class="gd">-[ ! -f config.status ] &amp;&amp; PATH="$BIN_DIR:$PATH" ./configure --prefix=$TARGET_DIR --disable-examples --disable-unit-tests --enable-pic
</span><span class="gi">+[ ! -f config.status ] &amp;&amp; PATH="$BIN_DIR:$PATH" ./configure --prefix=$TARGET_DIR --disable-examples --disable-unit-tests --enable-shared --enable-pic
</span> PATH="$BIN_DIR:$PATH" make -j $jval
 make install
 
<span class="gu">@@ -196,6 +196,7 @@ PKG_CONFIG_PATH="$TARGET_DIR/lib/pkgconfig" ./configure \
</span>   --enable-libvpx \
   --enable-libx264 \
   --enable-libx265 \
<span class="gi">+  --enable-nvenc \
</span>   --enable-nonfree
 PATH="$BIN_DIR:$PATH" make -j$NPROC
 make install
</code></pre></div></div>

<p><del>I made a minor fix to VPX not being able to detected, although I am not completely sure how that is supposed to work.</del></p>

<p><del>(Quick note: NVENC capability dynamically loads files from the library path from the nVidia SDK, no compilation needed. I did not add a script to download the files because a) the toolkit requires signing in and b) I already have the files)</del></p>

<h1 id="conclusion"><del>Conclusion</del></h1>

<p><del>I was eventually able to install OBS using the <code class="highlighter-rouge">ffmpeg-static</code> build script to build FFmpeg. Everything worked out in the end (except for one minor caveat that <code class="highlighter-rouge">ffplay</code> is never compiled, I will need to figure that out). If OBS is missing an FFmpeg compile dependency, then use <code class="highlighter-rouge">--enable-shared</code> to allow OBS to use them as well. Otherwise, errors such as missing <code class="highlighter-rouge">libswrescale</code> can be fixed using the <code class="highlighter-rouge">sid</code> packages.</del></p>
